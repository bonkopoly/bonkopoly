import{r as f,a as yn,g as xn,c as ce,b as bn,R as gs}from"./vendor-c28bf532.js";import{G as wn,U as Pe,T as vn,S as $t,a as ys,M as jn,L as Br,E as _n,b as Nn,P as xs,c as yr,X as Je,m as Pt,C as fe,d as St,D as Pn,e as Sn,H as ne,f as at,B as ze,A as kn,g as pt,h as Tn,i as Cn,j as bs,k as rt,l as Mr,n as Ur,o as ws,p as $n,q as En,r as Rn,s as vs,t as In,u as sr,W as Dr,v as Fr,w as On,x as An,y as Ln,z as Bn}from"./ui-ac45b9ed.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();var js={exports:{}},Et={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mn=f,Un=Symbol.for("react.element"),Dn=Symbol.for("react.fragment"),Fn=Object.prototype.hasOwnProperty,Gn=Mn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Hn={key:!0,ref:!0,__self:!0,__source:!0};function _s(s,e,t){var r,n={},o=null,i=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(i=e.ref);for(r in e)Fn.call(e,r)&&!Hn.hasOwnProperty(r)&&(n[r]=e[r]);if(s&&s.defaultProps)for(r in e=s.defaultProps,e)n[r]===void 0&&(n[r]=e[r]);return{$$typeof:Un,type:s,key:o,ref:i,props:n,_owner:Gn.current}}Et.Fragment=Dn;Et.jsx=_s;Et.jsxs=_s;js.exports=Et;var a=js.exports,nr={},Gr=yn;nr.createRoot=Gr.createRoot,nr.hydrateRoot=Gr.hydrateRoot;const qn="modulepreload",zn=function(s){return"/"+s},Hr={},Ke=function(e,t,r){if(!t||t.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(t.map(o=>{if(o=zn(o),o in Hr)return;Hr[o]=!0;const i=o.endsWith(".css"),c=i?'[rel="stylesheet"]':"";if(!!r)for(let u=n.length-1;u>=0;u--){const h=n[u];if(h.href===o&&(!i||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${c}`))return;const d=document.createElement("link");if(d.rel=i?"stylesheet":qn,i||(d.as="script",d.crossOrigin=""),d.href=o,document.head.appendChild(d),i)return new Promise((u,h)=>{d.addEventListener("load",u),d.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>e()).catch(o=>{const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=o,window.dispatchEvent(i),!i.defaultPrevented)throw o})};var qr="popstate";function Vn(s={}){function e(r,n){let{pathname:o,search:i,hash:c}=r.location;return or("",{pathname:o,search:i,hash:c},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function t(r,n){return typeof n=="string"?n:it(n)}return Jn(e,t,null,s)}function J(s,e){if(s===!1||s===null||typeof s>"u")throw new Error(e)}function me(s,e){if(!s){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Wn(){return Math.random().toString(36).substring(2,10)}function zr(s,e){return{usr:s.state,key:s.key,idx:e}}function or(s,e,t=null,r){return{pathname:typeof s=="string"?s:s.pathname,search:"",hash:"",...typeof e=="string"?Ye(e):e,state:t,key:e&&e.key||r||Wn()}}function it({pathname:s="/",search:e="",hash:t=""}){return e&&e!=="?"&&(s+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(s+=t.charAt(0)==="#"?t:"#"+t),s}function Ye(s){let e={};if(s){let t=s.indexOf("#");t>=0&&(e.hash=s.substring(t),s=s.substring(0,t));let r=s.indexOf("?");r>=0&&(e.search=s.substring(r),s=s.substring(0,r)),s&&(e.pathname=s)}return e}function Jn(s,e,t,r={}){let{window:n=document.defaultView,v5Compat:o=!1}=r,i=n.history,c="POP",l=null,d=u();d==null&&(d=0,i.replaceState({...i.state,idx:d},""));function u(){return(i.state||{idx:null}).idx}function h(){c="POP";let b=u(),w=b==null?null:b-d;d=b,l&&l({action:c,location:x.location,delta:w})}function m(b,w){c="PUSH";let N=or(x.location,b,w);t&&t(N,b),d=u()+1;let y=zr(N,d),j=x.createHref(N);try{i.pushState(y,"",j)}catch(S){if(S instanceof DOMException&&S.name==="DataCloneError")throw S;n.location.assign(j)}o&&l&&l({action:c,location:x.location,delta:1})}function p(b,w){c="REPLACE";let N=or(x.location,b,w);t&&t(N,b),d=u();let y=zr(N,d),j=x.createHref(N);i.replaceState(y,"",j),o&&l&&l({action:c,location:x.location,delta:0})}function g(b){return Kn(b)}let x={get action(){return c},get location(){return s(n,i)},listen(b){if(l)throw new Error("A history only accepts one active listener");return n.addEventListener(qr,h),l=b,()=>{n.removeEventListener(qr,h),l=null}},createHref(b){return e(n,b)},createURL:g,encodeLocation(b){let w=g(b);return{pathname:w.pathname,search:w.search,hash:w.hash}},push:m,replace:p,go(b){return i.go(b)}};return x}function Kn(s,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),J(t,"No window.location.(origin|href) available to create URL");let r=typeof s=="string"?s:it(s);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=t+r),new URL(r,t)}function Ns(s,e,t="/"){return Yn(s,e,t,!1)}function Yn(s,e,t,r){let n=typeof e=="string"?Ye(e):e,o=we(n.pathname||"/",t);if(o==null)return null;let i=Ps(s);Xn(i);let c=null;for(let l=0;c==null&&l<i.length;++l){let d=lo(o);c=ao(i[l],d,r)}return c}function Ps(s,e=[],t=[],r=""){let n=(o,i,c)=>{let l={relativePath:c===void 0?o.path||"":c,caseSensitive:o.caseSensitive===!0,childrenIndex:i,route:o};l.relativePath.startsWith("/")&&(J(l.relativePath.startsWith(r),`Absolute route path "${l.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),l.relativePath=l.relativePath.slice(r.length));let d=be([r,l.relativePath]),u=t.concat(l);o.children&&o.children.length>0&&(J(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${d}".`),Ps(o.children,e,u,d)),!(o.path==null&&!o.index)&&e.push({path:d,score:no(d,o.index),routesMeta:u})};return s.forEach((o,i)=>{var c;if(o.path===""||!((c=o.path)!=null&&c.includes("?")))n(o,i);else for(let l of Ss(o.path))n(o,i,l)}),e}function Ss(s){let e=s.split("/");if(e.length===0)return[];let[t,...r]=e,n=t.endsWith("?"),o=t.replace(/\?$/,"");if(r.length===0)return n?[o,""]:[o];let i=Ss(r.join("/")),c=[];return c.push(...i.map(l=>l===""?o:[o,l].join("/"))),n&&c.push(...i),c.map(l=>s.startsWith("/")&&l===""?"/":l)}function Xn(s){s.sort((e,t)=>e.score!==t.score?t.score-e.score:oo(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}var Zn=/^:[\w-]+$/,Qn=3,eo=2,to=1,ro=10,so=-2,Vr=s=>s==="*";function no(s,e){let t=s.split("/"),r=t.length;return t.some(Vr)&&(r+=so),e&&(r+=eo),t.filter(n=>!Vr(n)).reduce((n,o)=>n+(Zn.test(o)?Qn:o===""?to:ro),r)}function oo(s,e){return s.length===e.length&&s.slice(0,-1).every((r,n)=>r===e[n])?s[s.length-1]-e[e.length-1]:0}function ao(s,e,t=!1){let{routesMeta:r}=s,n={},o="/",i=[];for(let c=0;c<r.length;++c){let l=r[c],d=c===r.length-1,u=o==="/"?e:e.slice(o.length)||"/",h=kt({path:l.relativePath,caseSensitive:l.caseSensitive,end:d},u),m=l.route;if(!h&&d&&t&&!r[r.length-1].route.index&&(h=kt({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},u)),!h)return null;Object.assign(n,h.params),i.push({params:n,pathname:be([o,h.pathname]),pathnameBase:mo(be([o,h.pathnameBase])),route:m}),h.pathnameBase!=="/"&&(o=be([o,h.pathnameBase]))}return i}function kt(s,e){typeof s=="string"&&(s={path:s,caseSensitive:!1,end:!0});let[t,r]=io(s.path,s.caseSensitive,s.end),n=e.match(t);if(!n)return null;let o=n[0],i=o.replace(/(.)\/+$/,"$1"),c=n.slice(1);return{params:r.reduce((d,{paramName:u,isOptional:h},m)=>{if(u==="*"){let g=c[m]||"";i=o.slice(0,o.length-g.length).replace(/(.)\/+$/,"$1")}const p=c[m];return h&&!p?d[u]=void 0:d[u]=(p||"").replace(/%2F/g,"/"),d},{}),pathname:o,pathnameBase:i,pattern:s}}function io(s,e=!1,t=!0){me(s==="*"||!s.endsWith("*")||s.endsWith("/*"),`Route path "${s}" will be treated as if it were "${s.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${s.replace(/\*$/,"/*")}".`);let r=[],n="^"+s.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(i,c,l)=>(r.push({paramName:c,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return s.endsWith("*")?(r.push({paramName:"*"}),n+=s==="*"||s==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?n+="\\/*$":s!==""&&s!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,e?void 0:"i"),r]}function lo(s){try{return s.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return me(!1,`The URL path "${s}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),s}}function we(s,e){if(e==="/")return s;if(!s.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=s.charAt(t);return r&&r!=="/"?null:s.slice(t)||"/"}function co(s,e="/"){let{pathname:t,search:r="",hash:n=""}=typeof s=="string"?Ye(s):s;return{pathname:t?t.startsWith("/")?t:uo(t,e):e,search:fo(r),hash:po(n)}}function uo(s,e){let t=e.replace(/\/+$/,"").split("/");return s.split("/").forEach(n=>{n===".."?t.length>1&&t.pop():n!=="."&&t.push(n)}),t.length>1?t.join("/"):"/"}function zt(s,e,t,r){return`Cannot include a '${s}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function ho(s){return s.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function ks(s){let e=ho(s);return e.map((t,r)=>r===e.length-1?t.pathname:t.pathnameBase)}function Ts(s,e,t,r=!1){let n;typeof s=="string"?n=Ye(s):(n={...s},J(!n.pathname||!n.pathname.includes("?"),zt("?","pathname","search",n)),J(!n.pathname||!n.pathname.includes("#"),zt("#","pathname","hash",n)),J(!n.search||!n.search.includes("#"),zt("#","search","hash",n)));let o=s===""||n.pathname==="",i=o?"/":n.pathname,c;if(i==null)c=t;else{let h=e.length-1;if(!r&&i.startsWith("..")){let m=i.split("/");for(;m[0]==="..";)m.shift(),h-=1;n.pathname=m.join("/")}c=h>=0?e[h]:"/"}let l=co(n,c),d=i&&i!=="/"&&i.endsWith("/"),u=(o||i===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(d||u)&&(l.pathname+="/"),l}var be=s=>s.join("/").replace(/\/\/+/g,"/"),mo=s=>s.replace(/\/+$/,"").replace(/^\/*/,"/"),fo=s=>!s||s==="?"?"":s.startsWith("?")?s:"?"+s,po=s=>!s||s==="#"?"":s.startsWith("#")?s:"#"+s;function go(s){return s!=null&&typeof s.status=="number"&&typeof s.statusText=="string"&&typeof s.internal=="boolean"&&"data"in s}var Cs=["POST","PUT","PATCH","DELETE"];new Set(Cs);var yo=["GET",...Cs];new Set(yo);var Xe=f.createContext(null);Xe.displayName="DataRouter";var Rt=f.createContext(null);Rt.displayName="DataRouterState";f.createContext(!1);var $s=f.createContext({isTransitioning:!1});$s.displayName="ViewTransition";var xo=f.createContext(new Map);xo.displayName="Fetchers";var bo=f.createContext(null);bo.displayName="Await";var pe=f.createContext(null);pe.displayName="Navigation";var ct=f.createContext(null);ct.displayName="Location";var ge=f.createContext({outlet:null,matches:[],isDataRoute:!1});ge.displayName="Route";var xr=f.createContext(null);xr.displayName="RouteError";function wo(s,{relative:e}={}){J(dt(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:r}=f.useContext(pe),{hash:n,pathname:o,search:i}=ut(s,{relative:e}),c=o;return t!=="/"&&(c=o==="/"?t:be([t,o])),r.createHref({pathname:c,search:i,hash:n})}function dt(){return f.useContext(ct)!=null}function Se(){return J(dt(),"useLocation() may be used only in the context of a <Router> component."),f.useContext(ct).location}var Es="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Rs(s){f.useContext(pe).static||f.useLayoutEffect(s)}function It(){let{isDataRoute:s}=f.useContext(ge);return s?Io():vo()}function vo(){J(dt(),"useNavigate() may be used only in the context of a <Router> component.");let s=f.useContext(Xe),{basename:e,navigator:t}=f.useContext(pe),{matches:r}=f.useContext(ge),{pathname:n}=Se(),o=JSON.stringify(ks(r)),i=f.useRef(!1);return Rs(()=>{i.current=!0}),f.useCallback((l,d={})=>{if(me(i.current,Es),!i.current)return;if(typeof l=="number"){t.go(l);return}let u=Ts(l,JSON.parse(o),n,d.relative==="path");s==null&&e!=="/"&&(u.pathname=u.pathname==="/"?e:be([e,u.pathname])),(d.replace?t.replace:t.push)(u,d.state,d)},[e,t,o,n,s])}f.createContext(null);function Is(){let{matches:s}=f.useContext(ge),e=s[s.length-1];return e?e.params:{}}function ut(s,{relative:e}={}){let{matches:t}=f.useContext(ge),{pathname:r}=Se(),n=JSON.stringify(ks(t));return f.useMemo(()=>Ts(s,JSON.parse(n),r,e==="path"),[s,n,r,e])}function jo(s,e){return Os(s,e)}function Os(s,e,t,r){var w;J(dt(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:n}=f.useContext(pe),{matches:o}=f.useContext(ge),i=o[o.length-1],c=i?i.params:{},l=i?i.pathname:"/",d=i?i.pathnameBase:"/",u=i&&i.route;{let N=u&&u.path||"";As(l,!u||N.endsWith("*")||N.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${l}" (under <Route path="${N}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${N}"> to <Route path="${N==="/"?"*":`${N}/*`}">.`)}let h=Se(),m;if(e){let N=typeof e=="string"?Ye(e):e;J(d==="/"||((w=N.pathname)==null?void 0:w.startsWith(d)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${d}" but pathname "${N.pathname}" was given in the \`location\` prop.`),m=N}else m=h;let p=m.pathname||"/",g=p;if(d!=="/"){let N=d.replace(/^\//,"").split("/");g="/"+p.replace(/^\//,"").split("/").slice(N.length).join("/")}let x=Ns(s,{pathname:g});me(u||x!=null,`No routes matched location "${m.pathname}${m.search}${m.hash}" `),me(x==null||x[x.length-1].route.element!==void 0||x[x.length-1].route.Component!==void 0||x[x.length-1].route.lazy!==void 0,`Matched leaf route at location "${m.pathname}${m.search}${m.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let b=ko(x&&x.map(N=>Object.assign({},N,{params:Object.assign({},c,N.params),pathname:be([d,n.encodeLocation?n.encodeLocation(N.pathname).pathname:N.pathname]),pathnameBase:N.pathnameBase==="/"?d:be([d,n.encodeLocation?n.encodeLocation(N.pathnameBase).pathname:N.pathnameBase])})),o,t,r);return e&&b?f.createElement(ct.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...m},navigationType:"POP"}},b):b}function _o(){let s=Ro(),e=go(s)?`${s.status} ${s.statusText}`:s instanceof Error?s.message:JSON.stringify(s),t=s instanceof Error?s.stack:null,r="rgba(200,200,200, 0.5)",n={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},i=null;return console.error("Error handled by React Router default ErrorBoundary:",s),i=f.createElement(f.Fragment,null,f.createElement("p",null,"💿 Hey developer 👋"),f.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",f.createElement("code",{style:o},"ErrorBoundary")," or"," ",f.createElement("code",{style:o},"errorElement")," prop on your route.")),f.createElement(f.Fragment,null,f.createElement("h2",null,"Unexpected Application Error!"),f.createElement("h3",{style:{fontStyle:"italic"}},e),t?f.createElement("pre",{style:n},t):null,i)}var No=f.createElement(_o,null),Po=class extends f.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,e){return e.location!==s.location||e.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:e.error,location:e.location,revalidation:s.revalidation||e.revalidation}}componentDidCatch(s,e){console.error("React Router caught the following error during render",s,e)}render(){return this.state.error!==void 0?f.createElement(ge.Provider,{value:this.props.routeContext},f.createElement(xr.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function So({routeContext:s,match:e,children:t}){let r=f.useContext(Xe);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),f.createElement(ge.Provider,{value:s},t)}function ko(s,e=[],t=null,r=null){if(s==null){if(!t)return null;if(t.errors)s=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)s=t.matches;else return null}let n=s,o=t==null?void 0:t.errors;if(o!=null){let l=n.findIndex(d=>d.route.id&&(o==null?void 0:o[d.route.id])!==void 0);J(l>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),n=n.slice(0,Math.min(n.length,l+1))}let i=!1,c=-1;if(t)for(let l=0;l<n.length;l++){let d=n[l];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(c=l),d.route.id){let{loaderData:u,errors:h}=t,m=d.route.loader&&!u.hasOwnProperty(d.route.id)&&(!h||h[d.route.id]===void 0);if(d.route.lazy||m){i=!0,c>=0?n=n.slice(0,c+1):n=[n[0]];break}}}return n.reduceRight((l,d,u)=>{let h,m=!1,p=null,g=null;t&&(h=o&&d.route.id?o[d.route.id]:void 0,p=d.route.errorElement||No,i&&(c<0&&u===0?(As("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),m=!0,g=null):c===u&&(m=!0,g=d.route.hydrateFallbackElement||null)));let x=e.concat(n.slice(0,u+1)),b=()=>{let w;return h?w=p:m?w=g:d.route.Component?w=f.createElement(d.route.Component,null):d.route.element?w=d.route.element:w=l,f.createElement(So,{match:d,routeContext:{outlet:l,matches:x,isDataRoute:t!=null},children:w})};return t&&(d.route.ErrorBoundary||d.route.errorElement||u===0)?f.createElement(Po,{location:t.location,revalidation:t.revalidation,component:p,error:h,children:b(),routeContext:{outlet:null,matches:x,isDataRoute:!0}}):b()},null)}function br(s){return`${s} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function To(s){let e=f.useContext(Xe);return J(e,br(s)),e}function Co(s){let e=f.useContext(Rt);return J(e,br(s)),e}function $o(s){let e=f.useContext(ge);return J(e,br(s)),e}function wr(s){let e=$o(s),t=e.matches[e.matches.length-1];return J(t.route.id,`${s} can only be used on routes that contain a unique "id"`),t.route.id}function Eo(){return wr("useRouteId")}function Ro(){var r;let s=f.useContext(xr),e=Co("useRouteError"),t=wr("useRouteError");return s!==void 0?s:(r=e.errors)==null?void 0:r[t]}function Io(){let{router:s}=To("useNavigate"),e=wr("useNavigate"),t=f.useRef(!1);return Rs(()=>{t.current=!0}),f.useCallback(async(n,o={})=>{me(t.current,Es),t.current&&(typeof n=="number"?s.navigate(n):await s.navigate(n,{fromRouteId:e,...o}))},[s,e])}var Wr={};function As(s,e,t){!e&&!Wr[s]&&(Wr[s]=!0,me(!1,t))}f.memo(Oo);function Oo({routes:s,future:e,state:t}){return Os(s,void 0,t,e)}function Ge(s){J(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Ao({basename:s="/",children:e=null,location:t,navigationType:r="POP",navigator:n,static:o=!1}){J(!dt(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let i=s.replace(/^\/*/,"/"),c=f.useMemo(()=>({basename:i,navigator:n,static:o,future:{}}),[i,n,o]);typeof t=="string"&&(t=Ye(t));let{pathname:l="/",search:d="",hash:u="",state:h=null,key:m="default"}=t,p=f.useMemo(()=>{let g=we(l,i);return g==null?null:{location:{pathname:g,search:d,hash:u,state:h,key:m},navigationType:r}},[i,l,d,u,h,m,r]);return me(p!=null,`<Router basename="${i}"> is not able to match the URL "${l}${d}${u}" because it does not start with the basename, so the <Router> won't render anything.`),p==null?null:f.createElement(pe.Provider,{value:c},f.createElement(ct.Provider,{children:e,value:p}))}function Lo({children:s,location:e}){return jo(ar(s),e)}function ar(s,e=[]){let t=[];return f.Children.forEach(s,(r,n)=>{if(!f.isValidElement(r))return;let o=[...e,n];if(r.type===f.Fragment){t.push.apply(t,ar(r.props.children,o));return}J(r.type===Ge,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),J(!r.props.index||!r.props.children,"An index route cannot have child routes.");let i={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(i.children=ar(r.props.children,o)),t.push(i)}),t}var _t="get",Nt="application/x-www-form-urlencoded";function Ot(s){return s!=null&&typeof s.tagName=="string"}function Bo(s){return Ot(s)&&s.tagName.toLowerCase()==="button"}function Mo(s){return Ot(s)&&s.tagName.toLowerCase()==="form"}function Uo(s){return Ot(s)&&s.tagName.toLowerCase()==="input"}function Do(s){return!!(s.metaKey||s.altKey||s.ctrlKey||s.shiftKey)}function Fo(s,e){return s.button===0&&(!e||e==="_self")&&!Do(s)}function ir(s=""){return new URLSearchParams(typeof s=="string"||Array.isArray(s)||s instanceof URLSearchParams?s:Object.keys(s).reduce((e,t)=>{let r=s[t];return e.concat(Array.isArray(r)?r.map(n=>[t,n]):[[t,r]])},[]))}function Go(s,e){let t=ir(s);return e&&e.forEach((r,n)=>{t.has(n)||e.getAll(n).forEach(o=>{t.append(n,o)})}),t}var gt=null;function Ho(){if(gt===null)try{new FormData(document.createElement("form"),0),gt=!1}catch{gt=!0}return gt}var qo=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Vt(s){return s!=null&&!qo.has(s)?(me(!1,`"${s}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Nt}"`),null):s}function zo(s,e){let t,r,n,o,i;if(Mo(s)){let c=s.getAttribute("action");r=c?we(c,e):null,t=s.getAttribute("method")||_t,n=Vt(s.getAttribute("enctype"))||Nt,o=new FormData(s)}else if(Bo(s)||Uo(s)&&(s.type==="submit"||s.type==="image")){let c=s.form;if(c==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=s.getAttribute("formaction")||c.getAttribute("action");if(r=l?we(l,e):null,t=s.getAttribute("formmethod")||c.getAttribute("method")||_t,n=Vt(s.getAttribute("formenctype"))||Vt(c.getAttribute("enctype"))||Nt,o=new FormData(c,s),!Ho()){let{name:d,type:u,value:h}=s;if(u==="image"){let m=d?`${d}.`:"";o.append(`${m}x`,"0"),o.append(`${m}y`,"0")}else d&&o.append(d,h)}}else{if(Ot(s))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=_t,r=null,n=Nt,i=s}return o&&n==="text/plain"&&(i=o,o=void 0),{action:r,method:t.toLowerCase(),encType:n,formData:o,body:i}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function vr(s,e){if(s===!1||s===null||typeof s>"u")throw new Error(e)}function Vo(s,e,t){let r=typeof s=="string"?new URL(s,typeof window>"u"?"server://singlefetch/":window.location.origin):s;return r.pathname==="/"?r.pathname=`_root.${t}`:e&&we(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${t}`,r}async function Wo(s,e){if(s.id in e)return e[s.id];try{let t=await Ke(()=>import(s.module),[]);return e[s.id]=t,t}catch(t){return console.error(`Error loading route module \`${s.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Jo(s){return s!=null&&typeof s.page=="string"}function Ko(s){return s==null?!1:s.href==null?s.rel==="preload"&&typeof s.imageSrcSet=="string"&&typeof s.imageSizes=="string":typeof s.rel=="string"&&typeof s.href=="string"}async function Yo(s,e,t){let r=await Promise.all(s.map(async n=>{let o=e.routes[n.route.id];if(o){let i=await Wo(o,t);return i.links?i.links():[]}return[]}));return ea(r.flat(1).filter(Ko).filter(n=>n.rel==="stylesheet"||n.rel==="preload").map(n=>n.rel==="stylesheet"?{...n,rel:"prefetch",as:"style"}:{...n,rel:"prefetch"}))}function Jr(s,e,t,r,n,o){let i=(l,d)=>t[d]?l.route.id!==t[d].route.id:!0,c=(l,d)=>{var u;return t[d].pathname!==l.pathname||((u=t[d].route.path)==null?void 0:u.endsWith("*"))&&t[d].params["*"]!==l.params["*"]};return o==="assets"?e.filter((l,d)=>i(l,d)||c(l,d)):o==="data"?e.filter((l,d)=>{var h;let u=r.routes[l.route.id];if(!u||!u.hasLoader)return!1;if(i(l,d)||c(l,d))return!0;if(l.route.shouldRevalidate){let m=l.route.shouldRevalidate({currentUrl:new URL(n.pathname+n.search+n.hash,window.origin),currentParams:((h=t[0])==null?void 0:h.params)||{},nextUrl:new URL(s,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof m=="boolean")return m}return!0}):[]}function Xo(s,e,{includeHydrateFallback:t}={}){return Zo(s.map(r=>{let n=e.routes[r.route.id];if(!n)return[];let o=[n.module];return n.clientActionModule&&(o=o.concat(n.clientActionModule)),n.clientLoaderModule&&(o=o.concat(n.clientLoaderModule)),t&&n.hydrateFallbackModule&&(o=o.concat(n.hydrateFallbackModule)),n.imports&&(o=o.concat(n.imports)),o}).flat(1))}function Zo(s){return[...new Set(s)]}function Qo(s){let e={},t=Object.keys(s).sort();for(let r of t)e[r]=s[r];return e}function ea(s,e){let t=new Set,r=new Set(e);return s.reduce((n,o)=>{if(e&&!Jo(o)&&o.as==="script"&&o.href&&r.has(o.href))return n;let c=JSON.stringify(Qo(o));return t.has(c)||(t.add(c),n.push({key:c,link:o})),n},[])}function Ls(){let s=f.useContext(Xe);return vr(s,"You must render this element inside a <DataRouterContext.Provider> element"),s}function ta(){let s=f.useContext(Rt);return vr(s,"You must render this element inside a <DataRouterStateContext.Provider> element"),s}var jr=f.createContext(void 0);jr.displayName="FrameworkContext";function Bs(){let s=f.useContext(jr);return vr(s,"You must render this element inside a <HydratedRouter> element"),s}function ra(s,e){let t=f.useContext(jr),[r,n]=f.useState(!1),[o,i]=f.useState(!1),{onFocus:c,onBlur:l,onMouseEnter:d,onMouseLeave:u,onTouchStart:h}=e,m=f.useRef(null);f.useEffect(()=>{if(s==="render"&&i(!0),s==="viewport"){let x=w=>{w.forEach(N=>{i(N.isIntersecting)})},b=new IntersectionObserver(x,{threshold:.5});return m.current&&b.observe(m.current),()=>{b.disconnect()}}},[s]),f.useEffect(()=>{if(r){let x=setTimeout(()=>{i(!0)},100);return()=>{clearTimeout(x)}}},[r]);let p=()=>{n(!0)},g=()=>{n(!1),i(!1)};return t?s!=="intent"?[o,m,{}]:[o,m,{onFocus:et(c,p),onBlur:et(l,g),onMouseEnter:et(d,p),onMouseLeave:et(u,g),onTouchStart:et(h,p)}]:[!1,m,{}]}function et(s,e){return t=>{s&&s(t),t.defaultPrevented||e(t)}}function sa({page:s,...e}){let{router:t}=Ls(),r=f.useMemo(()=>Ns(t.routes,s,t.basename),[t.routes,s,t.basename]);return r?f.createElement(oa,{page:s,matches:r,...e}):null}function na(s){let{manifest:e,routeModules:t}=Bs(),[r,n]=f.useState([]);return f.useEffect(()=>{let o=!1;return Yo(s,e,t).then(i=>{o||n(i)}),()=>{o=!0}},[s,e,t]),r}function oa({page:s,matches:e,...t}){let r=Se(),{manifest:n,routeModules:o}=Bs(),{basename:i}=Ls(),{loaderData:c,matches:l}=ta(),d=f.useMemo(()=>Jr(s,e,l,n,r,"data"),[s,e,l,n,r]),u=f.useMemo(()=>Jr(s,e,l,n,r,"assets"),[s,e,l,n,r]),h=f.useMemo(()=>{if(s===r.pathname+r.search+r.hash)return[];let g=new Set,x=!1;if(e.forEach(w=>{var y;let N=n.routes[w.route.id];!N||!N.hasLoader||(!d.some(j=>j.route.id===w.route.id)&&w.route.id in c&&((y=o[w.route.id])!=null&&y.shouldRevalidate)||N.hasClientLoader?x=!0:g.add(w.route.id))}),g.size===0)return[];let b=Vo(s,i,"data");return x&&g.size>0&&b.searchParams.set("_routes",e.filter(w=>g.has(w.route.id)).map(w=>w.route.id).join(",")),[b.pathname+b.search]},[i,c,r,n,d,e,s,o]),m=f.useMemo(()=>Xo(u,n),[u,n]),p=na(u);return f.createElement(f.Fragment,null,h.map(g=>f.createElement("link",{key:g,rel:"prefetch",as:"fetch",href:g,...t})),m.map(g=>f.createElement("link",{key:g,rel:"modulepreload",href:g,...t})),p.map(({key:g,link:x})=>f.createElement("link",{key:g,...x})))}function aa(...s){return e=>{s.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var Ms=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Ms&&(window.__reactRouterVersion="7.7.1")}catch{}function ia({basename:s,children:e,window:t}){let r=f.useRef();r.current==null&&(r.current=Vn({window:t,v5Compat:!0}));let n=r.current,[o,i]=f.useState({action:n.action,location:n.location}),c=f.useCallback(l=>{f.startTransition(()=>i(l))},[i]);return f.useLayoutEffect(()=>n.listen(c),[n,c]),f.createElement(Ao,{basename:s,children:e,location:o.location,navigationType:o.action,navigator:n})}var Us=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ds=f.forwardRef(function({onClick:e,discover:t="render",prefetch:r="none",relative:n,reloadDocument:o,replace:i,state:c,target:l,to:d,preventScrollReset:u,viewTransition:h,...m},p){let{basename:g}=f.useContext(pe),x=typeof d=="string"&&Us.test(d),b,w=!1;if(typeof d=="string"&&x&&(b=d,Ms))try{let L=new URL(window.location.href),q=d.startsWith("//")?new URL(L.protocol+d):new URL(d),M=we(q.pathname,g);q.origin===L.origin&&M!=null?d=M+q.search+q.hash:w=!0}catch{me(!1,`<Link to="${d}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let N=wo(d,{relative:n}),[y,j,S]=ra(r,m),k=ua(d,{replace:i,state:c,target:l,preventScrollReset:u,relative:n,viewTransition:h});function $(L){e&&e(L),L.defaultPrevented||k(L)}let F=f.createElement("a",{...m,...S,href:b||N,onClick:w||o?e:$,ref:aa(p,j),target:l,"data-discover":!x&&t==="render"?"true":void 0});return y&&!x?f.createElement(f.Fragment,null,F,f.createElement(sa,{page:N})):F});Ds.displayName="Link";var la=f.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:r="",end:n=!1,style:o,to:i,viewTransition:c,children:l,...d},u){let h=ut(i,{relative:d.relative}),m=Se(),p=f.useContext(Rt),{navigator:g,basename:x}=f.useContext(pe),b=p!=null&&ya(h)&&c===!0,w=g.encodeLocation?g.encodeLocation(h).pathname:h.pathname,N=m.pathname,y=p&&p.navigation&&p.navigation.location?p.navigation.location.pathname:null;t||(N=N.toLowerCase(),y=y?y.toLowerCase():null,w=w.toLowerCase()),y&&x&&(y=we(y,x)||y);const j=w!=="/"&&w.endsWith("/")?w.length-1:w.length;let S=N===w||!n&&N.startsWith(w)&&N.charAt(j)==="/",k=y!=null&&(y===w||!n&&y.startsWith(w)&&y.charAt(w.length)==="/"),$={isActive:S,isPending:k,isTransitioning:b},F=S?e:void 0,L;typeof r=="function"?L=r($):L=[r,S?"active":null,k?"pending":null,b?"transitioning":null].filter(Boolean).join(" ");let q=typeof o=="function"?o($):o;return f.createElement(Ds,{...d,"aria-current":F,className:L,ref:u,style:q,to:i,viewTransition:c},typeof l=="function"?l($):l)});la.displayName="NavLink";var ca=f.forwardRef(({discover:s="render",fetcherKey:e,navigate:t,reloadDocument:r,replace:n,state:o,method:i=_t,action:c,onSubmit:l,relative:d,preventScrollReset:u,viewTransition:h,...m},p)=>{let g=pa(),x=ga(c,{relative:d}),b=i.toLowerCase()==="get"?"get":"post",w=typeof c=="string"&&Us.test(c),N=y=>{if(l&&l(y),y.defaultPrevented)return;y.preventDefault();let j=y.nativeEvent.submitter,S=(j==null?void 0:j.getAttribute("formmethod"))||i;g(j||y.currentTarget,{fetcherKey:e,method:S,navigate:t,replace:n,state:o,relative:d,preventScrollReset:u,viewTransition:h})};return f.createElement("form",{ref:p,method:b,action:x,onSubmit:r?l:N,...m,"data-discover":!w&&s==="render"?"true":void 0})});ca.displayName="Form";function da(s){return`${s} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Fs(s){let e=f.useContext(Xe);return J(e,da(s)),e}function ua(s,{target:e,replace:t,state:r,preventScrollReset:n,relative:o,viewTransition:i}={}){let c=It(),l=Se(),d=ut(s,{relative:o});return f.useCallback(u=>{if(Fo(u,e)){u.preventDefault();let h=t!==void 0?t:it(l)===it(d);c(s,{replace:h,state:r,preventScrollReset:n,relative:o,viewTransition:i})}},[l,c,d,t,r,e,s,n,o,i])}function ha(s){me(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=f.useRef(ir(s)),t=f.useRef(!1),r=Se(),n=f.useMemo(()=>Go(r.search,t.current?null:e.current),[r.search]),o=It(),i=f.useCallback((c,l)=>{const d=ir(typeof c=="function"?c(new URLSearchParams(n)):c);t.current=!0,o("?"+d,l)},[o,n]);return[n,i]}var ma=0,fa=()=>`__${String(++ma)}__`;function pa(){let{router:s}=Fs("useSubmit"),{basename:e}=f.useContext(pe),t=Eo();return f.useCallback(async(r,n={})=>{let{action:o,method:i,encType:c,formData:l,body:d}=zo(r,e);if(n.navigate===!1){let u=n.fetcherKey||fa();await s.fetch(u,t,n.action||o,{preventScrollReset:n.preventScrollReset,formData:l,body:d,formMethod:n.method||i,formEncType:n.encType||c,flushSync:n.flushSync})}else await s.navigate(n.action||o,{preventScrollReset:n.preventScrollReset,formData:l,body:d,formMethod:n.method||i,formEncType:n.encType||c,replace:n.replace,state:n.state,fromRouteId:t,flushSync:n.flushSync,viewTransition:n.viewTransition})},[s,e,t])}function ga(s,{relative:e}={}){let{basename:t}=f.useContext(pe),r=f.useContext(ge);J(r,"useFormAction must be used inside a RouteContext");let[n]=r.matches.slice(-1),o={...ut(s||".",{relative:e})},i=Se();if(s==null){o.search=i.search;let c=new URLSearchParams(o.search),l=c.getAll("index");if(l.some(u=>u==="")){c.delete("index"),l.filter(h=>h).forEach(h=>c.append("index",h));let u=c.toString();o.search=u?`?${u}`:""}}return(!s||s===".")&&n.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(o.pathname=o.pathname==="/"?t:be([t,o.pathname])),it(o)}function ya(s,{relative:e}={}){let t=f.useContext($s);J(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=Fs("useViewTransitionState"),n=ut(s,{relative:e});if(!t.isTransitioning)return!1;let o=we(t.currentLocation.pathname,r)||t.currentLocation.pathname,i=we(t.nextLocation.pathname,r)||t.nextLocation.pathname;return kt(n.pathname,i)!=null||kt(n.pathname,o)!=null}const xa=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>Ke(()=>Promise.resolve().then(()=>Ze),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class _r extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class ba extends _r{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Kr extends _r{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Yr extends _r{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var lr;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(lr||(lr={}));var wa=globalThis&&globalThis.__awaiter||function(s,e,t,r){function n(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function c(u){try{d(r.next(u))}catch(h){i(h)}}function l(u){try{d(r.throw(u))}catch(h){i(h)}}function d(u){u.done?o(u.value):n(u.value).then(c,l)}d((r=r.apply(s,e||[])).next())})};class va{constructor(e,{headers:t={},customFetch:r,region:n=lr.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=xa(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return wa(this,void 0,void 0,function*(){try{const{headers:n,method:o,body:i}=t;let c={},{region:l}=t;l||(l=this.region);const d=new URL(`${this.url}/${e}`);l&&l!=="any"&&(c["x-region"]=l,d.searchParams.set("forceFunctionRegion",l));let u;i&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&i instanceof Blob||i instanceof ArrayBuffer?(c["Content-Type"]="application/octet-stream",u=i):typeof i=="string"?(c["Content-Type"]="text/plain",u=i):typeof FormData<"u"&&i instanceof FormData?u=i:(c["Content-Type"]="application/json",u=JSON.stringify(i)));const h=yield this.fetch(d.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},c),this.headers),n),body:u}).catch(x=>{throw new ba(x)}),m=h.headers.get("x-relay-error");if(m&&m==="true")throw new Kr(h);if(!h.ok)throw new Yr(h);let p=((r=h.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),g;return p==="application/json"?g=yield h.json():p==="application/octet-stream"?g=yield h.blob():p==="text/event-stream"?g=h:p==="multipart/form-data"?g=yield h.formData():g=yield h.text(),{data:g,error:null,response:h}}catch(n){return{data:null,error:n,response:n instanceof Yr||n instanceof Kr?n.context:void 0}}})}}var ie={},Nr={},At={},ht={},Lt={},Bt={},ja=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Ve=ja();const _a=Ve.fetch,Gs=Ve.fetch.bind(Ve),Hs=Ve.Headers,Na=Ve.Request,Pa=Ve.Response,Ze=Object.freeze(Object.defineProperty({__proto__:null,Headers:Hs,Request:Na,Response:Pa,default:Gs,fetch:_a},Symbol.toStringTag,{value:"Module"})),Sa=xn(Ze);var Mt={};Object.defineProperty(Mt,"__esModule",{value:!0});let ka=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Mt.default=ka;var qs=ce&&ce.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Bt,"__esModule",{value:!0});const Ta=qs(Sa),Ca=qs(Mt);let $a=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Ta.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let n=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async o=>{var i,c,l;let d=null,u=null,h=null,m=o.status,p=o.statusText;if(o.ok){if(this.method!=="HEAD"){const w=await o.text();w===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=w:u=JSON.parse(w))}const x=(i=this.headers.Prefer)===null||i===void 0?void 0:i.match(/count=(exact|planned|estimated)/),b=(c=o.headers.get("content-range"))===null||c===void 0?void 0:c.split("/");x&&b&&b.length>1&&(h=parseInt(b[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(d={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,h=null,m=406,p="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const x=await o.text();try{d=JSON.parse(x),Array.isArray(d)&&o.status===404&&(u=[],d=null,m=200,p="OK")}catch{o.status===404&&x===""?(m=204,p="No Content"):d={message:x}}if(d&&this.isMaybeSingle&&(!((l=d==null?void 0:d.details)===null||l===void 0)&&l.includes("0 rows"))&&(d=null,m=200,p="OK"),d&&this.shouldThrowOnError)throw new Ca.default(d)}return{error:d,data:u,count:h,status:m,statusText:p}});return this.shouldThrowOnError||(n=n.catch(o=>{var i,c,l;return{error:{message:`${(i=o==null?void 0:o.name)!==null&&i!==void 0?i:"FetchError"}: ${o==null?void 0:o.message}`,details:`${(c=o==null?void 0:o.stack)!==null&&c!==void 0?c:""}`,hint:"",code:`${(l=o==null?void 0:o.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}returns(){return this}overrideTypes(){return this}};Bt.default=$a;var Ea=ce&&ce.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Lt,"__esModule",{value:!0});const Ra=Ea(Bt);let Ia=class extends Ra.default{select(e){let t=!1;const r=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:n,referencedTable:o=n}={}){const i=o?`${o}.order`:"order",c=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${c?`${c},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const n=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:n=r}={}){const o=typeof n>"u"?"offset":`${n}.offset`,i=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(o,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:n=!1,wal:o=!1,format:i="text"}={}){var c;const l=[e?"analyze":null,t?"verbose":null,r?"settings":null,n?"buffers":null,o?"wal":null].filter(Boolean).join("|"),d=(c=this.headers.Accept)!==null&&c!==void 0?c:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${i}; for="${d}"; options=${l};`,i==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Lt.default=Ia;var Oa=ce&&ce.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(ht,"__esModule",{value:!0});const Aa=Oa(Lt);let La=class extends Aa.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:n}={}){let o="";n==="plain"?o="pl":n==="phrase"?o="ph":n==="websearch"&&(o="w");const i=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${o}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const n=r?`${r}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};ht.default=La;var Ba=ce&&ce.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(At,"__esModule",{value:!0});const tt=Ba(ht);let Ma=class{constructor(e,{headers:t={},schema:r,fetch:n}){this.url=e,this.headers=t,this.schema=r,this.fetch=n}select(e,{head:t=!1,count:r}={}){const n=t?"HEAD":"GET";let o=!1;const i=(e??"*").split("").map(c=>/\s/.test(c)&&!o?"":(c==='"'&&(o=!o),c)).join("");return this.url.searchParams.set("select",i),r&&(this.headers.Prefer=`count=${r}`),new tt.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const n="POST",o=[];if(this.headers.Prefer&&o.push(this.headers.Prefer),t&&o.push(`count=${t}`),r||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const i=e.reduce((c,l)=>c.concat(Object.keys(l)),[]);if(i.length>0){const c=[...new Set(i)].map(l=>`"${l}"`);this.url.searchParams.set("columns",c.join(","))}}return new tt.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:n,defaultToNull:o=!0}={}){const i="POST",c=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&c.push(this.headers.Prefer),n&&c.push(`count=${n}`),o||c.push("missing=default"),this.headers.Prefer=c.join(","),Array.isArray(e)){const l=e.reduce((d,u)=>d.concat(Object.keys(u)),[]);if(l.length>0){const d=[...new Set(l)].map(u=>`"${u}"`);this.url.searchParams.set("columns",d.join(","))}}return new tt.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),this.headers.Prefer=n.join(","),new tt.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new tt.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};At.default=Ma;var Ut={},Dt={};Object.defineProperty(Dt,"__esModule",{value:!0});Dt.version=void 0;Dt.version="0.0.0-automated";Object.defineProperty(Ut,"__esModule",{value:!0});Ut.DEFAULT_HEADERS=void 0;const Ua=Dt;Ut.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Ua.version}`};var zs=ce&&ce.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Nr,"__esModule",{value:!0});const Da=zs(At),Fa=zs(ht),Ga=Ut;let Ha=class Vs{constructor(e,{headers:t={},schema:r,fetch:n}={}){this.url=e,this.headers=Object.assign(Object.assign({},Ga.DEFAULT_HEADERS),t),this.schemaName=r,this.fetch=n}from(e){const t=new URL(`${this.url}/${e}`);return new Da.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Vs(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:n=!1,count:o}={}){let i;const c=new URL(`${this.url}/rpc/${e}`);let l;r||n?(i=r?"HEAD":"GET",Object.entries(t).filter(([u,h])=>h!==void 0).map(([u,h])=>[u,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([u,h])=>{c.searchParams.append(u,h)})):(i="POST",l=t);const d=Object.assign({},this.headers);return o&&(d.Prefer=`count=${o}`),new Fa.default({method:i,url:c,headers:d,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}};Nr.default=Ha;var Qe=ce&&ce.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(ie,"__esModule",{value:!0});ie.PostgrestError=ie.PostgrestBuilder=ie.PostgrestTransformBuilder=ie.PostgrestFilterBuilder=ie.PostgrestQueryBuilder=ie.PostgrestClient=void 0;const Ws=Qe(Nr);ie.PostgrestClient=Ws.default;const Js=Qe(At);ie.PostgrestQueryBuilder=Js.default;const Ks=Qe(ht);ie.PostgrestFilterBuilder=Ks.default;const Ys=Qe(Lt);ie.PostgrestTransformBuilder=Ys.default;const Xs=Qe(Bt);ie.PostgrestBuilder=Xs.default;const Zs=Qe(Mt);ie.PostgrestError=Zs.default;var qa=ie.default={PostgrestClient:Ws.default,PostgrestQueryBuilder:Js.default,PostgrestFilterBuilder:Ks.default,PostgrestTransformBuilder:Ys.default,PostgrestBuilder:Xs.default,PostgrestError:Zs.default};const{PostgrestClient:za,PostgrestQueryBuilder:ed,PostgrestFilterBuilder:td,PostgrestTransformBuilder:rd,PostgrestBuilder:sd,PostgrestError:nd}=qa;function Va(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const Wa=Va(),Ja="2.11.15",Ka=`realtime-js/${Ja}`,Ya="1.0.0",Qs=1e4,Xa=1e3;var nt;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(nt||(nt={}));var te;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(te||(te={}));var he;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(he||(he={}));var cr;(function(s){s.websocket="websocket"})(cr||(cr={}));var Re;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(Re||(Re={}));class Za{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const n=t.getUint8(1),o=t.getUint8(2);let i=this.HEADER_LENGTH+2;const c=r.decode(e.slice(i,i+n));i=i+n;const l=r.decode(e.slice(i,i+o));i=i+o;const d=JSON.parse(r.decode(e.slice(i,e.byteLength)));return{ref:null,topic:c,event:l,payload:d}}}class en{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var W;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(W||(W={}));const Xr=(s,e,t={})=>{var r;const n=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((o,i)=>(o[i]=Qa(i,s,e,n),o),{})},Qa=(s,e,t,r)=>{const n=e.find(c=>c.name===s),o=n==null?void 0:n.type,i=t[s];return o&&!r.includes(o)?tn(o,i):dr(i)},tn=(s,e)=>{if(s.charAt(0)==="_"){const t=s.slice(1,s.length);return si(e,t)}switch(s){case W.bool:return ei(e);case W.float4:case W.float8:case W.int2:case W.int4:case W.int8:case W.numeric:case W.oid:return ti(e);case W.json:case W.jsonb:return ri(e);case W.timestamp:return ni(e);case W.abstime:case W.date:case W.daterange:case W.int4range:case W.int8range:case W.money:case W.reltime:case W.text:case W.time:case W.timestamptz:case W.timetz:case W.tsrange:case W.tstzrange:return dr(e);default:return dr(e)}},dr=s=>s,ei=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},ti=s=>{if(typeof s=="string"){const e=parseFloat(s);if(!Number.isNaN(e))return e}return s},ri=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch(e){return console.log(`JSON parse error: ${e}`),s}return s},si=(s,e)=>{if(typeof s!="string")return s;const t=s.length-1,r=s[t];if(s[0]==="{"&&r==="}"){let o;const i=s.slice(1,t);try{o=JSON.parse("["+i+"]")}catch{o=i?i.split(","):[]}return o.map(c=>tn(e,c))}return s},ni=s=>typeof s=="string"?s.replace(" ","T"):s,rn=s=>{let e=s;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Wt{constructor(e,t,r={},n=Qs){this.channel=e,this.event=t,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Zr;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(Zr||(Zr={}));class ot{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},n=>{const{onJoin:o,onLeave:i,onSync:c}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ot.syncState(this.state,n,o,i),this.pendingDiffs.forEach(l=>{this.state=ot.syncDiff(this.state,l,o,i)}),this.pendingDiffs=[],c()}),this.channel._on(r.diff,{},n=>{const{onJoin:o,onLeave:i,onSync:c}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=ot.syncDiff(this.state,n,o,i),c())}),this.onJoin((n,o,i)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:o,newPresences:i})}),this.onLeave((n,o,i)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:o,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,n){const o=this.cloneDeep(e),i=this.transformState(t),c={},l={};return this.map(o,(d,u)=>{i[d]||(l[d]=u)}),this.map(i,(d,u)=>{const h=o[d];if(h){const m=u.map(b=>b.presence_ref),p=h.map(b=>b.presence_ref),g=u.filter(b=>p.indexOf(b.presence_ref)<0),x=h.filter(b=>m.indexOf(b.presence_ref)<0);g.length>0&&(c[d]=g),x.length>0&&(l[d]=x)}else c[d]=u}),this.syncDiff(o,{joins:c,leaves:l},r,n)}static syncDiff(e,t,r,n){const{joins:o,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(o,(c,l)=>{var d;const u=(d=e[c])!==null&&d!==void 0?d:[];if(e[c]=this.cloneDeep(l),u.length>0){const h=e[c].map(p=>p.presence_ref),m=u.filter(p=>h.indexOf(p.presence_ref)<0);e[c].unshift(...m)}r(c,u,l)}),this.map(i,(c,l)=>{let d=e[c];if(!d)return;const u=l.map(h=>h.presence_ref);d=d.filter(h=>u.indexOf(h.presence_ref)<0),e[c]=d,n(c,d,l),d.length===0&&delete e[c]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const n=e[r];return"metas"in n?t[r]=n.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):t[r]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Qr;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(Qr||(Qr={}));var es;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(es||(es={}));var xe;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(xe||(xe={}));class Pr{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=te.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Wt(this,he.join,this.params,this.timeout),this.rejoinTimer=new en(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=te.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=te.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=te.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=te.errored,this.rejoinTimer.scheduleTimeout())}),this._on(he.reply,{},(n,o)=>{this._trigger(this._replyEventName(o),n)}),this.presence=new ot(this),this.broadcastEndpointURL=rn(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,n;if(this.socket.isConnected()||this.socket.connect(),this.state==te.closed){const{config:{broadcast:o,presence:i,private:c}}=this.params;this._onError(u=>e==null?void 0:e(xe.CHANNEL_ERROR,u)),this._onClose(()=>e==null?void 0:e(xe.CLOSED));const l={},d={broadcast:o,presence:i,postgres_changes:(n=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&n!==void 0?n:[],private:c};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:d},l)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:u})=>{var h;if(this.socket.setAuth(),u===void 0){e==null||e(xe.SUBSCRIBED);return}else{const m=this.bindings.postgres_changes,p=(h=m==null?void 0:m.length)!==null&&h!==void 0?h:0,g=[];for(let x=0;x<p;x++){const b=m[x],{filter:{event:w,schema:N,table:y,filter:j}}=b,S=u&&u[x];if(S&&S.event===w&&S.schema===N&&S.table===y&&S.filter===j)g.push(Object.assign(Object.assign({},b),{id:S.id}));else{this.unsubscribe(),this.state=te.errored,e==null||e(xe.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e(xe.SUBSCRIBED);return}}).receive("error",u=>{this.state=te.errored,e==null||e(xe.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(xe.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,n;if(!this._canPush()&&e.type==="broadcast"){const{event:o,payload:i}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:i,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((n=d.body)===null||n===void 0?void 0:n.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var i,c,l;const d=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(c=(i=this.params)===null||i===void 0?void 0:i.config)===null||c===void 0?void 0:c.broadcast)===null||l===void 0)&&l.ack)&&o("ok"),d.receive("ok",()=>o("ok")),d.receive("error",()=>o("error")),d.receive("timeout",()=>o("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=te.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(he.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(n=>{r=new Wt(this,he.leave,{},e),r.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,r){const n=new AbortController,o=setTimeout(()=>n.abort(),r),i=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(o),i}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Wt(this,e,t,r);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var n,o;const i=e.toLocaleLowerCase(),{close:c,error:l,leave:d,join:u}=he;if(r&&[c,l,d,u].indexOf(i)>=0&&r!==this._joinRef())return;let m=this._onMessage(i,t,r);if(t&&!m)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(p=>{var g,x,b;return((g=p.filter)===null||g===void 0?void 0:g.event)==="*"||((b=(x=p.filter)===null||x===void 0?void 0:x.event)===null||b===void 0?void 0:b.toLocaleLowerCase())===i}).map(p=>p.callback(m,r)):(o=this.bindings[i])===null||o===void 0||o.filter(p=>{var g,x,b,w,N,y;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in p){const j=p.id,S=(g=p.filter)===null||g===void 0?void 0:g.event;return j&&((x=t.ids)===null||x===void 0?void 0:x.includes(j))&&(S==="*"||(S==null?void 0:S.toLocaleLowerCase())===((b=t.data)===null||b===void 0?void 0:b.type.toLocaleLowerCase()))}else{const j=(N=(w=p==null?void 0:p.filter)===null||w===void 0?void 0:w.event)===null||N===void 0?void 0:N.toLocaleLowerCase();return j==="*"||j===((y=t==null?void 0:t.event)===null||y===void 0?void 0:y.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===i}).map(p=>{if(typeof m=="object"&&"ids"in m){const g=m.data,{schema:x,table:b,commit_timestamp:w,type:N,errors:y}=g;m=Object.assign(Object.assign({},{schema:x,table:b,commit_timestamp:w,eventType:N,new:{},old:{},errors:y}),this._getPayloadRecords(g))}p.callback(m,r)})}_isClosed(){return this.state===te.closed}_isJoined(){return this.state===te.joined}_isJoining(){return this.state===te.joining}_isLeaving(){return this.state===te.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const n=e.toLocaleLowerCase(),o={type:n,filter:t,callback:r};return this.bindings[n]?this.bindings[n].push(o):this.bindings[n]=[o],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(n=>{var o;return!(((o=n.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===r&&Pr.isEqual(n.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(he.close,{},e)}_onError(e){this._on(he.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=te.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Xr(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Xr(e.columns,e.old_record)),t}}const ts=()=>{},oi=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class ai{constructor(e,t){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Qs,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=ts,this.ref=0,this.logger=ts,this.conn=null,this.sendBuffer=[],this.serializer=new Za,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=o=>{let i;return o?i=o:typeof fetch>"u"?i=(...c)=>Ke(()=>Promise.resolve().then(()=>Ze),void 0).then(({default:l})=>l(...c)):i=fetch,(...c)=>i(...c)},this.endPoint=`${e}/${cr.websocket}`,this.httpEndpoint=rn(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const n=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.apikey;if(n&&(this.accessTokenValue=n,this.apiKey=n),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:o=>[1e3,2e3,5e3,1e4][o-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(o,i)=>i(JSON.stringify(o)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new en(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=Wa),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Ya}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(r=>r.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case nt.connecting:return Re.Connecting;case nt.open:return Re.Open;case nt.closing:return Re.Closing;default:return Re.Closed}}isConnected(){return this.connectionState()===Re.Open}channel(e,t={config:{}}){const r=`realtime:${e}`,n=this.getChannels().find(o=>o.topic===r);if(n)return n;{const o=new Pr(`realtime:${e}`,t,this);return this.channels.push(o),o}}push(e){const{topic:t,event:r,payload:n,ref:o}=e,i=()=>{this.encode(e,c=>{var l;(l=this.conn)===null||l===void 0||l.send(c)})};this.log("push",`${t} ${r} (${o})`,n),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const n={access_token:t,version:Ka};t&&r.updateJoinPayload(n),r.joinedOnce&&r._isJoined()&&r._push(he.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(Xa,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:n,payload:o,ref:i}=t;r==="phoenix"&&n==="phx_reply"&&this.heartbeatCallback(t.payload.status=="ok"?"ok":"error"),i&&i===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${o.status||""} ${r} ${n} ${i&&"("+i+")"||""}`,o),Array.from(this.channels).filter(c=>c._isMember(r)).forEach(c=>c._trigger(n,o,i)),this.stateChangeCallbacks.message.forEach(c=>c(t))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(he.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${r}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([oi],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}}class Sr extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Q(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}class ii extends Sr{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class ur extends Sr{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var li=globalThis&&globalThis.__awaiter||function(s,e,t,r){function n(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function c(u){try{d(r.next(u))}catch(h){i(h)}}function l(u){try{d(r.throw(u))}catch(h){i(h)}}function d(u){u.done?o(u.value):n(u.value).then(c,l)}d((r=r.apply(s,e||[])).next())})};const sn=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>Ke(()=>Promise.resolve().then(()=>Ze),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},ci=()=>li(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Ke(()=>Promise.resolve().then(()=>Ze),void 0)).Response:Response}),hr=s=>{if(Array.isArray(s))return s.map(t=>hr(t));if(typeof s=="function"||s!==Object(s))return s;const e={};return Object.entries(s).forEach(([t,r])=>{const n=t.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));e[n]=hr(r)}),e};var Ae=globalThis&&globalThis.__awaiter||function(s,e,t,r){function n(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function c(u){try{d(r.next(u))}catch(h){i(h)}}function l(u){try{d(r.throw(u))}catch(h){i(h)}}function d(u){u.done?o(u.value):n(u.value).then(c,l)}d((r=r.apply(s,e||[])).next())})};const Jt=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),di=(s,e,t)=>Ae(void 0,void 0,void 0,function*(){const r=yield ci();s instanceof r&&!(t!=null&&t.noResolveJson)?s.json().then(n=>{e(new ii(Jt(n),s.status||500))}).catch(n=>{e(new ur(Jt(n),n))}):e(new ur(Jt(s),s))}),ui=(s,e,t,r)=>{const n={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r&&(n.body=JSON.stringify(r)),Object.assign(Object.assign({},n),t))};function mt(s,e,t,r,n,o){return Ae(this,void 0,void 0,function*(){return new Promise((i,c)=>{s(t,ui(e,r,n,o)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>i(l)).catch(l=>di(l,c,r))})})}function Tt(s,e,t,r){return Ae(this,void 0,void 0,function*(){return mt(s,"GET",e,t,r)})}function _e(s,e,t,r,n){return Ae(this,void 0,void 0,function*(){return mt(s,"POST",e,r,n,t)})}function hi(s,e,t,r,n){return Ae(this,void 0,void 0,function*(){return mt(s,"PUT",e,r,n,t)})}function mi(s,e,t,r){return Ae(this,void 0,void 0,function*(){return mt(s,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function nn(s,e,t,r,n){return Ae(this,void 0,void 0,function*(){return mt(s,"DELETE",e,r,n,t)})}var ae=globalThis&&globalThis.__awaiter||function(s,e,t,r){function n(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function c(u){try{d(r.next(u))}catch(h){i(h)}}function l(u){try{d(r.throw(u))}catch(h){i(h)}}function d(u){u.done?o(u.value):n(u.value).then(c,l)}d((r=r.apply(s,e||[])).next())})};const fi={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},rs={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class pi{constructor(e,t={},r,n){this.url=e,this.headers=t,this.bucketId=r,this.fetch=sn(n)}uploadOrUpdate(e,t,r,n){return ae(this,void 0,void 0,function*(){try{let o;const i=Object.assign(Object.assign({},rs),n);let c=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(i.upsert)});const l=i.metadata;typeof Blob<"u"&&r instanceof Blob?(o=new FormData,o.append("cacheControl",i.cacheControl),l&&o.append("metadata",this.encodeMetadata(l)),o.append("",r)):typeof FormData<"u"&&r instanceof FormData?(o=r,o.append("cacheControl",i.cacheControl),l&&o.append("metadata",this.encodeMetadata(l))):(o=r,c["cache-control"]=`max-age=${i.cacheControl}`,c["content-type"]=i.contentType,l&&(c["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),n!=null&&n.headers&&(c=Object.assign(Object.assign({},c),n.headers));const d=this._removeEmptyFolders(t),u=this._getFinalPath(d),h=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:o,headers:c},i!=null&&i.duplex?{duplex:i.duplex}:{})),m=yield h.json();return h.ok?{data:{path:d,id:m.Id,fullPath:m.Key},error:null}:{data:null,error:m}}catch(o){if(Q(o))return{data:null,error:o};throw o}})}upload(e,t,r){return ae(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,n){return ae(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(e),i=this._getFinalPath(o),c=new URL(this.url+`/object/upload/sign/${i}`);c.searchParams.set("token",t);try{let l;const d=Object.assign({upsert:rs.upsert},n),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",d.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",d.cacheControl)):(l=r,u["cache-control"]=`max-age=${d.cacheControl}`,u["content-type"]=d.contentType);const h=yield this.fetch(c.toString(),{method:"PUT",body:l,headers:u}),m=yield h.json();return h.ok?{data:{path:o,fullPath:m.Key},error:null}:{data:null,error:m}}catch(l){if(Q(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return ae(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const n=Object.assign({},this.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const o=yield _e(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:n}),i=new URL(this.url+o.url),c=i.searchParams.get("token");if(!c)throw new Sr("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:c},error:null}}catch(r){if(Q(r))return{data:null,error:r};throw r}})}update(e,t,r){return ae(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return ae(this,void 0,void 0,function*(){try{return{data:yield _e(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(Q(n))return{data:null,error:n};throw n}})}copy(e,t,r){return ae(this,void 0,void 0,function*(){try{return{data:{path:(yield _e(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(Q(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,r){return ae(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),o=yield _e(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${i}`)},{data:o,error:null}}catch(n){if(Q(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,r){return ae(this,void 0,void 0,function*(){try{const n=yield _e(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:n.map(i=>Object.assign(Object.assign({},i),{signedUrl:i.signedURL?encodeURI(`${this.url}${i.signedURL}${o}`):null})),error:null}}catch(n){if(Q(n))return{data:null,error:n};throw n}})}download(e,t){return ae(this,void 0,void 0,function*(){const n=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),i=o?`?${o}`:"";try{const c=this._getFinalPath(e);return{data:yield(yield Tt(this.fetch,`${this.url}/${n}/${c}${i}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(c){if(Q(c))return{data:null,error:c};throw c}})}info(e){return ae(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield Tt(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:hr(r),error:null}}catch(r){if(Q(r))return{data:null,error:r};throw r}})}exists(e){return ae(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield mi(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Q(r)&&r instanceof ur){const n=r.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),n=[],o=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";o!==""&&n.push(o);const c=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&n.push(l);let d=n.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${c}/public/${r}${d}`)}}}remove(e){return ae(this,void 0,void 0,function*(){try{return{data:yield nn(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Q(t))return{data:null,error:t};throw t}})}list(e,t,r){return ae(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},fi),t),{prefix:e||""});return{data:yield _e(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(Q(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const gi="2.7.1",yi={"X-Client-Info":`storage-js/${gi}`};var Be=globalThis&&globalThis.__awaiter||function(s,e,t,r){function n(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function c(u){try{d(r.next(u))}catch(h){i(h)}}function l(u){try{d(r.throw(u))}catch(h){i(h)}}function d(u){u.done?o(u.value):n(u.value).then(c,l)}d((r=r.apply(s,e||[])).next())})};class xi{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},yi),t),this.fetch=sn(r)}listBuckets(){return Be(this,void 0,void 0,function*(){try{return{data:yield Tt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Q(e))return{data:null,error:e};throw e}})}getBucket(e){return Be(this,void 0,void 0,function*(){try{return{data:yield Tt(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Q(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Be(this,void 0,void 0,function*(){try{return{data:yield _e(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Q(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return Be(this,void 0,void 0,function*(){try{return{data:yield hi(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Q(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Be(this,void 0,void 0,function*(){try{return{data:yield _e(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Q(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Be(this,void 0,void 0,function*(){try{return{data:yield nn(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Q(t))return{data:null,error:t};throw t}})}}class bi extends xi{constructor(e,t={},r){super(e,t,r)}from(e){return new pi(this.url,this.headers,e,this.fetch)}}const wi="2.52.1";let st="";typeof Deno<"u"?st="deno":typeof document<"u"?st="web":typeof navigator<"u"&&navigator.product==="ReactNative"?st="react-native":st="node";const vi={"X-Client-Info":`supabase-js-${st}/${wi}`},ji={headers:vi},_i={schema:"public"},Ni={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Pi={};var Si=globalThis&&globalThis.__awaiter||function(s,e,t,r){function n(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function c(u){try{d(r.next(u))}catch(h){i(h)}}function l(u){try{d(r.throw(u))}catch(h){i(h)}}function d(u){u.done?o(u.value):n(u.value).then(c,l)}d((r=r.apply(s,e||[])).next())})};const ki=s=>{let e;return s?e=s:typeof fetch>"u"?e=Gs:e=fetch,(...t)=>e(...t)},Ti=()=>typeof Headers>"u"?Hs:Headers,Ci=(s,e,t)=>{const r=ki(t),n=Ti();return(o,i)=>Si(void 0,void 0,void 0,function*(){var c;const l=(c=yield e())!==null&&c!==void 0?c:s;let d=new n(i==null?void 0:i.headers);return d.has("apikey")||d.set("apikey",s),d.has("Authorization")||d.set("Authorization",`Bearer ${l}`),r(o,Object.assign(Object.assign({},i),{headers:d}))})};var $i=globalThis&&globalThis.__awaiter||function(s,e,t,r){function n(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function c(u){try{d(r.next(u))}catch(h){i(h)}}function l(u){try{d(r.throw(u))}catch(h){i(h)}}function d(u){u.done?o(u.value):n(u.value).then(c,l)}d((r=r.apply(s,e||[])).next())})};function Ei(s){return s.endsWith("/")?s:s+"/"}function Ri(s,e){var t,r;const{db:n,auth:o,realtime:i,global:c}=s,{db:l,auth:d,realtime:u,global:h}=e,m={db:Object.assign(Object.assign({},l),n),auth:Object.assign(Object.assign({},d),o),realtime:Object.assign(Object.assign({},u),i),global:Object.assign(Object.assign(Object.assign({},h),c),{headers:Object.assign(Object.assign({},(t=h==null?void 0:h.headers)!==null&&t!==void 0?t:{}),(r=c==null?void 0:c.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>$i(this,void 0,void 0,function*(){return""})};return s.accessToken?m.accessToken=s.accessToken:delete m.accessToken,m}const on="2.71.1",He=30*1e3,mr=3,Kt=mr*He,Ii="http://localhost:9999",Oi="supabase.auth.token",Ai={"X-Client-Info":`gotrue-js/${on}`},fr="X-Supabase-Api-Version",an={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Li=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Bi=10*60*1e3;class kr extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function I(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class Mi extends kr{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function Ui(s){return I(s)&&s.name==="AuthApiError"}class ln extends kr{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ke extends kr{constructor(e,t,r,n){super(e,r,n),this.name=t,this.status=r}}class je extends ke{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Di(s){return I(s)&&s.name==="AuthSessionMissingError"}class yt extends ke{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class xt extends ke{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class bt extends ke{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Fi(s){return I(s)&&s.name==="AuthImplicitGrantRedirectError"}class ss extends ke{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class pr extends ke{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Yt(s){return I(s)&&s.name==="AuthRetryableFetchError"}class ns extends ke{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class gr extends ke{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ct="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),os=` 	
\r=`.split(""),Gi=(()=>{const s=new Array(128);for(let e=0;e<s.length;e+=1)s[e]=-1;for(let e=0;e<os.length;e+=1)s[os[e].charCodeAt(0)]=-2;for(let e=0;e<Ct.length;e+=1)s[Ct[e].charCodeAt(0)]=e;return s})();function as(s,e,t){if(s!==null)for(e.queue=e.queue<<8|s,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(Ct[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(Ct[r]),e.queuedBits-=6}}function cn(s,e,t){const r=Gi[s];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(s)}"`)}}function is(s){const e=[],t=i=>{e.push(String.fromCodePoint(i))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},o=i=>{zi(i,r,t)};for(let i=0;i<s.length;i+=1)cn(s.charCodeAt(i),n,o);return e.join("")}function Hi(s,e){if(s<=127){e(s);return}else if(s<=2047){e(192|s>>6),e(128|s&63);return}else if(s<=65535){e(224|s>>12),e(128|s>>6&63),e(128|s&63);return}else if(s<=1114111){e(240|s>>18),e(128|s>>12&63),e(128|s>>6&63),e(128|s&63);return}throw new Error(`Unrecognized Unicode codepoint: ${s.toString(16)}`)}function qi(s,e){for(let t=0;t<s.length;t+=1){let r=s.charCodeAt(t);if(r>55295&&r<=56319){const n=(r-55296)*1024&65535;r=(s.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}Hi(r,e)}}function zi(s,e,t){if(e.utf8seq===0){if(s<=127){t(s);return}for(let r=1;r<6;r+=1)if(!(s>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=s&31;else if(e.utf8seq===3)e.codepoint=s&15;else if(e.utf8seq===4)e.codepoint=s&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(s<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|s&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Vi(s){const e=[],t={queue:0,queuedBits:0},r=n=>{e.push(n)};for(let n=0;n<s.length;n+=1)cn(s.charCodeAt(n),t,r);return new Uint8Array(e)}function Wi(s){const e=[];return qi(s,t=>e.push(t)),new Uint8Array(e)}function Ji(s){const e=[],t={queue:0,queuedBits:0},r=n=>{e.push(n)};return s.forEach(n=>as(n,t,r)),as(null,t,r),e.join("")}function Ki(s){return Math.round(Date.now()/1e3)+s}function Yi(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const e=Math.random()*16|0;return(s=="x"?e:e&3|8).toString(16)})}const ue=()=>typeof window<"u"&&typeof document<"u",Te={tested:!1,writable:!1},dn=()=>{if(!ue())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Te.tested)return Te.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),Te.tested=!0,Te.writable=!0}catch{Te.tested=!0,Te.writable=!1}return Te.writable};function Xi(s){const e={},t=new URL(s);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,o)=>{e[o]=n})}catch{}return t.searchParams.forEach((r,n)=>{e[n]=r}),e}const un=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>Ke(()=>Promise.resolve().then(()=>Ze),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Zi=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",qe=async(s,e,t)=>{await s.setItem(e,JSON.stringify(t))},Ce=async(s,e)=>{const t=await s.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},ve=async(s,e)=>{await s.removeItem(e)};class Ft{constructor(){this.promise=new Ft.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Ft.promiseConstructor=Promise;function Xt(s){const e=s.split(".");if(e.length!==3)throw new gr("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!Li.test(e[r]))throw new gr("JWT not in base64url format");return{header:JSON.parse(is(e[0])),payload:JSON.parse(is(e[1])),signature:Vi(e[2]),raw:{header:e[0],payload:e[1]}}}async function Qi(s){return await new Promise(e=>{setTimeout(()=>e(null),s)})}function el(s,e){return new Promise((r,n)=>{(async()=>{for(let o=0;o<1/0;o++)try{const i=await s(o);if(!e(o,null,i)){r(i);return}}catch(i){if(!e(o,i)){n(i);return}}})()})}function tl(s){return("0"+s.toString(16)).substr(-2)}function rl(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let n="";for(let o=0;o<56;o++)n+=t.charAt(Math.floor(Math.random()*r));return n}return crypto.getRandomValues(e),Array.from(e,tl).join("")}async function sl(s){const t=new TextEncoder().encode(s),r=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(r);return Array.from(n).map(o=>String.fromCharCode(o)).join("")}async function nl(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const t=await sl(s);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Me(s,e,t=!1){const r=rl();let n=r;t&&(n+="/PASSWORD_RECOVERY"),await qe(s,`${e}-code-verifier`,n);const o=await nl(r);return[o,r===o?"plain":"s256"]}const ol=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function al(s){const e=s.headers.get(fr);if(!e||!e.match(ol))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function il(s){if(!s)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(s<=e)throw new Error("JWT has expired")}function ll(s){switch(s){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const cl=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ue(s){if(!cl.test(s))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Zt(){const s={};return new Proxy(s,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const r=t.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function ls(s){return JSON.parse(JSON.stringify(s))}var dl=globalThis&&globalThis.__rest||function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(t[r[n]]=s[r[n]]);return t};const Ee=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),ul=[502,503,504];async function cs(s){var e;if(!Zi(s))throw new pr(Ee(s),0);if(ul.includes(s.status))throw new pr(Ee(s),s.status);let t;try{t=await s.json()}catch(o){throw new ln(Ee(o),o)}let r;const n=al(s);if(n&&n.getTime()>=an["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new ns(Ee(t),s.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new je}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((o,i)=>o&&typeof i=="string",!0))throw new ns(Ee(t),s.status,t.weak_password.reasons);throw new Mi(Ee(t),s.status||500,r)}const hl=(s,e,t,r)=>{const n={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),t))};async function A(s,e,t,r){var n;const o=Object.assign({},r==null?void 0:r.headers);o[fr]||(o[fr]=an["2024-01-01"].name),r!=null&&r.jwt&&(o.Authorization=`Bearer ${r.jwt}`);const i=(n=r==null?void 0:r.query)!==null&&n!==void 0?n:{};r!=null&&r.redirectTo&&(i.redirect_to=r.redirectTo);const c=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await ml(s,e,t+c,{headers:o,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function ml(s,e,t,r,n,o){const i=hl(e,r,n,o);let c;try{c=await s(t,Object.assign({},i))}catch(l){throw console.error(l),new pr(Ee(l),0)}if(c.ok||await cs(c),r!=null&&r.noResolveJson)return c;try{return await c.json()}catch(l){await cs(l)}}function ye(s){var e;let t=null;yl(s)&&(t=Object.assign({},s),s.expires_at||(t.expires_at=Ki(s.expires_in)));const r=(e=s.user)!==null&&e!==void 0?e:s;return{data:{session:t,user:r},error:null}}function ds(s){const e=ye(s);return!e.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=s.weak_password),e}function Ne(s){var e;return{data:{user:(e=s.user)!==null&&e!==void 0?e:s},error:null}}function fl(s){return{data:s,error:null}}function pl(s){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:o}=s,i=dl(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),c={action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:o},l=Object.assign({},i);return{data:{properties:c,user:l},error:null}}function gl(s){return s}function yl(s){return s.access_token&&s.refresh_token&&s.expires_in}const Qt=["global","local","others"];var xl=globalThis&&globalThis.__rest||function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(t[r[n]]=s[r[n]]);return t};class bl{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=un(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=Qt[0]){if(Qt.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Qt.join(", ")}`);try{return await A(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(I(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await A(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Ne})}catch(r){if(I(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=xl(e,["options"]),n=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(n.new_email=r==null?void 0:r.newEmail,delete n.newEmail),await A(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:pl,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(I(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await A(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ne})}catch(t){if(I(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,n,o,i,c,l;try{const d={nextPage:null,lastPage:0,total:0},u=await A(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(o=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&o!==void 0?o:""},xform:gl});if(u.error)throw u.error;const h=await u.json(),m=(i=u.headers.get("x-total-count"))!==null&&i!==void 0?i:0,p=(l=(c=u.headers.get("link"))===null||c===void 0?void 0:c.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(g=>{const x=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),b=JSON.parse(g.split(";")[1].split("=")[1]);d[`${b}Page`]=x}),d.total=parseInt(m)),{data:Object.assign(Object.assign({},h),d),error:null}}catch(d){if(I(d))return{data:{users:[]},error:d};throw d}}async getUserById(e){Ue(e);try{return await A(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ne})}catch(t){if(I(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Ue(e);try{return await A(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Ne})}catch(r){if(I(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){Ue(e);try{return await A(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Ne})}catch(r){if(I(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){Ue(e.userId);try{const{data:t,error:r}=await A(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:r}}catch(t){if(I(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Ue(e.userId),Ue(e.id);try{return{data:await A(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(I(t))return{data:null,error:t};throw t}}}function us(s={}){return{getItem:e=>s[e]||null,setItem:(e,t)=>{s[e]=t},removeItem:e=>{delete s[e]}}}function wl(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const De={debug:!!(globalThis&&dn()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class hn extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class vl extends hn{}async function jl(s,e,t){De.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),De.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(s,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async n=>{if(n){De.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,n.name);try{return await t()}finally{De.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,n.name)}}else{if(e===0)throw De.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new vl(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(De.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}wl();const _l={url:Ii,storageKey:Oi,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ai,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function hs(s,e,t){return await t()}const Fe={};class lt{constructor(e){var t,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=lt.nextInstanceID,lt.nextInstanceID+=1,this.instanceID>0&&ue()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},_l),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new bl({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=un(n.fetch),this.lock=n.lock||hs,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:ue()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=jl:this.lock=hs,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:dn()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=us(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=us(this.memoryStorage)),ue()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=Fe[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Fe[this.storageKey]=Object.assign(Object.assign({},Fe[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Fe[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Fe[this.storageKey]=Object.assign(Object.assign({},Fe[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${on}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Xi(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),ue()&&this.detectSessionInUrl&&r!=="none"){const{data:n,error:o}=await this._getSessionFromURL(t,r);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),Fi(o)){const l=(e=o.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:i,redirectType:c}=n;return this._debug("#_initialize()","detected session in URL",i,"redirect type",c),await this._saveSession(i),setTimeout(async()=>{c==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return I(t)?{error:t}:{error:new ln("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,n;try{const o=await A(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:ye}),{data:i,error:c}=o;if(c||!i)return{data:{user:null,session:null},error:c};const l=i.session,d=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:d,session:l},error:null}}catch(o){if(I(o))return{data:{user:null,session:null},error:o};throw o}}async signUp(e){var t,r,n;try{let o;if("email"in e){const{email:u,password:h,options:m}=e;let p=null,g=null;this.flowType==="pkce"&&([p,g]=await Me(this.storage,this.storageKey)),o=await A(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:m==null?void 0:m.emailRedirectTo,body:{email:u,password:h,data:(t=m==null?void 0:m.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken},code_challenge:p,code_challenge_method:g},xform:ye})}else if("phone"in e){const{phone:u,password:h,options:m}=e;o=await A(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(r=m==null?void 0:m.data)!==null&&r!==void 0?r:{},channel:(n=m==null?void 0:m.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken}},xform:ye})}else throw new xt("You must provide either an email or phone number and a password");const{data:i,error:c}=o;if(c||!i)return{data:{user:null,session:null},error:c};const l=i.session,d=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:d,session:l},error:null}}catch(o){if(I(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithPassword(e){try{let t;if("email"in e){const{email:o,password:i,options:c}=e;t=await A(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:i,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:ds})}else if("phone"in e){const{phone:o,password:i,options:c}=e;t=await A(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:i,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:ds})}else throw new xt("You must provide either an email or phone number and a password");const{data:r,error:n}=t;return n?{data:{user:null,session:null},error:n}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new yt}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n})}catch(t){if(I(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,n,o;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,r,n,o,i,c,l,d,u,h,m,p;let g,x;if("message"in e)g=e.message,x=e.signature;else{const{chain:b,wallet:w,statement:N,options:y}=e;let j;if(ue())if(typeof w=="object")j=w;else{const k=window;if("solana"in k&&typeof k.solana=="object"&&("signIn"in k.solana&&typeof k.solana.signIn=="function"||"signMessage"in k.solana&&typeof k.solana.signMessage=="function"))j=k.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!(y!=null&&y.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");j=w}const S=new URL((t=y==null?void 0:y.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in j&&j.signIn){const k=await j.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},y==null?void 0:y.signInWithSolana),{version:"1",domain:S.host,uri:S.href}),N?{statement:N}:null));let $;if(Array.isArray(k)&&k[0]&&typeof k[0]=="object")$=k[0];else if(k&&typeof k=="object"&&"signedMessage"in k&&"signature"in k)$=k;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in $&&"signature"in $&&(typeof $.signedMessage=="string"||$.signedMessage instanceof Uint8Array)&&$.signature instanceof Uint8Array)g=typeof $.signedMessage=="string"?$.signedMessage:new TextDecoder().decode($.signedMessage),x=$.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in j)||typeof j.signMessage!="function"||!("publicKey"in j)||typeof j!="object"||!j.publicKey||!("toBase58"in j.publicKey)||typeof j.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${S.host} wants you to sign in with your Solana account:`,j.publicKey.toBase58(),...N?["",N,""]:[""],"Version: 1",`URI: ${S.href}`,`Issued At: ${(n=(r=y==null?void 0:y.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((o=y==null?void 0:y.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${y.signInWithSolana.notBefore}`]:[],...!((i=y==null?void 0:y.signInWithSolana)===null||i===void 0)&&i.expirationTime?[`Expiration Time: ${y.signInWithSolana.expirationTime}`]:[],...!((c=y==null?void 0:y.signInWithSolana)===null||c===void 0)&&c.chainId?[`Chain ID: ${y.signInWithSolana.chainId}`]:[],...!((l=y==null?void 0:y.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${y.signInWithSolana.nonce}`]:[],...!((d=y==null?void 0:y.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${y.signInWithSolana.requestId}`]:[],...!((h=(u=y==null?void 0:y.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||h===void 0)&&h.length?["Resources",...y.signInWithSolana.resources.map($=>`- ${$}`)]:[]].join(`
`);const k=await j.signMessage(new TextEncoder().encode(g),"utf8");if(!k||!(k instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");x=k}}try{const{data:b,error:w}=await A(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:Ji(x)},!((m=e.options)===null||m===void 0)&&m.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:ye});if(w)throw w;return!b||!b.session||!b.user?{data:{user:null,session:null},error:new yt}:(b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),{data:Object.assign({},b),error:w})}catch(b){if(I(b))return{data:{user:null,session:null},error:b};throw b}}async _exchangeCodeForSession(e){const t=await Ce(this.storage,`${this.storageKey}-code-verifier`),[r,n]=(t??"").split("/");try{const{data:o,error:i}=await A(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:ye});if(await ve(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return!o||!o.session||!o.user?{data:{user:null,session:null,redirectType:null},error:new yt}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign(Object.assign({},o),{redirectType:n??null}),error:i})}catch(o){if(I(o))return{data:{user:null,session:null,redirectType:null},error:o};throw o}}async signInWithIdToken(e){try{const{options:t,provider:r,token:n,access_token:o,nonce:i}=e,c=await A(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:o,nonce:i,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:ye}),{data:l,error:d}=c;return d?{data:{user:null,session:null},error:d}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new yt}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:d})}catch(t){if(I(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,n,o,i;try{if("email"in e){const{email:c,options:l}=e;let d=null,u=null;this.flowType==="pkce"&&([d,u]=await Me(this.storage,this.storageKey));const{error:h}=await A(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:c,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:d,code_challenge_method:u},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:c,options:l}=e,{data:d,error:u}=await A(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:c,data:(n=l==null?void 0:l.data)!==null&&n!==void 0?n:{},create_user:(o=l==null?void 0:l.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(i=l==null?void 0:l.channel)!==null&&i!==void 0?i:"sms"}});return{data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:u}}throw new xt("You must provide either an email or phone number.")}catch(c){if(I(c))return{data:{user:null,session:null},error:c};throw c}}async verifyOtp(e){var t,r;try{let n,o;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,o=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:i,error:c}=await A(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:n,xform:ye});if(c)throw c;if(!i)throw new Error("An error occurred on token verification.");const l=i.session,d=i.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:d,session:l},error:null}}catch(n){if(I(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,r,n;try{let o=null,i=null;return this.flowType==="pkce"&&([o,i]=await Me(this.storage,this.storageKey)),await A(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:i}),headers:this.headers,xform:fl})}catch(o){if(I(o))return{data:null,error:o};throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new je;const{error:n}=await A(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(I(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:n,options:o}=e,{error:i}=await A(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},redirectTo:o==null?void 0:o.emailRedirectTo});return{data:{user:null,session:null},error:i}}else if("phone"in e){const{phone:r,type:n,options:o}=e,{data:i,error:c}=await A(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}}});return{data:{user:null,session:null,messageId:i==null?void 0:i.message_id},error:c}}throw new xt("You must provide either an email or phone number and a type")}catch(t){if(I(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Ce(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Kt:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const i=await Ce(this.userStorage,this.storageKey+"-user");i!=null&&i.user?e.user=i.user:e.user=Zt()}if(this.storage.isServer&&e.user){let i=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,d,u)=>(!i&&d==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,d,u))})}return{data:{session:e},error:null}}const{session:n,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{session:null},error:o}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await A(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ne}):await this._useSession(async t=>{var r,n,o;const{data:i,error:c}=t;if(c)throw c;return!(!((r=i.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new je}:await A(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(n=i.session)===null||n===void 0?void 0:n.access_token)!==null&&o!==void 0?o:void 0,xform:Ne})})}catch(t){if(I(t))return Di(t)&&(await this._removeSession(),await ve(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:n,error:o}=r;if(o)throw o;if(!n.session)throw new je;const i=n.session;let c=null,l=null;this.flowType==="pkce"&&e.email!=null&&([c,l]=await Me(this.storage,this.storageKey));const{data:d,error:u}=await A(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:c,code_challenge_method:l}),jwt:i.access_token,xform:Ne});if(u)throw u;return i.user=d.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(r){if(I(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new je;const t=Date.now()/1e3;let r=t,n=!0,o=null;const{payload:i}=Xt(e.access_token);if(i.exp&&(r=i.exp,n=r<=t),n){const{session:c,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!c)return{data:{user:null,session:null},error:null};o=c}else{const{data:c,error:l}=await this._getUser(e.access_token);if(l)throw l;o={access_token:e.access_token,refresh_token:e.refresh_token,user:c.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return{data:{user:o.user,session:o},error:null}}catch(t){if(I(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:i,error:c}=t;if(c)throw c;e=(r=i.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new je;const{session:n,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{user:null,session:null},error:o}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(I(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!ue())throw new bt("No browser detected.");if(e.error||e.error_description||e.error_code)throw new bt(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new ss("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new bt("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new ss("No code detected.");const{data:N,error:y}=await this._exchangeCodeForSession(e.code);if(y)throw y;const j=new URL(window.location.href);return j.searchParams.delete("code"),window.history.replaceState(window.history.state,"",j.toString()),{data:{session:N.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:o,refresh_token:i,expires_in:c,expires_at:l,token_type:d}=e;if(!o||!c||!i||!d)throw new bt("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(c);let m=u+h;l&&(m=parseInt(l));const p=m-u;p*1e3<=He&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${h}s`);const g=m-h;u-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,m,u):u-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,m,u);const{data:x,error:b}=await this._getUser(o);if(b)throw b;const w={provider_token:r,provider_refresh_token:n,access_token:o,expires_in:h,expires_at:m,refresh_token:i,token_type:d,user:x.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:w,redirectType:e.type},error:null}}catch(r){if(I(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Ce(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:n,error:o}=t;if(o)return{error:o};const i=(r=n.session)===null||r===void 0?void 0:r.access_token;if(i){const{error:c}=await this.admin.signOut(i,e);if(c&&!(Ui(c)&&(c.status===404||c.status===401||c.status===403)))return{error:c}}return e!=="others"&&(await this._removeSession(),await ve(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Yi(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,n;try{const{data:{session:o},error:i}=t;if(i)throw i;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}})}async resetPasswordForEmail(e,t={}){let r=null,n=null;this.flowType==="pkce"&&([r,n]=await Me(this.storage,this.storageKey,!0));try{return await A(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(o){if(I(o))return{data:null,error:o};throw o}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(I(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:n}=await this._useSession(async o=>{var i,c,l,d,u;const{data:h,error:m}=o;if(m)throw m;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(c=e.options)===null||c===void 0?void 0:c.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await A(this.fetch,"GET",p,{headers:this.headers,jwt:(u=(d=h.session)===null||d===void 0?void 0:d.access_token)!==null&&u!==void 0?u:void 0})});if(n)throw n;return ue()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(I(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,n;const{data:o,error:i}=t;if(i)throw i;return await A(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(r=o.session)===null||r===void 0?void 0:r.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(I(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await el(async n=>(n>0&&await Qi(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await A(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ye})),(n,o)=>{const i=200*Math.pow(2,n);return o&&Yt(o)&&Date.now()+i-r<He})}catch(r){if(this._debug(t,"error",r),I(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),ue()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const n=await Ce(this.storage,this.storageKey);if(n&&this.userStorage){let i=await Ce(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!i&&(i={user:n.user},await qe(this.userStorage,this.storageKey+"-user",i)),n.user=(e=i==null?void 0:i.user)!==null&&e!==void 0?e:Zt()}else if(n&&!n.user&&!n.user){const i=await Ce(this.storage,this.storageKey+"-user");i&&(i!=null&&i.user)?(n.user=i.user,await ve(this.storage,this.storageKey+"-user"),await qe(this.storage,this.storageKey,n)):n.user=Zt()}if(this._debug(r,"session from storage",n),!this._isValidSession(n)){this._debug(r,"session is not valid"),n!==null&&await this._removeSession();return}const o=((t=n.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Kt;if(this._debug(r,`session has${o?"":" not"} expired with margin of ${Kt}s`),o){if(this.autoRefreshToken&&n.refresh_token){const{error:i}=await this._callRefreshToken(n.refresh_token);i&&(console.error(i),Yt(i)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:i,error:c}=await this._getUser(n.access_token);!c&&(i!=null&&i.user)?(n.user=i.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(i){console.error("Error getting user data:",i),this._debug(r,"error getting user data, skipping SIGNED_IN notification",i)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(r,"error",n),console.error(n);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new je;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Ft;const{data:o,error:i}=await this._refreshAccessToken(e);if(i)throw i;if(!o.session)throw new je;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const c={session:o.session,error:null};return this.refreshingDeferred.resolve(c),c}catch(o){if(this._debug(n,"error",o),I(o)){const i={session:null,error:o};return Yt(o)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(i),i}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(o),o}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,r=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const o=[],i=Array.from(this.stateChangeEmitters.values()).map(async c=>{try{await c.callback(e,t)}catch(l){o.push(l)}});if(await Promise.all(i),o.length>0){for(let c=0;c<o.length;c+=1)console.error(o[c]);throw o[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&t.user&&await qe(this.userStorage,this.storageKey+"-user",{user:t.user});const n=Object.assign({},t);delete n.user;const o=ls(n);await qe(this.storage,this.storageKey,o)}else{const n=ls(t);await qe(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),await ve(this.storage,this.storageKey),await ve(this.storage,this.storageKey+"-code-verifier"),await ve(this.storage,this.storageKey+"-user"),this.userStorage&&await ve(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ue()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),He);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((r.expires_at*1e3-e)/He);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${He}ms, refresh threshold is ${mr} ticks`),n<=mr&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof hn)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ue()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const n=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&n.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&n.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[o,i]=await Me(this.storage,this.storageKey),c=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(i)}`});n.push(c.toString())}if(r!=null&&r.queryParams){const o=new URLSearchParams(r.queryParams);n.push(o.toString())}return r!=null&&r.skipBrowserRedirect&&n.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:n,error:o}=t;return o?{data:null,error:o}:await A(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(I(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,n;const{data:o,error:i}=t;if(i)return{data:null,error:i};const c=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:d}=await A(this.fetch,"POST",`${this.url}/factors`,{body:c,headers:this.headers,jwt:(r=o==null?void 0:o.session)===null||r===void 0?void 0:r.access_token});return d?{data:null,error:d}:(e.factorType==="totp"&&(!((n=l==null?void 0:l.totp)===null||n===void 0)&&n.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(I(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:o}=t;if(o)return{data:null,error:o};const{data:i,error:c}=await A(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:c})})}catch(t){if(I(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:o}=t;return o?{data:null,error:o}:await A(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(I(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],n=r.filter(i=>i.factor_type==="totp"&&i.status==="verified"),o=r.filter(i=>i.factor_type==="phone"&&i.status==="verified");return{data:{all:r,totp:n,phone:o},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:n},error:o}=e;if(o)return{data:null,error:o};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=Xt(n.access_token);let c=null;i.aal&&(c=i.aal);let l=c;((r=(t=n.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const u=i.amr||[];return{data:{currentLevel:c,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(c=>c.kid===e);if(r)return r;const n=Date.now();if(r=this.jwks.keys.find(c=>c.kid===e),r&&this.jwks_cached_at+Bi>n)return r;const{data:o,error:i}=await A(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=n,r=o.keys.find(c=>c.kid===e),!r)?null:r}async getClaims(e,t={}){try{let r=e;if(!r){const{data:p,error:g}=await this.getSession();if(g||!p.session)return{data:null,error:g};r=p.session.access_token}const{header:n,payload:o,signature:i,raw:{header:c,payload:l}}=Xt(r);t!=null&&t.allowExpired||il(o.exp);const d=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!d){const{error:p}=await this.getUser(r);if(p)throw p;return{data:{claims:o,header:n,signature:i},error:null}}const u=ll(n.alg),h=await crypto.subtle.importKey("jwk",d,u,!0,["verify"]);if(!await crypto.subtle.verify(u,h,i,Wi(`${c}.${l}`)))throw new gr("Invalid JWT signature");return{data:{claims:o,header:n,signature:i},error:null}}catch(r){if(I(r))return{data:null,error:r};throw r}}}lt.nextInstanceID=0;const Nl=lt;class Pl extends Nl{constructor(e){super(e)}}var Sl=globalThis&&globalThis.__awaiter||function(s,e,t,r){function n(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function c(u){try{d(r.next(u))}catch(h){i(h)}}function l(u){try{d(r.throw(u))}catch(h){i(h)}}function d(u){u.done?o(u.value):n(u.value).then(c,l)}d((r=r.apply(s,e||[])).next())})};class kl{constructor(e,t,r){var n,o,i;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const c=Ei(e),l=new URL(c);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const d=`sb-${l.hostname.split(".")[0]}-auth-token`,u={db:_i,realtime:Pi,auth:Object.assign(Object.assign({},Ni),{storageKey:d}),global:ji},h=Ri(r??{},u);this.storageKey=(n=h.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(o=h.global.headers)!==null&&o!==void 0?o:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(m,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((i=h.auth)!==null&&i!==void 0?i:{},this.headers,h.global.fetch),this.fetch=Ci(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new za(new URL("rest/v1",l).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),h.accessToken||this._listenForAuthEvents()}get functions(){return new va(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new bi(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Sl(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,storageKey:o,flowType:i,lock:c,debug:l},d,u){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Pl({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),d),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,flowType:i,lock:c,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new ai(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Tl=(s,e,t)=>new kl(s,e,t);function Cl(){if(typeof window<"u"||typeof process>"u"||process.version===void 0||process.version===null)return!1;const s=process.version.match(/^v(\d+)\./);return s?parseInt(s[1],10)<=18:!1}Cl()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const $l="https://pinxadmchybkukdpdped.supabase.co",El="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBpbnhhZG1jaHlia3VrZHBkcGVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMzOTY3NTYsImV4cCI6MjA2ODk3Mjc1Nn0.1ygNxRevq4-7v93J080tLChB4HyYGlA8uu_1l8i9BYk",z=Tl($l,El),ms={async saveGameState(s,e){const{error:t}=await z.from("game_sessions").upsert({room_id:s,game_state:e},{onConflict:"room_id"});if(t)throw new Error(`Failed to save game state: ${t.message}`)},async loadGameState(s){const{data:e,error:t}=await z.from("game_sessions").select("game_state").eq("room_id",s).single();if(t){if(t.code==="PGRST116")return null;throw new Error(`Failed to load game state: ${t.message}`)}return(e==null?void 0:e.game_state)||null},async deleteGameState(s){const{error:e}=await z.from("game_sessions").delete().eq("room_id",s);if(e)throw new Error(`Failed to delete game state: ${e.message}`)}},Ie={async updateUserStatus(s,e){const t=await re.getCurrentUser();if(!t)return;const r=`${t.id}-${Date.now()}`,{error:n}=await z.from("user_sessions").upsert({user_id:t.id,session_token:r,status:s,current_room_id:e||null,last_activity:new Date().toISOString()},{onConflict:"user_id"});n&&console.error("Error updating user status:",n)},async updateActivity(){const s=await re.getCurrentUser();if(!s)return;const{error:e}=await z.from("user_sessions").update({last_activity:new Date().toISOString()}).eq("user_id",s.id);e&&console.error("Error updating activity:",e)},async getOnlineStats(){const{data:s,error:e}=await z.rpc("get_online_stats");return e?(console.error("Error fetching online stats:",e),{total_online:0,in_game:0,open_lobbies:0}):(s==null?void 0:s[0])||{total_online:0,in_game:0,open_lobbies:0}}},Oe={async getAvailableRooms(){const{data:s,error:e}=await z.from("game_rooms").select(`
        *,
        host:profiles(username, id)
      `).eq("status","waiting").eq("is_private",!1).order("created_at",{ascending:!1});if(e)throw e;return s||[]},async createRoom(s){const e=await re.getCurrentUser();if(!e)throw new Error("Must be authenticated");const{data:t,error:r}=await z.from("game_rooms").insert({name:s.name,host_id:e.id,max_players:s.max_players,is_private:s.is_private,password:s.password,game_settings:s.game_settings||{starting_money:1500,fast_mode:!1}}).select().single();if(r)throw r;return await this.joinRoom(t.id,{player_color:"#FF0000",player_icon:"🎩"}),t},async joinRoom(s,e){const t=await re.getCurrentUser();if(!t)throw new Error("Must be authenticated");const{data:r,error:n}=await z.from("game_rooms").select("*").eq("id",s).eq("status","waiting").single();if(n||!r)throw new Error("Room not found or not available");if(r.current_players>=r.max_players)throw new Error("Room is full");const{data:o,error:i}=await z.from("room_participants").insert({room_id:s,user_id:t.id,player_color:e.player_color,player_icon:e.player_icon}).select().single();if(i)throw i;return o},async leaveRoom(s){const e=await re.getCurrentUser();if(!e)throw new Error("Must be authenticated");const{error:t}=await z.from("room_participants").delete().eq("room_id",s).eq("user_id",e.id);if(t)throw t},async getRoomParticipants(s){const{data:e,error:t}=await z.from("room_participants").select(`
        *,
        user:profiles(username, id)
      `).eq("room_id",s).order("joined_at");if(t)throw t;return e||[]},async updatePlayerReady(s,e){const t=await re.getCurrentUser();if(!t)throw new Error("Must be authenticated");const{error:r}=await z.from("room_participants").update({is_ready:e}).eq("room_id",s).eq("user_id",t.id);if(r)throw r},async startGame(s){const e=await re.getCurrentUser();if(!e)throw new Error("Must be authenticated");const{error:t}=await z.from("game_rooms").update({status:"in_progress",started_at:new Date().toISOString()}).eq("id",s).eq("host_id",e.id);if(t)throw t},async findRandomRoom(){const{data:s,error:e}=await z.from("game_rooms").select("*").eq("status","waiting").eq("is_private",!1).filter("current_players","lt","max_players").order("current_players",{ascending:!1}).limit(1);if(e)throw e;return(s==null?void 0:s[0])||null}},re={async signUp(s,e,t){const{data:r,error:n}=await z.auth.signUp({email:s,password:e});if(n)throw n;if(r.user){await new Promise(i=>setTimeout(i,1e3));const{error:o}=await z.from("profiles").insert({id:r.user.id,username:t,email:r.user.email,games_played:0,games_won:0});o&&console.error("Profile creation error:",o)}return r},async signIn(s,e){const{data:t,error:r}=await z.auth.signInWithPassword({email:s,password:e});if(r)throw r;return t},async signOut(){const{error:s}=await z.auth.signOut();if(s)throw s},async getCurrentUser(){const{data:{user:s}}=await z.auth.getUser();return s},async getUserProfile(s){const{data:e,error:t}=await z.from("profiles").select("*").eq("id",s).single();return t?(console.error("Error fetching profile:",t),null):e},async updateGameStats(s,e){const{data:t}=await z.from("profiles").select("games_played, games_won").eq("id",s).single();if(t){const{error:r}=await z.from("profiles").update({games_played:t.games_played+1,games_won:e?t.games_won+1:t.games_won}).eq("id",s);if(r)throw r}}},D={subscribeToGameSession(s,e,t,r){console.log("🔌 Subscribing to realtime updates for room:",s);let n=0;const o=3;let i=null;const c=async()=>{try{const{data:{session:l}}=await z.auth.getSession();if(!l)throw new Error("No valid session");i&&i.unsubscribe(),i=z.channel(`game:${s}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"game_sessions",filter:`room_id=eq.${s}`},d=>{var u,h,m;if(console.log("🔄 POSTGRES RAW PAYLOAD:",{new:d.new,last_action:(u=d.new)==null?void 0:u.last_action,last_action_timestamp:(h=d.new)==null?void 0:h.last_action_timestamp}),(m=d.new)!=null&&m.game_state){let p={};try{d.new.last_action&&(p=typeof d.new.last_action=="string"?JSON.parse(d.new.last_action):d.new.last_action)}catch(g){console.warn("⚠️ Failed to parse last_action:",g),p={}}if(d.new.last_action_timestamp)try{p.timestamp=new Date(d.new.last_action_timestamp).getTime()}catch(g){console.warn("⚠️ Failed to parse timestamp:",g),p.timestamp=Date.now()}else p.timestamp=Date.now();console.log("📤 SENDING TO CALLBACK:",{metadata:p,hasGameState:!!d.new.game_state}),e(d.new.game_state,p)}else console.warn("⚠️ No game_state in payload:",d)}).subscribe(d=>{if(console.log("📡 Subscription status:",d,"retry count:",n),d==="SUBSCRIBED"&&(console.log("✅ Successfully connected to realtime"),n=0,t==null||t()),d==="CHANNEL_ERROR"||d==="CLOSED")if(console.error("❌ Realtime connection failed, status:",d),n<o){n++;const u=2e3*n;console.log(`🔄 Reconnecting in ${u}ms... attempt ${n}/${o}`),setTimeout(c,u)}else console.error("❌ Max retries reached, calling error handler"),r==null||r(new Error("Max reconnection attempts reached"))})}catch(l){console.error("❌ Failed to create subscription:",l),n<o?(n++,console.log(`🔄 Retrying subscription... attempt ${n}/${o}`),setTimeout(c,2e3*n)):r==null||r(l)}};return c(),{unsubscribe:()=>{i&&(i.unsubscribe(),i=null)}}},async updateGameState(s,e,t){console.log("🔧 UPDATING GAME STATE:",{roomId:s,metadata:t,metadataStringified:JSON.stringify(t||{})});const r={game_state:e,last_action_timestamp:new Date().toISOString()};if(t)try{r.last_action=JSON.stringify(t),r.current_turn_player_id=t.playerId}catch(o){console.error("Failed to stringify metadata:",o),r.last_action=JSON.stringify({})}else r.last_action=JSON.stringify({});console.log("💾 UPDATE DATA BEING SENT:",r);const{error:n}=await z.from("game_sessions").update(r).eq("room_id",s);if(n)throw new Error(`Failed to update game state: ${n.message}`)}},er=()=>{const s=It(),[e,t]=f.useState(!0),[r,n]=f.useState(!1),[o,i]=f.useState({email:"",password:"",username:"",confirmPassword:""}),[c,l]=f.useState(!1),[d,u]=f.useState(""),[h,m]=f.useState(null),[p,g]=f.useState([]),[x,b]=f.useState(!1),[w,N]=f.useState({total_online:0,in_game:0,open_lobbies:0}),[y,j]=f.useState(!1),[S,k]=f.useState({name:"",maxPlayers:4,isPrivate:!1,password:"",fastMode:!1});f.useEffect(()=>{$()},[]),f.useEffect(()=>{if(h){F(),L(),Ie.updateUserStatus("online");const v=setInterval(()=>{F(),L(),Ie.updateActivity()},1e4);return()=>clearInterval(v)}},[h]),f.useEffect(()=>{const v=()=>{h&&Ie.updateUserStatus("offline")};return window.addEventListener("beforeunload",v),()=>window.removeEventListener("beforeunload",v)},[h]);const $=async()=>{try{const v=await re.getCurrentUser();if(v){const E=await re.getUserProfile(v.id);E&&m(E)}}catch(v){console.error("Auth check error:",v)}},F=async()=>{try{b(!0);const v=await Oe.getAvailableRooms();g(v)}catch(v){console.error("Error loading rooms:",v)}finally{b(!1)}},L=async()=>{try{const v=await Ie.getOnlineStats();N(v)}catch(v){console.error("Error loading stats:",v)}},q=v=>{i({...o,[v.target.name]:v.target.value}),u("")},M=async v=>{v.preventDefault(),l(!0),u("");try{if(!o.email||!o.password)throw new Error("Please fill in all required fields");if(!e&&!o.username)throw new Error("Username is required");if(!e&&o.password!==o.confirmPassword)throw new Error("Passwords do not match");if(o.password.length<6)throw new Error("Password must be at least 6 characters");if(e){const{user:E}=await re.signIn(o.email,o.password);if(E){const G=await re.getUserProfile(E.id);G&&m(G)}}else await re.signUp(o.email,o.password,o.username),u("Registration successful! Please check your email to verify your account, then sign in."),t(!0),i({email:o.email,password:"",username:"",confirmPassword:""})}catch(E){u(E.message||"An error occurred")}finally{l(!1)}},R=async()=>{try{h&&await Ie.updateUserStatus("offline"),await re.signOut(),m(null),i({email:"",password:"",username:"",confirmPassword:""}),N({total_online:0,in_game:0,open_lobbies:0})}catch(v){u(v.message)}},_=()=>{if(!h){u("Please sign in to create a room");return}j(!0)},se=async()=>{if(h)try{if(l(!0),u(""),!S.name.trim()){u("Room name is required");return}if(S.isPrivate&&!S.password.trim()){u("Password is required for private rooms");return}const v=await Oe.createRoom({name:S.name.trim(),max_players:S.maxPlayers,is_private:S.isPrivate,password:S.isPrivate?S.password:void 0,game_settings:{starting_money:1500,fast_mode:S.fastMode}});j(!1),k({name:"",maxPlayers:4,isPrivate:!1,password:"",fastMode:!1}),s(`/room/${v.id}`)}catch(v){u(v.message)}finally{l(!1)}},ee=async v=>{if(!h){u("Please sign in to join a game");return}try{await Oe.joinRoom(v,{player_color:`#${Math.floor(Math.random()*16777215).toString(16)}`,player_icon:"🎩"}),s(`/room/${v}`)}catch(E){u(E.message)}},oe=()=>{t(!e),i({email:"",password:"",username:"",confirmPassword:""}),u("")};return a.jsxs("div",{className:"min-h-screen relative overflow-hidden",style:{background:"linear-gradient(to bottom, #87CEEB 0%, #98D8E8 50%, #B0E0E6 100%)"},children:[a.jsx("div",{className:"absolute inset-0 overflow-hidden",children:[...Array(20)].map((v,E)=>a.jsx("div",{className:"absolute opacity-80",style:{top:`${Math.random()*100}%`,left:`${Math.random()*120-10}%`,animationDelay:`${Math.random()*20}s`,animationDuration:`${30+Math.random()*20}s`},children:a.jsxs("div",{className:"bg-white rounded-full shadow-sm animate-float",style:{width:`${60+Math.random()*80}px`,height:`${30+Math.random()*40}px`,position:"relative"},children:[a.jsx("div",{className:"absolute bg-white rounded-full",style:{width:`${20+Math.random()*30}px`,height:`${20+Math.random()*30}px`,top:`-${10+Math.random()*15}px`,left:`${10+Math.random()*20}%`}}),a.jsx("div",{className:"absolute bg-white rounded-full",style:{width:`${25+Math.random()*35}px`,height:`${25+Math.random()*35}px`,top:`-${15+Math.random()*20}px`,right:`${10+Math.random()*20}%`}})]})},E))}),a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-900/40 via-blue-900/50 to-indigo-900/60"}),a.jsxs("div",{className:"relative z-10 container mx-auto px-4 mt-8",children:[a.jsxs("div",{className:"text-center mb-10",children:[a.jsx("img",{src:"/images/bonkopoly.png",alt:"BONKOPOLY",style:{height:"200px"},className:"w-auto object-contain drop-shadow-[0_0_15px_rgba(255,107,53,0.5)] mx-auto"}),a.jsx("p",{className:"text-xl text-gray-300 max-w-2xl mx-auto mt-4",children:"The ultimate online monopoly experience. Build your empire, bankrupt your friends, and become the property tycoon!"})]}),h&&a.jsx("div",{className:"mb-8 flex justify-center",children:a.jsxs("div",{className:"bg-gradient-to-br from-green-900/80 to-emerald-800/80 backdrop-blur-xl rounded-xl border border-green-400/30 p-4 flex items-center space-x-4",children:[a.jsx("div",{className:"text-2xl",children:a.jsx("img",{src:"/images/bonk.png",alt:"Bonk",className:"w-12 h-12  object-contain inline"})}),a.jsxs("div",{children:[a.jsxs("div",{className:"font-bold text-white",children:["Welcome, ",h.username,"!"]}),a.jsxs("div",{className:"text-sm text-green-400",children:["Games: ",h.games_played," | Wins: ",h.games_won]})]}),a.jsx("button",{onClick:R,className:"text-sm text-red-400 hover:text-red-300 transition-colors",children:"Sign Out"})]})}),a.jsxs("div",{className:"grid lg:grid-cols-3 gap-8 max-w-7xl mx-auto",children:[a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-gradient-to-br from-slate-900/80 to-slate-800/80 backdrop-blur-xl rounded-2xl border border-white/10 p-6",children:[a.jsxs("h3",{className:"text-2xl font-bold text-white mb-4 flex items-center",children:[a.jsx(wn,{className:"mr-3 text-purple-400"}),"Game Features"]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center text-gray-300",children:[a.jsx(Pe,{className:"w-5 h-5 mr-3 text-blue-400"}),a.jsx("span",{children:"Up to 8 players online"})]}),a.jsxs("div",{className:"flex items-center text-gray-300",children:[a.jsx(vn,{className:"w-5 h-5 mr-3 text-yellow-400"}),a.jsx("span",{children:"Ranked competitive play"})]}),a.jsxs("div",{className:"flex items-center text-gray-300",children:[a.jsx($t,{className:"w-5 h-5 mr-3 text-green-400"}),a.jsx("span",{children:"Custom game modes"})]})]})]}),a.jsxs("div",{className:"bg-gradient-to-br from-slate-900/80 to-slate-800/80 backdrop-blur-xl rounded-2xl border border-white/10 p-6",children:[a.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Live Stats"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-2xl font-bold text-green-400",children:w.total_online}),a.jsx("div",{className:"text-sm text-gray-400",children:"Players Online"})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:w.open_lobbies}),a.jsx("div",{className:"text-sm text-gray-400",children:"Open Lobbies"})]})]})]})]}),!h&&a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-600/20 via-blue-600/20 to-cyan-500/20 rounded-2xl blur-xl"}),a.jsxs("div",{className:"relative bg-gradient-to-br from-slate-900/95 to-slate-800/95 backdrop-blur-xl rounded-2xl border border-white/10 p-8 shadow-2xl",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:e?"Welcome Back!":"Join the Game!"}),a.jsx("p",{className:"text-gray-400",children:e?"Sign in to continue your monopoly journey":"Create your account and start playing"})]}),d&&a.jsx("div",{className:"mb-6 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-sm",children:d}),a.jsxs("div",{className:"space-y-6",children:[!e&&a.jsxs("div",{className:"relative",children:[a.jsx(ys,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),a.jsx("input",{type:"text",name:"username",placeholder:"Username",value:o.username,onChange:q,className:"w-full pl-12 pr-4 py-3 bg-slate-800/50 border border-white/10 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all",required:!0})]}),a.jsxs("div",{className:"relative",children:[a.jsx(jn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),a.jsx("input",{type:"email",name:"email",placeholder:"Email",value:o.email,onChange:q,className:"w-full pl-12 pr-4 py-3 bg-slate-800/50 border border-white/10 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all",required:!0})]}),a.jsxs("div",{className:"relative",children:[a.jsx(Br,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),a.jsx("input",{type:r?"text":"password",name:"password",placeholder:"Password",value:o.password,onChange:q,className:"w-full pl-12 pr-12 py-3 bg-slate-800/50 border border-white/10 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all",required:!0}),a.jsx("button",{type:"button",onClick:()=>n(!r),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white transition-colors",children:r?a.jsx(_n,{className:"w-5 h-5"}):a.jsx(Nn,{className:"w-5 h-5"})})]}),!e&&a.jsxs("div",{className:"relative",children:[a.jsx(Br,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),a.jsx("input",{type:"password",name:"confirmPassword",placeholder:"Confirm Password",value:o.confirmPassword,onChange:q,className:"w-full pl-12 pr-4 py-3 bg-slate-800/50 border border-white/10 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all",required:!0})]}),a.jsx("button",{type:"submit",onClick:M,disabled:c,className:"w-full py-3 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed text-white font-bold rounded-xl transition-all transform hover:scale-105 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-purple-500",children:c?"Loading...":e?"Sign In":"Create Account"})]}),a.jsx("div",{className:"mt-6 text-center",children:a.jsxs("p",{className:"text-gray-400",children:[e?"Don't have an account?":"Already have an account?",a.jsx("button",{onClick:oe,className:"ml-2 text-purple-400 hover:text-purple-300 font-semibold transition-colors",children:e?"Sign Up":"Sign In"})]})})]})]}),h&&a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-green-600/20 via-emerald-600/20 to-teal-500/20 rounded-2xl blur-xl"}),a.jsxs("div",{className:"relative bg-gradient-to-br from-slate-900/95 to-slate-800/95 backdrop-blur-xl rounded-2xl border border-white/10 p-8 shadow-2xl",children:[a.jsx("h3",{className:"text-2xl font-bold text-white mb-6 text-center",children:"Ready to Play?"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("button",{onClick:_,className:"w-full py-4 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white font-semibold rounded-xl transition-all transform hover:scale-105 flex items-center justify-center",children:[a.jsx(xs,{className:"w-5 h-5 mr-2"}),"Create New Room"]}),a.jsx("div",{className:"text-center text-sm text-gray-400",children:"Or join an existing room from the list →"})]})]})]}),a.jsx("div",{className:"space-y-6",children:a.jsxs("div",{className:"bg-gradient-to-br from-slate-900/80 to-slate-800/80 backdrop-blur-xl rounded-2xl border border-white/10 p-6",children:[a.jsxs("h3",{className:"text-2xl font-bold text-white mb-4 flex items-center",children:[a.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full mr-3 animate-pulse"}),"Waiting for Players",x&&a.jsx("div",{className:"ml-auto text-sm text-gray-400",children:"Loading..."})]}),a.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto scrollbar-hide",children:p.length===0?a.jsxs("div",{className:"text-center py-8 text-gray-400",children:[a.jsx("div",{className:"text-4xl mb-2",children:"🎮"}),a.jsx("p",{className:"font-medium",children:"No active lobbies"}),a.jsx("p",{className:"text-sm",children:"Create a room or join a random game!"})]}):p.map(v=>{var E,G;return a.jsxs("div",{className:`bg-slate-800/50 rounded-xl p-4 border border-white/5 transition-all ${h?"hover:border-green-400/30 cursor-pointer transform hover:scale-105":"opacity-50"}`,onClick:()=>h&&ee(v.id),children:[a.jsxs("div",{className:"flex justify-between items-start mb-2",children:[a.jsx("h4",{className:"font-semibold text-white",children:v.name}),a.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-green-500/20 text-green-400 border border-green-400/30",children:"Join"})]}),a.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-400",children:[a.jsxs("span",{children:["Host: ",((E=v.host)==null?void 0:E.username)||"Unknown"]}),a.jsxs("span",{className:"text-yellow-400 font-semibold",children:[v.current_players,"/",v.max_players]})]}),((G=v.game_settings)==null?void 0:G.fast_mode)&&a.jsx("div",{className:"mt-1",children:a.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-orange-500/20 text-orange-400",children:"⚡ Fast Mode"})}),h?a.jsxs("div",{className:"mt-2 text-xs text-green-400 flex items-center",children:[a.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full mr-2 animate-pulse"}),"Click to join lobby"]}):a.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"Sign in to join"})]},v.id)})})]})})]}),a.jsx("div",{className:"text-center mt-16 text-gray-400",children:a.jsx("p",{children:"© 2025 Bonkopoly. The most addictive property trading game online."})})]}),y&&a.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-gradient-to-br from-slate-900/95 to-slate-800/95 backdrop-blur-xl rounded-2xl border border-white/10 p-6 w-full max-w-md shadow-2xl",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("h3",{className:"text-2xl font-bold text-white flex items-center",children:[a.jsx(yr,{className:"mr-3 text-purple-400"}),"Create Room"]}),a.jsx("button",{onClick:()=>j(!1),className:"text-gray-400 hover:text-white transition-colors",children:a.jsx(Je,{className:"w-6 h-6"})})]}),d&&a.jsx("div",{className:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-sm",children:d}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Room Name"}),a.jsx("input",{type:"text",value:S.name,onChange:v=>k({...S,name:v.target.value}),placeholder:"Enter room name...",className:"w-full px-4 py-2 bg-slate-800/50 border border-white/10 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Max Players"}),a.jsx("div",{className:"grid grid-cols-4 gap-2",children:[2,4,6,8].map(v=>a.jsx("button",{onClick:()=>k({...S,maxPlayers:v}),className:`py-2 px-3 rounded-lg font-semibold transition-all ${S.maxPlayers===v?"bg-purple-600 text-white":"bg-slate-700/50 text-gray-300 hover:bg-slate-600/50"}`,children:v},v))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Room Type"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsx("button",{onClick:()=>k({...S,isPrivate:!1,password:""}),className:`py-3 px-4 rounded-lg font-semibold transition-all flex items-center justify-center ${S.isPrivate?"bg-slate-700/50 text-gray-300 hover:bg-slate-600/50":"bg-green-600 text-white"}`,children:"🌍 Public"}),a.jsx("button",{onClick:()=>k({...S,isPrivate:!0}),className:`py-3 px-4 rounded-lg font-semibold transition-all flex items-center justify-center ${S.isPrivate?"bg-purple-600 text-white":"bg-slate-700/50 text-gray-300 hover:bg-slate-600/50"}`,children:"🔒 Private"})]})]}),S.isPrivate&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Password"}),a.jsx("input",{type:"password",value:S.password,onChange:v=>k({...S,password:v.target.value}),placeholder:"Enter password...",className:"w-full px-4 py-2 bg-slate-800/50 border border-white/10 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Game Speed"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsx("button",{onClick:()=>k({...S,fastMode:!1}),className:`py-3 px-4 rounded-lg font-semibold transition-all flex items-center justify-center ${S.fastMode?"bg-slate-700/50 text-gray-300 hover:bg-slate-600/50":"bg-blue-600 text-white"}`,children:"🐢 Normal"}),a.jsx("button",{onClick:()=>k({...S,fastMode:!0}),className:`py-3 px-4 rounded-lg font-semibold transition-all flex items-center justify-center ${S.fastMode?"bg-orange-600 text-white":"bg-slate-700/50 text-gray-300 hover:bg-slate-600/50"}`,children:"⚡ Fast"})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:S.fastMode?"Reduced timers for faster gameplay":"Standard game timers and pace"})]})]}),a.jsxs("div",{className:"mt-6 flex gap-3",children:[a.jsx("button",{onClick:()=>j(!1),className:"flex-1 py-3 bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-lg transition-colors",children:"Cancel"}),a.jsx("button",{onClick:se,disabled:c,className:"flex-1 py-3 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed text-white font-semibold rounded-lg transition-all",children:c?"Creating...":"Create Room"})]})]})})]})},fs=s=>{let e;const t=new Set,r=(u,h)=>{const m=typeof u=="function"?u(e):u;if(!Object.is(m,e)){const p=e;e=h??(typeof m!="object"||m===null)?m:Object.assign({},e,m),t.forEach(g=>g(e,p))}},n=()=>e,l={setState:r,getState:n,getInitialState:()=>d,subscribe:u=>(t.add(u),()=>t.delete(u)),destroy:()=>{t.clear()}},d=e=s(r,n,l);return l},Rl=s=>s?fs(s):fs;var mn={exports:{}},fn={},pn={exports:{}},gn={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var We=f;function Il(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var Ol=typeof Object.is=="function"?Object.is:Il,Al=We.useState,Ll=We.useEffect,Bl=We.useLayoutEffect,Ml=We.useDebugValue;function Ul(s,e){var t=e(),r=Al({inst:{value:t,getSnapshot:e}}),n=r[0].inst,o=r[1];return Bl(function(){n.value=t,n.getSnapshot=e,tr(n)&&o({inst:n})},[s,t,e]),Ll(function(){return tr(n)&&o({inst:n}),s(function(){tr(n)&&o({inst:n})})},[s]),Ml(t),t}function tr(s){var e=s.getSnapshot;s=s.value;try{var t=e();return!Ol(s,t)}catch{return!0}}function Dl(s,e){return e()}var Fl=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Dl:Ul;gn.useSyncExternalStore=We.useSyncExternalStore!==void 0?We.useSyncExternalStore:Fl;pn.exports=gn;var Gl=pn.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gt=f,Hl=Gl;function ql(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var zl=typeof Object.is=="function"?Object.is:ql,Vl=Hl.useSyncExternalStore,Wl=Gt.useRef,Jl=Gt.useEffect,Kl=Gt.useMemo,Yl=Gt.useDebugValue;fn.useSyncExternalStoreWithSelector=function(s,e,t,r,n){var o=Wl(null);if(o.current===null){var i={hasValue:!1,value:null};o.current=i}else i=o.current;o=Kl(function(){function l(p){if(!d){if(d=!0,u=p,p=r(p),n!==void 0&&i.hasValue){var g=i.value;if(n(g,p))return h=g}return h=p}if(g=h,zl(u,p))return g;var x=r(p);return n!==void 0&&n(g,x)?(u=p,g):(u=p,h=x)}var d=!1,u,h,m=t===void 0?null:t;return[function(){return l(e())},m===null?void 0:function(){return l(m())}]},[e,t,r,n]);var c=Vl(s,o[0],o[1]);return Jl(function(){i.hasValue=!0,i.value=c},[c]),Yl(c),c};mn.exports=fn;var Xl=mn.exports;const Zl=bn(Xl),{useDebugValue:Ql}=gs,{useSyncExternalStoreWithSelector:ec}=Zl;const tc=s=>s;function rc(s,e=tc,t){const r=ec(s.subscribe,s.getState,s.getServerState||s.getInitialState,e,t);return Ql(r),r}const ps=s=>{const e=typeof s=="function"?Rl(s):s,t=(r,n)=>rc(e,r,n);return Object.assign(t,e),t},sc=s=>s?ps(s):ps,nc=[{id:1,type:"chance",title:"Advance to GO",description:"Advance to GO (Collect $200)",action:"move",position:0},{id:2,type:"chance",title:"Advance to BTC",description:"Advance to BTC. If you pass GO, collect $200",action:"move",position:37},{id:3,type:"chance",title:"Advance to BONK",description:"Advance to BONK. If you pass GO, collect $200",action:"move",position:1},{id:4,type:"chance",title:"Advance to nearest Railroad",description:"Advance to the nearest Railroad. If unowned, you may buy it. If owned, pay owner twice the rental.",action:"move_nearest",nearestType:"railroad"},{id:5,type:"chance",title:"Advance to nearest Railroad",description:"Advance to the nearest Railroad. If unowned, you may buy it. If owned, pay owner twice the rental.",action:"move_nearest",nearestType:"railroad"},{id:6,type:"chance",title:"Advance to nearest Utility",description:"Advance to the nearest Utility. If unowned, you may buy it. If owned, throw dice and pay owner 10 times the amount thrown.",action:"move_nearest",nearestType:"utility"},{id:7,type:"chance",title:"Bank pays you dividend",description:"Bank pays you dividend of $50",action:"collect",amount:50},{id:8,type:"chance",title:"Get out of Jail Free",description:"This card may be kept until needed or sold/traded",action:"jail_free"},{id:9,type:"chance",title:"Go Back 3 Spaces",description:"Go Back Three Spaces",action:"move_back"},{id:10,type:"chance",title:"Go to Jail",description:"Go directly to Jail. Do not pass GO, do not collect $200",action:"jail"},{id:11,type:"chance",title:"Make general repairs",description:"Make general repairs on all your property. For each house pay $25. For each hotel pay $100",action:"repairs",houseRepairCost:25,hotelRepairCost:100},{id:12,type:"chance",title:"Speeding fine",description:"Pay speeding fine of $15",action:"pay",amount:15},{id:13,type:"chance",title:"Take a trip to Reading Railroad",description:"Take a trip to Reading Railroad. If you pass GO, collect $200",action:"move",position:5},{id:14,type:"chance",title:"Pay each player",description:"You have been elected Chairman of the Board. Pay each player $50",action:"pay",amount:50},{id:15,type:"chance",title:"Building loan matures",description:"Your building loan matures. Collect $150",action:"collect",amount:150}],oc=[{id:1,type:"community",title:"Advance to GO",description:"Advance to GO (Collect $200)",action:"move",position:0},{id:2,type:"community",title:"Bank error in your favor",description:"Bank error in your favor. Collect $200",action:"collect",amount:200},{id:3,type:"community",title:"Doctor's fee",description:"Doctor's fee. Pay $50",action:"pay",amount:50},{id:4,type:"community",title:"Get out of Jail Free",description:"This card may be kept until needed or sold/traded",action:"jail_free"},{id:5,type:"community",title:"Go to Jail",description:"Go directly to Jail. Do not pass GO, do not collect $200",action:"jail"},{id:6,type:"community",title:"Holiday fund matures",description:"Holiday fund matures. Receive $100",action:"collect",amount:100},{id:7,type:"community",title:"Income tax refund",description:"Income tax refund. Collect $20",action:"collect",amount:20},{id:8,type:"community",title:"Life insurance matures",description:"Life insurance matures. Collect $100",action:"collect",amount:100},{id:9,type:"community",title:"Pay hospital fees",description:"Pay hospital fees of $100",action:"pay",amount:100},{id:10,type:"community",title:"Pay school fees",description:"Pay school fees of $50",action:"pay",amount:50},{id:11,type:"community",title:"Receive consultancy fee",description:"Receive $25 consultancy fee",action:"collect",amount:25},{id:12,type:"community",title:"Street repairs",description:"You are assessed for street repairs. $40 per house. $115 per hotel",action:"repairs",houseRepairCost:40,hotelRepairCost:115},{id:13,type:"community",title:"You won second prize",description:"You have won second prize in a beauty contest. Collect $10",action:"collect",amount:10},{id:14,type:"community",title:"You inherit",description:"You inherit $100",action:"collect",amount:100},{id:15,type:"community",title:"From sale of stock",description:"From sale of stock you get $50",action:"collect",amount:50}],wt={maxHousesPerProperty:4,maxHotelsPerProperty:1,totalHousesInGame:32,totalHotelsInGame:12,mortgageInterestRate:.1,jailFine:50,passingGoBonus:200,landingOnGoBonus:200},$e=[{name:"brown",color:"#8B4513",size:2,properties:[1,3],maxHouses:4,housePrice:50,hotelPrice:50},{name:"lightblue",color:"#87CEEB",size:3,properties:[6,8,9],maxHouses:4,housePrice:50,hotelPrice:50},{name:"pink",color:"#FF69B4",size:3,properties:[11,13,14],maxHouses:4,housePrice:100,hotelPrice:100},{name:"orange",color:"#FFA500",size:3,properties:[16,18,19],maxHouses:4,housePrice:100,hotelPrice:100},{name:"red",color:"#FF0000",size:3,properties:[21,23,24],maxHouses:4,housePrice:150,hotelPrice:150},{name:"yellow",color:"#FFFF00",size:3,properties:[26,27,29],maxHouses:4,housePrice:150,hotelPrice:150},{name:"green",color:"#00FF00",size:3,properties:[31,32,34],maxHouses:4,housePrice:200,hotelPrice:200},{name:"darkblue",color:"#0000FF",size:2,properties:[37,39],maxHouses:4,housePrice:200,hotelPrice:200},{name:"railroad",color:"#FFFFFF",size:4,properties:[5,15,25,35],maxHouses:0,housePrice:0,hotelPrice:0},{name:"utility",color:"#FFFFFF",size:2,properties:[12,28],maxHouses:0,housePrice:0,hotelPrice:0}],ac=()=>[{id:0,name:"GO",type:"special",price:0,group:"special",owner:null,houses:0,housePrice:0,mortgage:!1,mortgageValue:0,description:" ",icon:"🏁",color:"#fff",rent:[0]},{id:1,name:"BONK",type:"property",price:60,color:"#8B4513",rent:[2,10,30,90,160,250],group:"brown",owner:null,houses:0,housePrice:50,mortgage:!1,mortgageValue:30},{id:2,name:"Chest",type:"community",price:0,group:"special",owner:null,houses:0,housePrice:0,mortgage:!1,mortgageValue:0,icon:"💰",color:"#fff",rent:[0]},{id:3,name:"DOGE",type:"property",price:60,color:"#8B4513",rent:[4,20,60,180,320,450],group:"brown",owner:null,houses:0,housePrice:50,mortgage:!1,mortgageValue:30},{id:4,name:"Income Tax",type:"tax",price:0,group:"special",owner:null,houses:0,housePrice:0,mortgage:!1,mortgageValue:0,tax:200,icon:"💸",color:"#fff",rent:[0]},{id:5,name:"Reading Railroad",type:"railroad",price:200,group:"railroad",owner:null,houses:0,housePrice:0,mortgage:!1,mortgageValue:100,icon:"🚂",color:"#fff",rent:[25,50,100,200]},{id:6,name:"MATIC",type:"property",price:100,color:"#87CEEB",rent:[6,30,90,270,400,550],group:"lightblue",owner:null,houses:0,housePrice:50,mortgage:!1,mortgageValue:50},{id:7,name:"Chance",type:"chance",price:0,group:"special",owner:null,houses:0,housePrice:0,mortgage:!1,mortgageValue:0,icon:"❓",color:"#fff",rent:[0]},{id:8,name:"AVAX",type:"property",price:100,color:"#87CEEB",rent:[6,30,90,270,400,550],group:"lightblue",owner:null,houses:0,housePrice:50,mortgage:!1,mortgageValue:50},{id:9,name:"FTM",type:"property",price:120,color:"#87CEEB",rent:[8,40,100,300,450,600],group:"lightblue",owner:null,houses:0,housePrice:50,mortgage:!1,mortgageValue:60},{id:10,name:"JAIL",type:"special",price:0,group:"special",owner:null,houses:0,housePrice:0,mortgage:!1,mortgageValue:0,description:" ",icon:"🚔",color:"#fff",rent:[0]},{id:11,name:"UNI",type:"property",price:140,color:"#FF69B4",rent:[10,50,150,450,625,750],group:"pink",owner:null,houses:0,housePrice:70,mortgage:!1,mortgageValue:70},{id:12,name:"Electric Company",type:"utility",price:150,group:"utility",owner:null,houses:0,housePrice:0,mortgage:!1,mortgageValue:75,icon:"⚡",color:"#fff",rent:[4]},{id:13,name:"AAVE",type:"property",price:140,color:"#FF69B4",rent:[10,50,150,450,625,750],group:"pink",owner:null,houses:0,housePrice:70,mortgage:!1,mortgageValue:70},{id:14,name:"CRV",type:"property",price:160,color:"#FF69B4",rent:[12,60,180,500,700,900],group:"pink",owner:null,houses:0,housePrice:70,mortgage:!1,mortgageValue:80},{id:15,name:"Pennsylvania Railroad",type:"railroad",price:200,group:"railroad",owner:null,houses:0,housePrice:0,mortgage:!1,mortgageValue:100,icon:"🚂",color:"#fff",rent:[25,50,100,200]},{id:16,name:"LINK",type:"property",price:180,color:"#FFA500",rent:[14,70,200,550,750,950],group:"orange",owner:null,houses:0,housePrice:90,mortgage:!1,mortgageValue:90},{id:17,name:"Chest",type:"community",price:0,group:"special",owner:null,houses:0,housePrice:0,mortgage:!1,mortgageValue:0,icon:"💰",color:"#fff",rent:[0]},{id:18,name:"GRT",type:"property",price:180,color:"#FFA500",rent:[14,70,200,550,750,950],group:"orange",owner:null,houses:0,housePrice:90,mortgage:!1,mortgageValue:90},{id:19,name:"ARB",type:"property",price:200,color:"#FFA500",rent:[16,80,220,600,800,1e3],group:"orange",owner:null,houses:0,housePrice:90,mortgage:!1,mortgageValue:100},{id:20,name:"FREE PARKING",type:"special",price:0,group:"special",owner:null,houses:0,housePrice:0,mortgage:!1,mortgageValue:0,description:" ",icon:"🅿️",color:"#fff",rent:[0]},{id:21,name:"OpenSea",type:"property",price:220,color:"#FF0000",rent:[18,90,250,700,875,1050],group:"red",owner:null,houses:0,housePrice:110,mortgage:!1,mortgageValue:110},{id:22,name:"Chance",type:"chance",price:0,group:"special",owner:null,houses:0,housePrice:0,mortgage:!1,mortgageValue:0,icon:"❓",color:"#fff",rent:[0]},{id:23,name:"Blur",type:"property",price:220,color:"#FF0000",rent:[18,90,250,700,875,1050],group:"red",owner:null,houses:0,housePrice:110,mortgage:!1,mortgageValue:110},{id:24,name:"Rarible",type:"property",price:240,color:"#FF0000",rent:[20,100,300,750,925,1100],group:"red",owner:null,houses:0,housePrice:110,mortgage:!1,mortgageValue:120},{id:25,name:"B. & O. Railroad",type:"railroad",price:200,group:"railroad",owner:null,houses:0,housePrice:0,mortgage:!1,mortgageValue:100,icon:"🚂",color:"#fff",rent:[25,50,100,200]},{id:26,name:"Binance",type:"property",price:260,color:"#FFFF00",rent:[22,110,330,800,975,1150],group:"yellow",owner:null,houses:0,housePrice:130,mortgage:!1,mortgageValue:130},{id:27,name:"Coinbase",type:"property",price:260,color:"#FFFF00",rent:[22,110,330,800,975,1150],group:"yellow",owner:null,houses:0,housePrice:130,mortgage:!1,mortgageValue:130},{id:28,name:"Water Works",type:"utility",price:150,group:"utility",owner:null,houses:0,housePrice:0,mortgage:!1,mortgageValue:75,icon:"💧",color:"#fff",rent:[4]},{id:29,name:"Kraken",type:"property",price:280,color:"#FFFF00",rent:[24,120,360,850,1025,1200],group:"yellow",owner:null,houses:0,housePrice:130,mortgage:!1,mortgageValue:140},{id:30,name:"GO TO JAIL",type:"special",price:0,group:"special",owner:null,houses:0,housePrice:0,mortgage:!1,mortgageValue:0,description:" ",icon:"👮",color:"#fff",rent:[0]},{id:31,name:"SOL",type:"property",price:300,color:"#00FF00",rent:[26,130,390,900,1100,1275],group:"green",owner:null,houses:0,housePrice:150,mortgage:!1,mortgageValue:150},{id:32,name:"ADA",type:"property",price:300,color:"#00FF00",rent:[26,130,390,900,1100,1275],group:"green",owner:null,houses:0,housePrice:150,mortgage:!1,mortgageValue:150},{id:33,name:"Chest",type:"community",price:0,group:"special",owner:null,houses:0,housePrice:0,mortgage:!1,mortgageValue:0,icon:"💰",color:"#fff",rent:[0]},{id:34,name:"DOT",type:"property",price:320,color:"#00FF00",rent:[28,150,450,1e3,1200,1400],group:"green",owner:null,houses:0,housePrice:150,mortgage:!1,mortgageValue:160},{id:35,name:"Short Line",type:"railroad",price:200,group:"railroad",owner:null,houses:0,housePrice:0,mortgage:!1,mortgageValue:100,icon:"🚂",color:"#fff",rent:[25,50,100,200]},{id:36,name:"Chance",type:"chance",price:0,group:"special",owner:null,houses:0,housePrice:0,mortgage:!1,mortgageValue:0,icon:"❓",color:"#fff",rent:[0]},{id:37,name:"BTC",type:"property",price:350,color:"#0000FF",rent:[35,175,500,1100,1300,1500],group:"darkblue",owner:null,houses:0,housePrice:175,mortgage:!1,mortgageValue:175},{id:38,name:"Luxury Tax",type:"tax",price:0,group:"special",owner:null,houses:0,housePrice:0,mortgage:!1,mortgageValue:0,tax:100,icon:"💎",color:"#fff",rent:[0]},{id:39,name:"ETH",type:"property",price:400,color:"#0000FF",rent:[50,200,600,1400,1700,2e3],group:"darkblue",owner:null,houses:0,housePrice:200,mortgage:!1,mortgageValue:200}],C=(s,e)=>{s.gameLog.push(e),s.gameLog.length>20&&s.gameLog.shift()},Y=sc((s,e)=>({gameStarted:!1,players:[],properties:ac(),currentPlayer:0,selectedProperty:null,setSelectedProperty:t=>s({selectedProperty:t}),diceRolled:!1,lastRoll:[1,1],gameLog:[],doubleCount:0,chanceCards:[...nc].sort(()=>Math.random()-.5),communityChestCards:[...oc].sort(()=>Math.random()-.5),currentCard:null,isBuildingControlsOpen:!1,hasBuiltThisTurn:!1,currentAuction:null,roomId:null,setRoomId:t=>{console.log("🆔 Setting roomId to:",t),s({roomId:t}),console.log("🆔 RoomId set, current state:",e().roomId)},activeTradeOffers:[],tradeSessions:[],isTradeModalOpen:!1,currentTradeSession:null,openTradeModal:()=>{const t=Date.now();console.log("🔄 Opening trade modal..."),s(r=>({...r,isTradeModalOpen:!0,lastActionTimestamp:t}))},closeTradeModal:()=>{const t=Date.now();console.log("🔄 Closing trade modal..."),s(r=>({...r,isTradeModalOpen:!1,currentTradeSession:null,lastActionTimestamp:t}))},createTradeSession:t=>{const r=Date.now(),n=`trade_${r}_${Math.random().toString(36).substr(2,9)}`,o=e().currentPlayer,i={id:n,participantIds:t,createdBy:o,status:"active",timestamp:r};return console.log("🤝 Creating trade session:",n,"with participants:",t),s(c=>({...c,tradeSessions:[...c.tradeSessions,i],currentTradeSession:i,lastActionTimestamp:r})),C(e(),`🤝 ${e().getCurrentPlayer().name} started a trade session`),e().roomId&&setTimeout(async()=>{try{const c=e(),l={playerId:c.getCurrentPlayer().userId,action:"create_trade_session",sessionId:n,participantIds:t,timestamp:r};await D.updateGameState(e().roomId,c,l)}catch(c){console.error("❌ Failed to sync trade session creation:",c)}},0),n},createTradeOffer:(t,r)=>{const n=Date.now(),o=`offer_${n}_${Math.random().toString(36).substr(2,9)}`,i={...r,id:o,timestamp:n,status:"pending",expiresAt:n+2*60*1e3};console.log("📝 Creating trade offer:",o,"in session:",t),s(d=>{const u=d.tradeSessions.map(h=>h.id===t?{...h,currentOffer:i}:h);return{...d,activeTradeOffers:[...d.activeTradeOffers,i],tradeSessions:u,lastActionTimestamp:n}});const c=e().players[r.fromPlayerId],l=e().players[r.toPlayerId];C(e(),`📝 ${c.name} made a trade offer to ${l.name}`),e().roomId&&setTimeout(async()=>{try{const d=e(),u={playerId:c.userId,action:"create_trade_offer",sessionId:t,offerId:o,timestamp:n};await D.updateGameState(e().roomId,d,u)}catch(d){console.error("❌ Failed to sync trade offer creation:",d)}},0)},updateTradeOffer:(t,r)=>{const n=Date.now(),i=e().tradeSessions.find(d=>d.id===t);if(!i||!i.currentOffer){console.warn("❌ Cannot update offer - session or offer not found");return}const c={...i.currentOffer,...r,timestamp:n,expiresAt:n+2*60*1e3};console.log("📝 Updating trade offer:",c.id,"in session:",t),s(d=>{const u=d.tradeSessions.map(m=>m.id===t?{...m,currentOffer:c}:m),h=d.activeTradeOffers.map(m=>m.id===c.id?c:m);return{...d,activeTradeOffers:h,tradeSessions:u,lastActionTimestamp:n}});const l=e().players[r.fromPlayerId];C(e(),`📝 ${l.name} updated their trade offer`),e().roomId&&setTimeout(async()=>{try{const d=e(),u={playerId:l.userId,action:"update_trade_offer",sessionId:t,offerId:c.id,timestamp:n};await D.updateGameState(e().roomId,d,u)}catch(d){console.error("❌ Failed to sync trade offer update:",d)}},0)},mortgageProperty:t=>{const r=Date.now(),n=e(),o=n.properties[t];if(!o||o.owner===null)return console.log("❌ Property has no owner"),!1;const i=n.players[o.owner];if(console.log("🏦 Mortgaging property:",t,o.name),!e().canMortgageProperty(t))return console.log("❌ Cannot mortgage property"),!1;const c=o.mortgageValue;return s(l=>{const d=[...l.properties],u=[...l.players];return d[t]={...o,mortgage:!0},u[o.owner]={...i,money:i.money+c},C(l,`🏦 ${i.name} mortgaged ${o.name} for $${c}`),{...l,properties:d,players:u,lastActionTimestamp:r}}),e().roomId&&setTimeout(async()=>{try{const l=e(),d={playerId:i.userId,action:"mortgageProperty",propertyId:t,propertyName:o.name,mortgageValue:c,timestamp:r};await D.updateGameState(e().roomId,l,d),console.log("✅ Synced property mortgage")}catch(l){console.error("❌ Failed to sync property mortgage:",l)}},0),!0},unmortgageProperty:t=>{const r=Date.now(),n=e(),o=n.properties[t];if(!o||o.owner===null)return console.log("❌ Property has no owner"),!1;const i=n.players[o.owner],c=Math.floor(o.mortgageValue*(1+wt.mortgageInterestRate));return s(l=>{const d=[...l.properties],u=[...l.players];return d[t]={...o,mortgage:!1},u[o.owner]={...i,money:i.money-c},C(l,`💰 ${i.name} unmortgaged ${o.name} for $${c}`),{...l,properties:d,players:u,lastActionTimestamp:r}}),e().roomId&&setTimeout(async()=>{try{const l=e(),d={playerId:i.userId,action:"unmortgageProperty",propertyId:t,propertyName:o.name,unmortgageCost:c,timestamp:r};await D.updateGameState(e().roomId,l,d),console.log("✅ Synced property unmortgage")}catch(l){console.error("❌ Failed to sync property unmortgage:",l)}},0),!0},canMortgageProperty:t=>{const{properties:r,players:n}=e(),o=r[t];if(!o||o.owner===null||o.mortgage||o.houses>0||o.type!=="property"&&o.type!=="railroad"&&o.type!=="utility")return!1;if(o.type==="property"){const i=$e.find(c=>c.name===o.group);if(i&&i.properties.map(d=>r[d]).some(d=>d.houses>0))return!1}return!0},canUnmortgageProperty:t=>{const{properties:r,players:n}=e(),o=r[t];if(!o||o.owner===null||!o.mortgage)return!1;const i=n[o.owner],c=Math.floor(o.mortgageValue*(1+wt.mortgageInterestRate));return i.money>=c},sellHouse:t=>{const r=Date.now(),n=e(),o=n.properties[t];if(!o||o.owner===null)return console.log("❌ Property has no owner"),!1;const i=n.players[o.owner],c=Math.floor(o.housePrice/2);return s(l=>{const d=[...l.properties],u=[...l.players];o.houses===5?d[t]={...o,houses:4}:d[t]={...o,houses:o.houses-1},u[o.owner]={...i,money:i.money+c};const h=o.houses===5?"hotel":"house";return C(l,`🏠💰 ${i.name} sold a ${h} on ${o.name} for $${c}`),{...l,properties:d,players:u,lastActionTimestamp:r}}),e().roomId&&setTimeout(async()=>{try{const l=e(),d={playerId:i.userId,action:"sellBuilding",propertyId:t,propertyName:o.name,sellPrice:c,newHouseCount:o.houses===5?4:o.houses-1,timestamp:r};await D.updateGameState(e().roomId,l,d),console.log("✅ Synced building sale")}catch(l){console.error("❌ Failed to sync building sale:",l)}},0),!0},canSellBuilding:t=>{const{properties:r}=e(),n=r[t];if(!n||n.owner===null||n.houses===0||n.type!=="property")return!1;const o=$e.find(i=>i.name===n.group);if(o){const i=o.properties.map(l=>r[l]),c=Math.max(...i.map(l=>l.houses));return n.houses===c}return!0},calculatePlayerAssets:t=>{const{players:r,properties:n}=e(),o=r[t];let i=o.money;return o.properties.forEach(c=>{const l=n[c];if(l.mortgage?i+=0:i+=l.mortgageValue,l.houses>0&&l.houses<5)i+=Math.floor(l.houses*l.housePrice/2);else if(l.houses===5){const d=$e.find(u=>u.name===l.group);d&&(i+=Math.floor(d.hotelPrice/2))}}),i},forceSellAssets:(t,r)=>{const n=e(),o=n.players[t];let i=0;return console.log(`💸 Player ${o.name} needs $${r}, forcing asset sales...`),o.properties.forEach(c=>{const l=n.properties[c];if(l.houses>0){for(;l.houses>0&&i<r;)if(e().canSellBuilding(c)){const d=Math.floor(l.housePrice/2);e().sellHouse(c),i+=d,C(n,`🏠💸 ${o.name} was forced to sell a building for $${d}`)}}}),i<r&&o.properties.forEach(c=>{if(!(i>=r)&&e().canMortgageProperty(c)){const l=n.properties[c];e().mortgageProperty(c),i+=l.mortgageValue,C(n,`🏦💸 ${o.name} was forced to mortgage ${l.name}`)}}),i>=r},handleBankruptcy:t=>{const r=Date.now(),o=e().players[t];console.log(`💀 Handling bankruptcy for player: ${o.name}`),s(i=>{const c=[...i.players],l=[...i.properties];return o.properties.forEach(d=>{l[d]={...l[d],owner:null,mortgage:!1,houses:0}}),c[t]={...o,money:0,properties:[],bankrupt:!0},C(i,`💀 ${o.name} went bankrupt! All properties returned to the bank.`),{...i,players:c,properties:l,lastActionTimestamp:r}}),e().roomId&&setTimeout(async()=>{try{const i=e(),c={playerId:o.userId,action:"handleBankruptcy",playerName:o.name,timestamp:r};await D.updateGameState(e().roomId,i,c),console.log("✅ Synced bankruptcy")}catch(i){console.error("❌ Failed to sync bankruptcy:",i)}},0)},declinePropertyPurchase:t=>{const r=e(),n=r.properties[t],o=r.players[r.currentPlayer];console.log(`🏛️ ${o.name} declined to buy ${n.name}, starting auction...`),C(r,`🏛️ ${o.name} declined to buy ${n.name}. Starting auction!`),e().startPropertyAuction(t)},startPropertyAuction:t=>{const r=Date.now(),n=e(),o=n.properties[t],i=n.currentPlayer,c=n.players.map((d,u)=>u).filter(d=>!n.players[d].bankrupt&&d!==i);console.log("🏛️ Starting auction with immediate sync:",{propertyId:t,propertyName:o.name,auctionCreator:n.players[i].name,auctionCreatorUserId:n.players[i].userId,participants:c.map(d=>({index:d,name:n.players[d].name,userId:n.players[d].userId})),startingBid:o.price,participantCount:c.length,timestamp:r});const l={propertyId:t,currentBid:o.price,currentBidder:null,timeLeft:3e4,participants:c,timestamp:r,auctionCreator:i,activeParticipants:[...c],declinedParticipants:[]};s(d=>({...d,currentAuction:l,selectedProperty:null,lastActionTimestamp:r})),C(n,`🏛️ ${n.players[i].name} started auction for ${o.name}! Starting at $${o.price.toLocaleString()}`),e().roomId&&(console.log("📡 FORCING immediate auction sync to all players..."),D.updateGameState(e().roomId,e(),{playerId:n.players[i].userId,action:"startPropertyAuction",propertyId:t,propertyName:o.name,auctionCreator:i,auctionCreatorName:n.players[i].name,auctionCreatorUserId:n.players[i].userId,participantCount:c.length,auctionData:l,timestamp:r,forceSync:!0}).then(()=>{console.log("✅ AUCTION SYNCED TO ALL PLAYERS IMMEDIATELY")}).catch(d=>{console.error("❌ CRITICAL: Auction sync failed:",d),setTimeout(()=>{console.log("🔄 Retrying auction sync..."),D.updateGameState(e().roomId,e(),{playerId:n.players[i].userId,action:"startPropertyAuction_retry",auctionData:l,timestamp:r})},200)}))},increaseBid:t=>{var d,u;const r=Date.now(),n=e(),o=n.currentAuction,i=n.players[t];if(!o||!i)return;const c=o.currentBid+20;if(console.log("💰 INCREASE BID:",{playerId:t,playerName:i.name,oldBid:o.currentBid,newBid:c,playerMoney:i.money,canAfford:i.money>=c,activeParticipants:((d=o.activeParticipants)==null?void 0:d.length)||0}),i.money<c){C(n,`❌ ${i.name} cannot afford $${c.toLocaleString()}!`);return}s(h=>({...h,currentAuction:{...o,currentBid:c,currentBidder:t,timeLeft:Math.max(o.timeLeft,1e4)},lastActionTimestamp:r})),C(n,`💰 ${i.name} raised bid to $${c.toLocaleString()}!`),(((u=o.activeParticipants)==null?void 0:u.length)||o.participants.length)<=2&&(console.log("🏆 Only 2 participants left, immediate win!"),setTimeout(()=>{e().endAuction()},1e3)),e().roomId&&setTimeout(async()=>{try{const h=e(),m={playerId:i.userId,action:"increaseBid",newBid:c,playerName:i.name,timestamp:r};await D.updateGameState(e().roomId,h,m)}catch(h){console.error("❌ Failed to sync bid increase:",h)}},0)},declineAuction:t=>{const r=Date.now(),n=e(),o=n.currentAuction,i=n.players[t];if(!o||!i)return;console.log("❌ DECLINE AUCTION:",{playerId:t,playerName:i.name,activeParticipants:o.activeParticipants});const c=(o.activeParticipants||o.participants).filter(d=>d!==t),l=[...o.declinedParticipants||[],t];if(s(d=>({...d,currentAuction:{...o,activeParticipants:c,declinedParticipants:l},lastActionTimestamp:r})),C(n,`❌ ${i.name} declined to participate in auction`),c.length===1){const d=n.players[c[0]];C(n,`🏆 ${d.name} wins by default!`),setTimeout(()=>{e().endAuction()},1e3)}else c.length===0&&(C(n,"🚫 All players declined - property remains unsold"),setTimeout(()=>{e().endAuction()},1e3));e().roomId&&setTimeout(async()=>{try{const d=e(),u={playerId:i.userId,action:"declineAuction",playerName:i.name,remainingParticipants:c.length,timestamp:r};await D.updateGameState(e().roomId,d,u)}catch(d){console.error("❌ Failed to sync auction decline:",d)}},0)},placeBid:(t,r)=>{const n=Date.now(),o=e(),i=o.players[t],c=o.currentAuction;!c||c.propertyId===null||r<=c.currentBid||i.money<r||(s(l=>({...l,currentAuction:{...c,currentBid:r,currentBidder:t,timeLeft:Math.max(c.timeLeft,1e4)},lastActionTimestamp:n})),C(o,`🏛️ ${i.name} bid $${r}!`),e().roomId&&setTimeout(async()=>{try{const l=e(),d={playerId:i.userId,action:"placeBid",amount:r,playerName:i.name,timestamp:n};await D.updateGameState(e().roomId,l,d),console.log("✅ Synced bid placement")}catch(l){console.error("❌ Failed to sync bid placement:",l)}},0))},endAuction:()=>{const t=Date.now(),r=e(),n=r.currentAuction;if(!n||n.propertyId===null){console.warn("❌ No active auction to end");return}const o=r.properties[n.propertyId];if(n.currentBidder!==null){const i=r.players[n.currentBidder];s(c=>{const l=[...c.players],d=[...c.properties];return l[n.currentBidder]={...i,money:i.money-n.currentBid,properties:[...i.properties,n.propertyId]},d[n.propertyId]={...o,owner:n.currentBidder},{...c,players:l,properties:d,currentAuction:null,lastActionTimestamp:t}}),C(r,`🏛️ ${i.name} won the auction for ${o.name} with $${n.currentBid}!`)}else s(i=>({...i,currentAuction:null,lastActionTimestamp:t})),C(r,`🏛️ No bids received. ${o.name} remains unsold.`);e().roomId&&setTimeout(async()=>{try{const i=e(),c={playerId:r.getCurrentPlayer().userId,action:"endAuction",propertyId:n.propertyId,winner:n.currentBidder,finalBid:n.currentBid,timestamp:t};await D.updateGameState(e().roomId,i,c),console.log("✅ Synced auction end")}catch(i){console.error("❌ Failed to sync auction end:",i)}},0)},acceptTradeOffer:(t,r)=>{const n=Date.now(),i=e().activeTradeOffers.find(d=>d.id===r);if(!i||i.status!=="pending"){console.warn("❌ Cannot accept offer - offer not found or not pending");return}console.log("✅ Accepting trade offer:",r),e().executeTradeOffer(i),s(d=>{const u=d.activeTradeOffers.map(m=>m.id===r?{...m,status:"accepted"}:m),h=d.tradeSessions.map(m=>m.id===t?{...m,status:"completed"}:m);return{...d,activeTradeOffers:u,tradeSessions:h,isTradeModalOpen:!1,currentTradeSession:null,lastActionTimestamp:n}});const c=e().players[i.fromPlayerId],l=e().players[i.toPlayerId];C(e(),`✅ ${l.name} accepted ${c.name}'s trade offer!`),e().roomId&&setTimeout(async()=>{try{const d=e(),u={playerId:l.userId,action:"accept_trade_offer",sessionId:t,offerId:r,timestamp:n};await D.updateGameState(e().roomId,d,u)}catch(d){console.error("❌ Failed to sync trade offer acceptance:",d)}},0)},rejectTradeOffer:(t,r)=>{const n=Date.now(),i=e().activeTradeOffers.find(d=>d.id===r);if(!i){console.warn("❌ Cannot reject offer - offer not found");return}console.log("❌ Rejecting trade offer:",r),s(d=>{const u=d.activeTradeOffers.map(m=>m.id===r?{...m,status:"rejected"}:m),h=d.tradeSessions.map(m=>m.id===t?{...m,status:"cancelled"}:m);return{...d,activeTradeOffers:u,tradeSessions:h,lastActionTimestamp:n}});const c=e().players[i.fromPlayerId],l=e().players[i.toPlayerId];C(e(),`❌ ${l.name} rejected ${c.name}'s trade offer`),e().roomId&&setTimeout(async()=>{try{const d=e(),u={playerId:l.userId,action:"reject_trade_offer",sessionId:t,offerId:r,timestamp:n};await D.updateGameState(e().roomId,d,u)}catch(d){console.error("❌ Failed to sync trade offer rejection:",d)}},0)},cancelTradeSession:t=>{const r=Date.now();console.log("🚫 Cancelling trade session:",t),s(n=>{const o=n.tradeSessions.map(c=>c.id===t?{...c,status:"cancelled"}:c),i=n.activeTradeOffers.map(c=>{const l=n.tradeSessions.find(d=>{var u;return((u=d.currentOffer)==null?void 0:u.id)===c.id});return(l==null?void 0:l.id)===t?{...c,status:"expired"}:c});return{...n,activeTradeOffers:i,tradeSessions:o,isTradeModalOpen:!1,currentTradeSession:null,lastActionTimestamp:r}}),C(e(),"🚫 Trade session was cancelled"),e().roomId&&setTimeout(async()=>{try{const n=e(),o={playerId:n.getCurrentPlayer().userId,action:"cancel_trade_session",sessionId:t,timestamp:r};await D.updateGameState(e().roomId,n,o)}catch(n){console.error("❌ Failed to sync trade session cancellation:",n)}},0)},executeTradeOffer:t=>{const r=e(),n=r.players[t.fromPlayerId],o=r.players[t.toPlayerId];console.log("🔄 Executing trade offer:",{from:n.name,to:o.name,offeredProperties:t.offeredProperties,requestedProperties:t.requestedProperties,offeredMoney:t.offeredMoney,requestedMoney:t.requestedMoney});const i=e().validateTradeOffer(t);if(!i.valid){C(e(),`❌ Trade failed: ${i.reason}`);return}if(s(c=>{const l=[...c.players],d=[...c.properties];return l[t.fromPlayerId]={...n,money:n.money-t.offeredMoney+t.requestedMoney,properties:[...n.properties.filter(u=>!t.offeredProperties.includes(u)),...t.requestedProperties]},l[t.toPlayerId]={...o,money:o.money+t.offeredMoney-t.requestedMoney,properties:[...o.properties.filter(u=>!t.requestedProperties.includes(u)),...t.offeredProperties]},t.offeredProperties.forEach(u=>{d[u]={...d[u],owner:t.toPlayerId}}),t.requestedProperties.forEach(u=>{d[u]={...d[u],owner:t.fromPlayerId}}),{...c,players:l,properties:d}}),t.offeredProperties.length>0){const c=t.offeredProperties.map(l=>r.properties[l].name).join(", ");C(e(),`🏠 ${n.name} traded: ${c}`)}if(t.requestedProperties.length>0){const c=t.requestedProperties.map(l=>r.properties[l].name).join(", ");C(e(),`🏠 ${o.name} traded: ${c}`)}t.offeredMoney>0&&C(e(),`💰 ${n.name} paid $${t.offeredMoney}`),t.requestedMoney>0&&C(e(),`💰 ${o.name} paid $${t.requestedMoney}`),C(e(),"🤝 Trade completed successfully!")},validateTradeOffer:t=>{const r=e(),n=r.players[t.fromPlayerId],o=r.players[t.toPlayerId];if(n.money<t.offeredMoney)return{valid:!1,reason:`${n.name} doesn't have enough money`};if(o.money<t.requestedMoney)return{valid:!1,reason:`${o.name} doesn't have enough money`};for(const i of t.offeredProperties){const c=r.properties[i];if(c.owner!==t.fromPlayerId)return{valid:!1,reason:`${n.name} doesn't own ${c.name}`};if(c.mortgage)return{valid:!1,reason:`${c.name} is mortgaged`};if(c.houses>0)return{valid:!1,reason:`${c.name} has buildings`}}for(const i of t.requestedProperties){const c=r.properties[i];if(c.owner!==t.toPlayerId)return{valid:!1,reason:`${o.name} doesn't own ${c.name}`};if(c.mortgage)return{valid:!1,reason:`${c.name} is mortgaged`};if(c.houses>0)return{valid:!1,reason:`${c.name} has buildings`}}return{valid:!0}},cleanupExpiredOffers:()=>{const t=Date.now();s(r=>({...r,activeTradeOffers:r.activeTradeOffers.filter(n=>n.expiresAt>t||n.status!=="pending")}))},syncTradeData:t=>{console.log("🔄 Syncing trade data:",t),s(r=>({...r,tradeSessions:t.sessions,activeTradeOffers:t.offers}))},saveGameState:async()=>{console.log("💾 STORE: saveGameState called");const t=e();if(!t.roomId){console.warn("❌ Not saving - missing roomId");return}const r=t.players.map(o=>(o.userId||console.warn(`⚠️ Player ${o.name} is missing userId!`),o)),n={gameStarted:t.gameStarted,players:r,properties:t.properties,currentPlayer:t.currentPlayer,diceRolled:t.diceRolled,lastRoll:t.lastRoll,gameLog:t.gameLog,doubleCount:t.doubleCount,chanceCards:t.chanceCards,communityChestCards:t.communityChestCards,hasBuiltThisTurn:t.hasBuiltThisTurn,activeTradeOffers:t.activeTradeOffers,tradeSessions:t.tradeSessions,isTradeModalOpen:t.isTradeModalOpen,currentTradeSession:t.currentTradeSession};try{console.log("💾 Saving game state to database for room:",t.roomId),await ms.saveGameState(t.roomId,n),console.log("✅ Game state saved successfully")}catch(o){const i=o instanceof Error?o.message:"Unknown error";console.error("❌ Failed to save game state:",i),C(t,`❌ Failed to save game state: ${i}`)}},loadGameState:async t=>{try{const r=await ms.loadGameState(t);return r?(s({...r,roomId:t,selectedProperty:null,currentCard:null,isBuildingControlsOpen:!1,activeTradeOffers:r.activeTradeOffers||[],tradeSessions:r.tradeSessions||[],isTradeModalOpen:r.isTradeModalOpen||!1,currentTradeSession:r.currentTradeSession||null}),!0):!1}catch(r){return console.error("Failed to load game state:",r),!1}},syncGameState:(t,r)=>{var o,i,c;const n=e();if(console.log("🔄 SYNC: Received game state update:",{action:r==null?void 0:r.action,fromPlayerId:r==null?void 0:r.playerId,currentUserId:(o=n.getCurrentPlayer())==null?void 0:o.userId,timestamp:r==null?void 0:r.timestamp,hasAuction:!!t.currentAuction,auctionPropertyId:(i=t.currentAuction)==null?void 0:i.propertyId}),!t||!t.players||t.players.length===0){console.warn("❌ Invalid sync data received");return}if(r!=null&&r.timestamp&&n.lastActionTimestamp&&r.timestamp<n.lastActionTimestamp){console.log("⏰ Ignoring outdated sync data");return}console.log("✅ Applying game state sync:",{currentPlayer:t.currentPlayer,currentPlayerName:(c=t.players[t.currentPlayer])==null?void 0:c.name,diceRolled:t.diceRolled,action:r==null?void 0:r.action,auctionData:t.currentAuction}),s({gameStarted:t.gameStarted,players:t.players,properties:t.properties,currentPlayer:t.currentPlayer,diceRolled:t.diceRolled,lastRoll:t.lastRoll,gameLog:t.gameLog,doubleCount:t.doubleCount,chanceCards:t.chanceCards,communityChestCards:t.communityChestCards,hasBuiltThisTurn:t.hasBuiltThisTurn||!1,selectedProperty:t.selectedProperty||null,currentAuction:t.currentAuction||null,activeTradeOffers:t.activeTradeOffers||[],tradeSessions:t.tradeSessions||[],currentTradeSession:t.currentTradeSession||null,lastActionTimestamp:(r==null?void 0:r.timestamp)||Date.now()}),console.log("✅ Game state synchronized successfully")},openBuildingControls:()=>{const t=Date.now();console.log("🏗️ Opening building controls..."),s(r=>({...r,isBuildingControlsOpen:!0,lastActionTimestamp:t}))},closeBuildingControls:()=>{const t=Date.now();console.log("🏗️ Closing building controls..."),s(r=>({...r,isBuildingControlsOpen:!1,lastActionTimestamp:t}))},startGame:()=>{s({gameStarted:!0,doubleCount:0}),e().addToLog("🎮 BONKOPOLY STARTED! Time to go TO THE MOON! 🚀"),e().saveGameState()},rollDice:()=>{console.log("🎲 STORE: rollDice called");const t=Date.now(),r=Math.floor(Math.random()*6)+1,n=Math.floor(Math.random()*6)+1,o=r+n,i=r===n;s(c=>{const l=c.players[c.currentPlayer];if(l.inJail){const h=[...c.players],m={...l};if(m.jailTurns++,i){m.inJail=!1,m.jailTurns=0,h[c.currentPlayer]=m,C(c,`🎲 ${l.name} rolled (${r},${n}) - doubles! Got out of jail!`);const p={...c,players:h,lastRoll:[r,n],diceRolled:!1,doubleCount:1,lastActionTimestamp:t};return s(p),e().roomId?(async()=>{try{const g=e(),x={playerId:g.getCurrentPlayer().userId,action:"rollDice_jail_escape",dice1:r,dice2:n,isDouble:!0,timestamp:t};await D.updateGameState(e().roomId,g,x),console.log("✅ Synced jail escape dice roll"),setTimeout(()=>{e().movePlayer(c.currentPlayer,o,[r,n])},100)}catch(g){console.error("❌ Failed to sync jail escape dice roll:",g)}})():setTimeout(()=>{e().movePlayer(c.currentPlayer,o,[r,n])},100),p}else if(m.jailTurns===3){m.inJail=!1,m.jailTurns=0,m.money-=50,h[c.currentPlayer]=m,C(c,`🎲 ${l.name} rolled (${r},${n}) - paid $50 fine after three failed attempts`);const p={...c,players:h,lastRoll:[r,n],diceRolled:!0,doubleCount:0,lastActionTimestamp:t};return s(p),e().roomId?(async()=>{try{const g=e(),x={playerId:g.getCurrentPlayer().userId,action:"rollDice_forced_jail_payment",dice1:r,dice2:n,timestamp:t};await D.updateGameState(e().roomId,g,x),setTimeout(()=>{e().movePlayer(c.currentPlayer,o,[r,n])},100)}catch(g){console.error("❌ Failed to sync forced jail payment:",g)}})():setTimeout(()=>{e().movePlayer(c.currentPlayer,o,[r,n])},100),p}else{C(c,`🎲 ${l.name} rolled (${r},${n}) - ${m.jailTurns===2?"last attempt next turn!":"still in jail"}`),h[c.currentPlayer]=m;const p={...c,players:h,lastRoll:[r,n],diceRolled:!0,doubleCount:0,lastActionTimestamp:t};return e().roomId&&(async()=>{try{const g=e(),x={playerId:g.getCurrentPlayer().userId,action:"rollDice_jail_failed",dice1:r,dice2:n,jailTurns:m.jailTurns,timestamp:t};await D.updateGameState(e().roomId,g,x)}catch(g){console.error("❌ Failed to sync failed jail escape:",g)}})(),p}}const d=i?c.doubleCount+1:0;if(d===3){C(c,`🎲 ${l.name} rolled (${r},${n}) - third doubles in a row! Go to jail!`);const h=[...c.players],m={...l};m.position=10,m.inJail=!0,m.jailTurns=0,h[c.currentPlayer]=m;const p={...c,players:h,lastRoll:[r,n],diceRolled:!0,doubleCount:0,currentPlayer:(c.currentPlayer+1)%c.players.length,lastActionTimestamp:t};return e().roomId&&(async()=>{try{const g=e(),x={playerId:l.userId,action:"rollDice_third_double_jail",dice1:r,dice2:n,newCurrentPlayer:p.currentPlayer,timestamp:t};await D.updateGameState(e().roomId,g,x)}catch(g){console.error("❌ Failed to sync third double jail:",g)}})(),p}const u={...c,lastRoll:[r,n],diceRolled:!i,doubleCount:d,lastActionTimestamp:t};return s(u),e().roomId?(async()=>{try{const h=e(),m={playerId:h.getCurrentPlayer().userId,action:"rollDice_normal",dice1:r,dice2:n,isDouble:i,doubleCount:d,timestamp:t};await D.updateGameState(e().roomId,h,m),setTimeout(()=>{e().movePlayer(c.currentPlayer,o,[r,n])},100)}catch(h){console.error("❌ Failed to sync normal dice roll:",h),setTimeout(()=>{e().movePlayer(c.currentPlayer,o,[r,n])},100)}})():setTimeout(()=>{e().movePlayer(c.currentPlayer,o,[r,n])},100),u}),console.log("🎲 STORE: rollDice completed, timestamp:",t)},movePlayer:(t,r,n)=>{const o=Date.now();s(i=>{const c=[...i.players],l={...c[t]},d=l.position;if(l.inJail)return{players:c};l.position=(l.position+r)%40;const u=i.properties[l.position];if(l.position===30){l.position=10,l.inJail=!0,l.jailTurns=0,C(i,`🎲 ${l.name} landed on GO TO JAIL - sent to Jail!`),c[t]=l;const b={...i,players:c,lastActionTimestamp:o};return e().roomId&&(async()=>{try{const w=e(),N={playerId:l.userId,action:"movePlayer_go_to_jail",oldPosition:d,newPosition:10,rollInfo:n,timestamp:o};await D.updateGameState(e().roomId,w,N)}catch(w){console.error("❌ Failed to sync Go to Jail movement:",w)}})(),b}n&&r===n[0]+n[1]&&(n[0]===n[1]?C(i,`🎲 ${l.name} rolled (${n[0]},${n[1]}) and landed on ${u.name} - doubles! Roll again!`):C(i,`🎲 ${l.name} rolled (${n[0]},${n[1]}) and landed on ${u.name}`));let h=!1,m=!1;(l.position<d||d+r>=40)&&(l.money+=200,C(i,`🚀 ${l.name} passed START! Collected $200 BONK!`),h=!0),l.position===0&&(l.money+=200,C(i,`🎯 ${l.name} landed exactly on GO! Bonus $200 BONK!`),m=!0),u.type==="tax"&&u.tax&&(l.money-=u.tax,C(i,`💸 ${l.name} paid $${u.tax} ${u.name}!`)),c[t]=l;let p=null,g=null;if(u.type==="chance"||u.type==="community")e().drawCard(u.type);else if(u.owner!==null&&u.owner!==t&&!u.mortgage){const b=i.players[u.owner],w=e().getPropertyRent(l.position);l.money-=w,c[t]=l;const N={...b,money:b.money+w};c[u.owner]=N,C(i,`💸 ${l.name} paid $${w} rent to ${b.name}!`),p={amount:w,to:b.name,toPlayerId:u.owner}}else u.owner===null&&u.price>0&&(u.type==="property"||u.type==="railroad"||u.type==="utility")&&(g=l.position);const x={...i,players:c,selectedProperty:g,lastActionTimestamp:o};return e().roomId&&(async()=>{try{const b=e(),w={playerId:l.userId,action:"movePlayer",oldPosition:d,newPosition:l.position,spaces:r,rollInfo:n,passedStart:h,landedOnGo:m,rentPaid:p,selectedProperty:g,propertyType:u.type,propertyName:u.name,timestamp:o};await D.updateGameState(e().roomId,b,w)}catch(b){console.error("❌ Failed to sync player movement:",b)}})(),x})},buyProperty:t=>{const r=Date.now(),n=e(),o=n.properties[t],i=n.players[n.currentPlayer];return console.log("💰 BUY PROPERTY DEBUG:",{propertyId:t,propertyName:o.name,propertyPrice:o.price,currentPlayerIndex:n.currentPlayer,currentPlayerData:i,currentPlayerName:i.name,currentPlayerMoney:i.money}),o.owner!==null?(C(n,`❌ ${i.name} cannot buy ${o.name} - already owned!`),!1):o.type==="special"||o.type==="chance"||o.type==="community"||o.type==="tax"?(C(n,`❌ ${i.name} cannot buy ${o.name} - not for sale!`),!1):o.price>i.money?(C(n,`❌ ${i.name} cannot afford ${o.name} (costs $${o.price})!`),!1):(s(c=>({...c,players:c.players.map(l=>l.id===i.id?{...l,money:l.money-o.price,properties:[...l.properties,t]}:l),properties:c.properties.map(l=>l.id===t?{...l,owner:c.currentPlayer}:l),selectedProperty:null,lastActionTimestamp:r})),C(n,`🏠 ${i.name} bought ${o.name} for $${o.price} BONK!`),e().roomId&&setTimeout(async()=>{try{const c=e(),l={playerId:i.userId,action:"buyProperty",propertyId:t,propertyName:o.name,propertyPrice:o.price,newPlayerMoney:i.money-o.price,timestamp:r};await D.updateGameState(e().roomId,c,l),console.log("✅ Synced property purchase")}catch(c){console.error("❌ Failed to sync property purchase:",c)}},0),!0)},endTurn:()=>{var d,u;const t=Date.now(),r=e();if(console.log("🔄 END TURN - Before:",{currentPlayer:r.currentPlayer,currentPlayerName:(d=r.players[r.currentPlayer])==null?void 0:d.name,currentPlayerUserId:(u=r.players[r.currentPlayer])==null?void 0:u.userId,totalPlayers:r.players.length,diceRolled:r.diceRolled,hasBuiltThisTurn:r.hasBuiltThisTurn,roomId:r.roomId}),!r.diceRolled)throw console.error("❌ Cannot end turn - dice not rolled!"),new Error("Must roll dice first");const n=r.getCurrentPlayer(),o=(r.currentPlayer+1)%r.players.length,i=r.players[o];console.log("🔄 Calculating next turn:",{currentPlayerIndex:r.currentPlayer,nextPlayerIndex:o,nextPlayerName:i.name,nextPlayerUserId:i.userId}),s(h=>{var p;const m={...h,currentPlayer:o,diceRolled:!1,doubleCount:0,selectedProperty:null,hasBuiltThisTurn:!1,lastActionTimestamp:t};return console.log("🔄 State updated locally:",{newCurrentPlayer:m.currentPlayer,newCurrentPlayerName:(p=m.players[m.currentPlayer])==null?void 0:p.name}),m});const c=e(),l=c.getCurrentPlayer();C(c,`🔄 ${l.name}'s turn!`),console.log("🔄 END TURN - After local update:",{newCurrentPlayer:c.currentPlayer,newCurrentPlayerName:l.name,newCurrentPlayerUserId:l.userId}),c.roomId?(console.log("📡 Syncing turn end immediately..."),(async()=>{try{const h={playerId:n.userId,action:"endTurn",previousPlayer:n.name,previousPlayerUserId:n.userId,newCurrentPlayer:o,newCurrentPlayerName:l.name,newCurrentPlayerUserId:l.userId,timestamp:t};console.log("📡 Sending sync metadata:",h),await D.updateGameState(c.roomId,c,h),console.log("✅ Turn end synced successfully")}catch(h){console.error("❌ Failed to sync turn end:",h)}})()):console.warn("⚠️ No roomId found, cannot sync turn end")},selectProperty:t=>{s({selectedProperty:t})},getCurrentPlayer:()=>e().players[e().currentPlayer],initializePlayersFromLobby:t=>{console.log("Initializing players from lobby:",t);const r=t.map((n,o)=>({id:o+1,name:n.name||`Player ${o+1}`,userId:n.userId||`player-${o}`,money:1500,position:0,properties:[],color:n.color||["#00FF00","#0000FF","#FFFF00","#FF0000"][o],inJail:!1,jailTurns:0,jailFreeCards:0,icon:n.icon||["🎩","🚗","🐕","⛵"][o]}));s({players:r,currentPlayer:0,gameStarted:!0}),e().addToLog(`🎮 Game initialized with ${r.length} players from lobby!`),e().addToLog(`🚀 ${r[0].name}'s turn to start!`),e().saveGameState()},getProperty:t=>{const r=e().properties.find(n=>n.id===t);if(!r)throw new Error(`Property with id ${t} not found`);return r},addToLog:t=>{s(r=>({gameLog:[...r.gameLog.slice(-19),t]}))},payJailFine:t=>{s(r=>{const n=[...r.players],o={...n[t]};return o.inJail?o.money<50?(e().addToLog(`❌ ${o.name} doesn't have enough money to pay the jail fine!`),r):(o.money-=50,o.inJail=!1,o.jailTurns=0,n[t]=o,e().addToLog(`💰 ${o.name} paid $50 to get out of jail`),{players:n}):r})},attemptJailEscape:(t,r,n)=>{let o=!1;return s(i=>{const c=[...i.players],l={...c[t]};return l.inJail?(r===n?(l.inJail=!1,l.jailTurns=0,i.gameLog.push(`🎲 ${l.name} rolled doubles (${r},${n}) and got out of jail!`),o=!0,e().movePlayer(t,r+n,[r,n])):(i.gameLog.push(`🎲 ${l.name} rolled (${r},${n}) - not doubles, staying in jail.`),l.jailTurns>=3&&(l.inJail=!1,l.jailTurns=0,i.gameLog.push(`🔓 ${l.name} is released from jail after 3 turns!`),o=!0,e().movePlayer(t,r+n,[r,n]))),c[t]=l,{players:c,gameLog:[...i.gameLog]}):i}),o},hasMonopoly:(t,r)=>{const n=$e.find(l=>l.name===r);if(!n)return console.log(`❌ Group ${r} not found in MONOPOLY_GROUPS`),!1;const{properties:o}=e(),i=n.properties.filter(l=>o[l].owner===t).length,c=i===n.size;return console.log(`Monopoly check for ${r}:`,{playerId:t,ownedCount:i,requiredCount:n.size,hasMonopoly:c,properties:n.properties.map(l=>({id:l,name:o[l].name,owner:o[l].owner}))}),c},canBuildHouse:t=>{const{properties:r,players:n}=e(),o=r[t];if(!o||o.owner===null||o.type!=="property")return console.log("❌ Basic check failed:",{propertyExists:!!o,hasOwner:(o==null?void 0:o.owner)!==null,isProperty:(o==null?void 0:o.type)==="property"}),!1;if(o.houses>=wt.maxHousesPerProperty)return console.log("❌ Already has max houses:",o.houses),!1;if(o.mortgage)return console.log("❌ Property is mortgaged"),!1;const i=n[o.owner];if(!i)return console.log("❌ Player not found"),!1;if(!e().hasMonopoly(o.owner,o.group))return console.log("❌ No monopoly for group:",o.group),!1;const c=$e.find(u=>u.name===o.group);if(!c)return console.log("❌ Monopoly group not found:",o.group),!1;const l=c.properties.map(u=>r[u]),d=Math.min(...l.map(u=>u.houses));return o.houses>d?(console.log("❌ Even building rule violated:",{propertyName:o.name,propertyHouses:o.houses,minHousesInGroup:d,groupProperties:l.map(u=>({name:u.name,houses:u.houses}))}),!1):i.money<o.housePrice?(console.log("❌ Not enough money:",{playerMoney:i.money,housePrice:o.housePrice}),!1):(console.log("✅ Can build house on:",o.name,{currentHouses:o.houses,minInGroup:d,playerMoney:i.money,housePrice:o.housePrice}),!0)},buildHouse:t=>{const r=Date.now(),n=e();if(console.log("🏠 Building house on property:",t),n.hasBuiltThisTurn){console.log("❌ Already built this turn"),C(n,`❌ ${n.players[n.currentPlayer].name} can only build once per turn!`);return}if(!e().canBuildHouse(t)){console.log("❌ Cannot build house");return}s(o=>{const i=[...o.properties],c=[...o.players],l=i[t],d=c[l.owner];return l.houses++,d.money-=l.housePrice,console.log(`🏠 Built house on ${l.name}. New house count: ${l.houses}`),C(o,`🏠 ${d.name} built a house on ${l.name} for $${l.housePrice}`),{...o,properties:i,players:c,hasBuiltThisTurn:!0,lastActionTimestamp:r}})},canBuildHotel:t=>{const{properties:r,players:n}=e(),o=r[t];if(!o||o.owner===null||o.type!=="property"||o.houses!==wt.maxHousesPerProperty||o.mortgage)return!1;const i=n[o.owner];if(!i||!e().hasMonopoly(o.owner,o.group))return!1;const c=$e.find(m=>m.name===o.group);if(!c)return!1;const l=c.properties.map(m=>r[m]);if(!l.filter(m=>m.id!==t).every(m=>m.houses>=4))return console.log("❌ Cannot build hotel - other properties need at least 4 houses:",{groupProperties:l.map(m=>({name:m.name,houses:m.houses}))}),!1;const h=c.hotelPrice;return i.money>=h},buildHotel:t=>{const r=Date.now(),n=e();if(console.log("🏨 Building hotel on property:",t),n.hasBuiltThisTurn){console.log("❌ Already built this turn"),C(n,`❌ ${n.players[n.currentPlayer].name} can only build once per turn!`);return}if(!e().canBuildHotel(t)){console.log("❌ Cannot build hotel");return}s(o=>{const i=[...o.properties],c=[...o.players],l=i[t],d=c[l.owner],u=$e.find(h=>h.name===l.group);return l.houses=5,d.money-=u.hotelPrice,console.log(`🏨 Built hotel on ${l.name}`),C(o,`🏨 ${d.name} built a hotel on ${l.name} for $${u.hotelPrice}`),{...o,properties:i,players:c,hasBuiltThisTurn:!0,lastActionTimestamp:r}})},getPropertyRent:t=>{const{properties:r}=e(),n=r[t];if(!n||n.owner===null)return 0;switch(n.type){case"property":{const o=e().hasMonopoly(n.owner,n.group);return console.log(`Rent calculation for ${n.name}:`,{houses:n.houses,hasMonopoly:o,rentArray:n.rent}),n.houses===0?o?n.rent[1]:n.rent[0]:n.houses===5?n.rent[5]||n.rent[n.rent.length-1]:n.rent[n.houses+1]||n.rent[n.rent.length-1]}case"railroad":{const o=r.filter(i=>i.type==="railroad"&&i.owner===n.owner).length;return n.rent[o-1]||0}case"utility":{const o=r.filter(d=>d.type==="utility"&&d.owner===n.owner).length,[i,c]=e().lastRoll,l=o===1?4:10;return(i+c)*l}default:return 0}},drawCard:t=>{const r=t==="chance"?e().chanceCards:e().communityChestCards,n=r[0];s(o=>({[t==="chance"?"chanceCards":"communityChestCards"]:[...r.slice(1),r[0]],currentCard:n})),C(e(),`📜 ${e().getCurrentPlayer().name} drew a card: ${n.title}`)},closeCardModal:()=>{const t=e().currentCard;t&&(e().executeCardAction(t),s({currentCard:null}))},executeCardAction:t=>{const r=e(),n=r.getCurrentPlayer(),o=[...r.players],i={...n};switch(t.action){case"move":{if(t.position!==void 0){const c=i.position,l=t.position;l<c&&(i.money+=200,C(r,`🚀 ${i.name} passed START! Collected $200 BONK!`));const d=(l-c+40)%40;e().movePlayer(r.currentPlayer,d)}break}case"move_nearest":{if(t.nearestType){const c=i.position;let l=-1,d=40;if(r.properties.forEach((u,h)=>{if(u.type===t.nearestType){const m=(h-c+40)%40;m<d&&m>0&&(d=m,l=h)}}),l!==-1){const u=(l-c+40)%40;e().movePlayer(r.currentPlayer,u);const h=r.properties[l];if(h.owner!==null&&h.owner!==r.currentPlayer&&!h.mortgage){const m=r.getPropertyRent(l)*2;i.money-=m;const p={...o[h.owner],money:o[h.owner].money+m};o[h.owner]=p,o[r.currentPlayer]=i,C(r,`💸 ${i.name} paid $${m} (double) rent to ${p.name}!`),s({players:o})}}}break}case"pay":{t.amount&&(i.money-=t.amount,C(r,`💸 ${i.name} paid $${t.amount} to the bank`),o[r.currentPlayer]=i,s({players:o}));break}case"collect":{t.amount&&(i.money+=t.amount,C(r,`💰 ${i.name} collected $${t.amount} from the bank`),o[r.currentPlayer]=i,s({players:o}));break}case"collect_from_players":{if(t.amount){let c=0;o.forEach((l,d)=>{if(d!==r.currentPlayer){const u=t.amount||0;o[d]={...l,money:l.money-u},c+=u}}),i.money+=c,C(r,`💰 ${i.name} collected $${t.amount} from each player (total: $${c})`),o[r.currentPlayer]=i,s({players:o})}break}case"repairs":{if(t.houseRepairCost&&t.hotelRepairCost){let c=0;i.properties.forEach(l=>{const d=r.properties[l];d.houses===5?c+=t.hotelRepairCost:c+=d.houses*t.houseRepairCost}),c>0&&(i.money-=c,C(r,`🏠 ${i.name} paid $${c} for repairs`),o[r.currentPlayer]=i,s({players:o}))}break}case"jail":{i.position=10,i.inJail=!0,i.jailTurns=0,C(r,`👮 ${i.name} was sent to Jail!`),o[r.currentPlayer]=i,s({players:o});break}case"jail_free":{i.jailFreeCards++,C(r,`🎟️ ${i.name} received a Get Out of Jail Free card`),o[r.currentPlayer]=i,s({players:o});break}case"move_back":{e().movePlayer(r.currentPlayer,37);break}}e().saveGameState()}})),ic=({player:s})=>{const e=n=>n===0?{gridColumn:11,gridRow:11}:n<=10?{gridColumn:11-n,gridRow:11}:n<=20?{gridColumn:1,gridRow:11-(n-10)}:n<=30?{gridColumn:n-20+1,gridRow:1}:{gridColumn:11,gridRow:n-30+1},{gridColumn:t,gridRow:r}=e(s.position);return a.jsx(Pt.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:500,damping:30},className:"absolute z-10",style:{gridColumn:t,gridRow:r,filter:"drop-shadow(0 0 4px rgba(0,0,0,0.8))"},children:a.jsx(Pt.div,{animate:{y:[0,-5,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:"w-5 h-5 rounded-full border-2 border-white",style:{backgroundColor:s.color}})})},lc="_propertyCell_zdype_1",cc="_propertyHeader_zdype_37",dc="_propertyContent_zdype_63",uc="_propertyIcon_zdype_83",hc="_propertyName_zdype_113",mc="_propertyPrice_zdype_129",fc="_specialCell_zdype_143 _propertyCell_zdype_1",pc="_specialIcon_zdype_153",gc="_ownerTopLeft_zdype_165",yc="_ownerTopRight_zdype_167",xc="_ownerBottomLeft_zdype_169",bc="_ownerBottomRight_zdype_171",wc="_playersTop_zdype_231",vc="_playersRight_zdype_233",jc="_playersBottom_zdype_235",_c="_playersLeft_zdype_237",Nc="_player_zdype_231",Pc={propertyCell:lc,propertyHeader:cc,propertyContent:dc,propertyIcon:uc,propertyName:hc,propertyPrice:mc,specialCell:fc,specialIcon:pc,ownerTopLeft:gc,ownerTopRight:yc,ownerBottomLeft:xc,ownerBottomRight:bc,playersTop:wc,playersRight:vc,playersBottom:jc,playersLeft:_c,player:Nc},Sc=({houses:s,position:e,isVertical:t})=>{if(s===0)return null;const r=()=>{switch(e){case"top":return"top-0 right-0 rounded-bl-md";case"right":return"bottom-0 right-0 rounded-tl-md";case"bottom":return"bottom-0 left-0 rounded-tr-md";case"left":return"top-0 left-0 rounded-br-md";default:return"top-0 right-0 rounded-bl-md"}};if(s===5)return a.jsx("div",{className:`absolute bg-red-600 text-white text-[8px] px-1 py-0.5 font-bold z-20 ${r()}`,children:"🏨"});const n="⭐".repeat(Math.min(s,4));return a.jsx("div",{className:`absolute bg-green-600 text-white text-[7px] px-1 py-0.5 font-bold z-20 ${r()}`,children:n})},vt=({property:s,position:e,players:t,onClick:r})=>{var x;const n=e==="left"||e==="right",o=s.type==="property",i=s.type==="utility"||s.type==="railroad",{getPropertyRent:c,hasMonopoly:l}=Y(),d=s.owner!==null?(x=t[s.owner])==null?void 0:x.color:null,u=()=>s.owner===null?`$${s.price}`:`$${c(s.id)}`,h=()=>s.color||"#666",m=()=>o||i?s.name.toLowerCase().replace(/\s+/g,"-"):null,p=s.type==="property"&&a.jsx("div",{className:`absolute ${n?"h-full w-1":"w-full h-1"} ${e==="left"?"left-0":e==="right"?"right-0":e==="top"?"top-0":"bottom-0"}`,style:{backgroundColor:s.color}}),g=d&&a.jsx("div",{className:"absolute inset-0 opacity-75",style:{backgroundColor:d,zIndex:1}});return a.jsx("div",{className:"w-full h-full p-px",children:a.jsxs("div",{className:"w-full h-full relative bg-white border border-gray-400 flex flex-col items-center justify-center cursor-pointer hover:shadow-sm transition-shadow duration-200 overflow-visible",onClick:r,children:[g,p,o&&s.houses>0&&a.jsx(Sc,{houses:s.houses,position:e,isVertical:n}),a.jsx("div",{className:"relative z-10 flex flex-col items-center justify-center w-full h-full p-2",children:o||i?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:Pc.propertyIcon,children:m()&&a.jsx("img",{src:`/images/tokens/${m()}.png`,alt:s.name,onError:b=>{const w=b.target;w.style.display="none",w.parentElement.innerHTML=s.icon||"💰"}})}),a.jsx("div",{className:"text-[8px] font-bold leading-tight text-center mt-1",children:s.name}),o&&s.houses>0&&a.jsx("div",{className:"text-[6px] font-bold text-center mt-0.5",children:s.houses===5?a.jsx("span",{className:"text-red-600",children:"🏨 Hotel"}):a.jsxs("span",{className:"text-green-600",children:[s.houses,"H"]})})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-2xl mb-1",children:s.icon}),a.jsx("div",{className:"text-xs leading-tight font-bold text-center",children:s.name}),s.description&&a.jsx("div",{className:"text-[8px] text-gray-600 mt-0.5 text-center",children:s.description})]})}),s.price>0&&a.jsx("div",{className:"absolute z-30 flex items-center justify-center",style:{backgroundColor:h(),width:n?"16px":"calc(100% - 2px)",height:n?"calc(100% - 2px)":"16px",top:e==="top"?"-16px":e==="left"||e==="right"?"1px":"auto",bottom:e==="bottom"?"-16px":"auto",left:e==="left"?"-16px":e==="right"?"auto":"1px",right:e==="right"?"-16px":"auto",writingMode:n?"vertical-rl":"horizontal-tb",transform:e==="left"?"rotate(180deg)":"none",boxShadow:"0 1px 2px rgba(0,0,0,0.1)"},children:a.jsx("span",{className:"text-white text-[10px] font-bold",style:{letterSpacing:"0.5px",textShadow:"0 0 2px #000, 0 0 2px #000, 0 0 2px #000, 0 0 2px #000",WebkitTextStroke:"0.5px black"},children:u()})})]})})},jt=({property:s,className:e="",getPlayersAtPosition:t,selectProperty:r})=>{const n=t(s.id);return a.jsxs("div",{className:`aspect-square bg-gradient-to-br from-white to-gray-50 border-2 border-gray-800 cursor-pointer hover:shadow-lg transition-all duration-300 relative group ${e}`,onClick:()=>r(s.id),children:[a.jsxs("div",{className:"w-full h-full flex flex-col justify-center items-center text-center text-gray-900 font-bold p-1",children:[a.jsx("div",{className:"text-2xl mb-1 group-hover:scale-110 transition-transform duration-300",children:s.icon}),a.jsx("div",{className:"text-xs leading-tight font-bold uppercase tracking-wide",children:s.name}),a.jsx("div",{className:"text-xs text-gray-600 mt-0.5 font-normal leading-tight",children:s.description})]}),n.length>0&&a.jsx("div",{className:"absolute bottom-1 right-1 flex gap-1",children:n.map(o=>a.jsx("div",{className:"w-3 h-3 rounded-full border-2 border-white shadow",style:{backgroundColor:o.color},title:o.name},o.id))}),s.id===0&&a.jsx("div",{className:"absolute inset-0 bg-green-200/20 pointer-events-none"}),s.id===10&&a.jsx("div",{className:"absolute inset-0 bg-orange-200/20 pointer-events-none"}),s.id===20&&a.jsx("div",{className:"absolute inset-0 bg-blue-200/20 pointer-events-none"}),s.id===30&&a.jsx("div",{className:"absolute inset-0 bg-red-200/20 pointer-events-none"}),a.jsx("div",{className:"absolute inset-0 bg-yellow-400/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"})]})},kc=({onPropertySelect:s})=>{const[e,t]=f.useState(null),{players:r,properties:n,selectProperty:o}=Y(),i=l=>r.filter(d=>d.position===l),c=l=>{const d=n.find(u=>u.id===l);d&&(t(d),o(l),s&&s(d))};return a.jsx("div",{className:"w-full h-full max-w-none mx-auto",children:a.jsxs("div",{className:"aspect-square w-full bg-gradient-to-br from-emerald-50 to-green-100 rounded-2xl border-4 border-gray-800 shadow-2xl relative overflow-visible",children:[a.jsxs("div",{className:"absolute inset-0 opacity-10",children:[a.jsx("div",{className:"absolute top-10 left-10 w-20 h-20 bg-yellow-400 rounded-full animate-pulse"}),a.jsx("div",{className:"absolute top-20 right-20 w-16 h-16 bg-blue-400 rounded-full animate-bounce"}),a.jsx("div",{className:"absolute bottom-20 left-20 w-12 h-12 bg-red-400 rounded-full animate-spin"}),a.jsx("div",{className:"absolute bottom-10 right-10 w-24 h-24 bg-purple-400 rounded-full animate-ping"})]}),a.jsxs("div",{className:"grid grid-cols-11 grid-rows-11 w-full h-full relative p-1",children:[a.jsx(jt,{property:n[20],className:"col-start-1 row-start-1 rounded-tl-xl",getPlayersAtPosition:i,selectProperty:c}),a.jsx(jt,{property:n[30],className:"col-start-11 row-start-1 rounded-tr-xl",getPlayersAtPosition:i,selectProperty:c}),a.jsx(jt,{property:n[10],className:"col-start-1 row-start-11 rounded-bl-xl",getPlayersAtPosition:i,selectProperty:c}),a.jsx(jt,{property:n[0],className:"col-start-11 row-start-11 rounded-br-xl",getPlayersAtPosition:i,selectProperty:c}),n.slice(21,30).map((l,d)=>a.jsx("div",{className:`col-start-${d+2} row-start-1`,children:a.jsx(vt,{property:l,position:"top",players:r,onClick:()=>c(l.id)})},l.id)),n.slice(31,40).map((l,d)=>a.jsx("div",{className:`col-start-11 row-start-${d+2}`,children:a.jsx(vt,{property:l,position:"right",players:r,onClick:()=>c(l.id)})},l.id)),n.slice(1,10).map((l,d)=>a.jsx("div",{className:`col-start-${10-d} row-start-11`,children:a.jsx(vt,{property:l,position:"bottom",players:r,onClick:()=>c(l.id)})},l.id)),n.slice(11,20).map((l,d)=>a.jsx("div",{className:`col-start-1 row-start-${10-d}`,children:a.jsx(vt,{property:l,position:"left",players:r,onClick:()=>c(l.id)})},l.id)),a.jsx("div",{className:"col-start-3 col-end-10 row-start-3 row-end-10 bg-gradient-to-br from-emerald-50 to-green-100 rounded-lg flex items-center justify-center relative overflow-hidden",children:a.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:a.jsx("img",{src:"/images/bonkopoly.png",alt:"BONKOPOLY",className:"transform -rotate-45 shadow-2xl",style:{width:"90%",height:"auto",maxWidth:"500px",filter:"drop-shadow(6px 6px 12px rgba(0,0,0,0.4))"}})})}),r.map(l=>a.jsx(ic,{player:l},l.id))]})]})})},Tc=()=>{const{players:s,properties:e}=Y(),t=s.reduce((h,m)=>h+m.money,0),r=e.filter(h=>h.owner!==null).length,n=e.filter(h=>h.type==="property"||h.type==="railroad"||h.type==="utility").length,o=e.reduce((h,m)=>h+(m.houses||0),0),i=e.reduce((h,m)=>h+(m.hotels||0),0),c=[...s].sort((h,m)=>m.money-h.money)[0],l=[...s].sort((h,m)=>h.money-m.money)[0],d=h=>h>=1e3?`$${(h/1e3).toFixed(1)}k`:`$${h}`,u=({color:h})=>a.jsx("div",{className:"w-2.5 h-2.5 rounded-full border border-white/50",style:{backgroundColor:h}});return a.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-3 space-y-2",children:[a.jsx("div",{className:"text-emerald-500 text-sm font-bold mb-2",children:"📊 STATS"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("div",{className:"text-gray-400",children:"Properties"}),a.jsxs("div",{className:"font-mono text-white",children:[r,"/",n]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("div",{className:"text-gray-400",children:"Total Money"}),a.jsx("div",{className:"font-mono text-white",children:d(t)})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs pt-2 border-t border-gray-700",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("div",{className:"text-gray-400",children:"Houses"}),a.jsxs("div",{className:"font-mono text-white",children:["🏠 ",o]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("div",{className:"text-gray-400",children:"Hotels"}),a.jsxs("div",{className:"font-mono text-white",children:["🏨 ",i]})]})]}),a.jsx("div",{className:"text-xs pt-2 border-t border-gray-700",children:a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-gray-400",children:"Richest"}),a.jsxs("div",{className:"font-mono text-white flex items-center gap-2",children:[a.jsx(u,{color:c.color}),c.name,a.jsx("span",{className:"text-emerald-500",children:d(c.money)})]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-gray-400",children:"Poorest"}),a.jsxs("div",{className:"font-mono text-white flex items-center gap-2",children:[a.jsx(u,{color:l.color}),l.name,a.jsx("span",{className:"text-red-500",children:d(l.money)})]})]})]})})]})},Cc=()=>{const{players:s,currentPlayer:e,properties:t}=Y(),r=o=>t.filter(i=>i.owner===o),n=o=>{const i=s[o],c=r(o).reduce((l,d)=>l+d.price,0);return i.money+c};return a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"space-y-1.5",children:s.map((o,i)=>({...o,originalIndex:i,netWorth:n(i)})).sort((o,i)=>i.netWorth-o.netWorth).map(o=>{const i=o.originalIndex===e,c=r(o.originalIndex);return a.jsxs("div",{className:`p-2 rounded-lg border transition-all duration-200 ${i?"border-orange-500/50 bg-orange-500/10 shadow-md shadow-orange-500/20":"border-white/10 bg-slate-800/30 hover:border-white/20"}`,children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:`w-3 h-3 rounded-full border transition-all duration-300 ${i?"border-orange-400 shadow-lg shadow-orange-500/30":"border-white/50"}`,style:{backgroundColor:o.color,transform:i?"scale(1.2)":"scale(1)"}}),a.jsxs("div",{children:[a.jsxs("div",{className:"font-bold text-white text-xs flex items-center gap-2",children:[o.name,o.inJail&&a.jsxs("span",{className:"text-red-400 font-normal",children:["🚔 ",o.jailTurns,"/3"]})]}),a.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-2",children:[a.jsxs("span",{children:["Position: ",o.position]}),a.jsx("span",{children:"•"}),a.jsxs("span",{children:["Properties: ",c.length]})]})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:`font-bold text-xs flex items-center justify-end ${o.money<500?"text-red-400":"text-green-400"}`,children:[a.jsx(fe,{className:"w-3 h-3 mr-1"}),"$",o.money.toLocaleString()]}),a.jsxs("div",{className:"text-xs text-gray-400",children:["Net: $",o.netWorth.toLocaleString()]})]})]}),c.length>0&&a.jsx("div",{className:"mt-1.5 pt-1.5 border-t border-white/10",children:a.jsxs("div",{className:"flex flex-wrap gap-1",children:[c.slice(0,3).map(l=>a.jsx("div",{className:"px-1.5 py-0.5 rounded text-xs font-bold text-white",style:{backgroundColor:l.color},title:`${l.name} - $${l.price.toLocaleString()}`,children:l.name.split(" ")[0]},l.id)),c.length>3&&a.jsxs("div",{className:"px-1.5 py-0.5 rounded text-xs bg-slate-600 text-white",children:["+",c.length-3]})]})}),a.jsx("div",{className:"mt-1.5",children:a.jsx("div",{className:"w-full bg-slate-700/50 rounded-full h-0.5",children:a.jsx("div",{className:"h-0.5 rounded-full bg-gradient-to-r from-green-400 to-blue-400 transition-all duration-500",style:{width:`${Math.min(o.netWorth/4e3*100,100)}%`}})})})]},o.id)})}),a.jsx(Tc,{})]})},$c=()=>{const{lastRoll:s}=Y(),e={rolling:{rotate:[0,360,720],scale:[1,1.2,1],transition:{duration:.5}},idle:{rotate:0,scale:1}};return a.jsxs("div",{className:"flex justify-center space-x-4 mb-4",children:[a.jsx(Pt.div,{variants:e,initial:"idle",className:"w-16 h-16 bg-gradient-to-br from-bonk-orange to-bonk-yellow rounded-xl flex items-center justify-center text-3xl font-black text-black shadow-lg",style:{perspective:1e3},children:s[0]}),a.jsx(Pt.div,{variants:e,initial:"idle",className:"w-16 h-16 bg-gradient-to-br from-bonk-orange to-bonk-yellow rounded-xl flex items-center justify-center text-3xl font-black text-black shadow-lg",style:{perspective:1e3},children:s[1]})]})},Ec=({currentUserId:s,currentPlayer:e,onOpenTradeModal:t,onOpenPropertyManagement:r})=>{var oe,v,E,G,H;const{rollDice:n,buyProperty:o,endTurn:i,diceRolled:c,selectedProperty:l,addToLog:d,getCurrentPlayer:u,roomId:h,isBuildingControlsOpen:m,openBuildingControls:p,closeBuildingControls:g,players:x,startPropertyAuction:b,properties:w}=Y(),y=Y(O=>{var X;const U=O.getCurrentPlayer();return!s||!(U!=null&&U.userId)||!((X=O.players)!=null&&X.length)?!1:U.userId===s}),j=x.findIndex(O=>O.userId===s),S=j>=0?x[j]:null,k=(((oe=S==null?void 0:S.properties)==null?void 0:oe.length)??0)>0,$=l!==null&&((v=w[l])==null?void 0:v.owner)===null&&((E=w[l])==null?void 0:E.price)>0,F=l!==null&&((G=w[l])==null?void 0:G.owner)===null&&((H=w[l])==null?void 0:H.price)>0,L=async()=>{if(!y){d(`⏳ Wait for your turn! It's ${e.name}'s turn.`);return}try{console.log("🎲 STARTING ROLL DICE ACTION for user:",s),n(),await new Promise(X=>setTimeout(X,200));const O=Y.getState(),U={playerId:s,action:"roll_dice",timestamp:Date.now()};await D.updateGameState(h,O,U),console.log("🎲 Successfully sent to realtime")}catch(O){const U=O instanceof Error?O.message:"Unknown error occurred";console.error("🎲 ERROR in handleRollDice:",U),d(`❌ Error rolling dice: ${U}`)}},q=()=>{if(!y){d(`⏳ Wait for your turn! It's ${e.name}'s turn.`);return}console.log("🎯 Trade button clicked by:",s),t()},M=()=>{if(!y){d(`⏳ Wait for your turn! It's ${e.name}'s turn.`);return}if(!k){d("❌ You don't own any properties yet!");return}console.log("🏠 Property management button clicked by:",s),r&&r()},R=async()=>{if(console.log("🛒 BUY PROPERTY DEBUG:",{currentUserId:s,currentPlayerFromStore:u(),currentPlayerFromProp:e,canIPlay:y,selectedProperty:l}),!y){d(`⏳ Wait for your turn! It's ${e.name}'s turn.`);return}if(l===null){d("⚠️ Select a property first!");return}try{if(!o(l))return;const U=Y.getState(),X={playerId:s,action:"buy_property",propertyId:l,timestamp:Date.now()};await D.updateGameState(h,U,X)}catch(O){const U=O instanceof Error?O.message:"Unknown error occurred";d(`❌ Error buying property: ${U}`)}},_=async()=>{if(!y){d(`⏳ Wait for your turn! It's ${e.name}'s turn.`);return}if(l===null){d("⚠️ Select a property first!");return}const O=w[l];if(!O||O.owner!==null){d("❌ Property not available for auction");return}try{console.log("🏛️ Starting auction for property:",l),b(l);const U=Y.getState(),X={playerId:s,action:"start_auction",propertyId:l,propertyName:O.name,timestamp:Date.now()};await D.updateGameState(h,U,X),console.log("✅ Auction started and synced")}catch(U){const X=U instanceof Error?U.message:"Unknown error occurred";d(`❌ Error starting auction: ${X}`)}},se=async()=>{if(!y){d(`⏳ Wait for your turn! It's ${e.name}'s turn.`);return}try{i();const O=Y.getState(),U={playerId:s,action:"end_turn",timestamp:Date.now()};await D.updateGameState(h,O,U)}catch(O){const U=O instanceof Error?O.message:"Unknown error occurred";d(`❌ Error ending turn: ${U}`)}},ee=()=>{if(!y){d(`⏳ Wait for your turn! It's ${e.name}'s turn.`);return}console.log("🏗️ Opening building controls"),p()};return a.jsxs("div",{className:"relative overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-500/20 via-red-500/20 to-pink-500/20 rounded-xl blur-xl"}),a.jsxs("div",{className:"relative bg-gradient-to-br from-slate-900/95 via-slate-800/95 to-slate-900/95 backdrop-blur-xl rounded-xl border border-white/10 p-3 shadow-xl",children:[a.jsxs("div",{className:"text-center mb-3 p-2 rounded-lg bg-gradient-to-r from-slate-800/50 to-slate-700/50 border border-white/10",children:[a.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[a.jsx(St,{className:"w-4 h-4 text-yellow-400"}),a.jsx("span",{className:"text-sm font-bold text-white",children:y?a.jsx("span",{className:"text-green-400",children:"🎯 Your Turn!"}):a.jsxs("span",{className:"text-yellow-400",children:["⏳ ",e==null?void 0:e.name,"'s Turn"]})})]}),!y&&a.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Wait for your turn to make moves"})]}),a.jsxs("div",{className:"text-center mb-3",children:[a.jsx("h3",{className:"text-xs font-bold bg-gradient-to-r from-orange-400 to-red-500 bg-clip-text text-transparent mb-2",children:"🎲 ROLL THE DICE"}),a.jsx("div",{className:"mb-2",children:a.jsx($c,{})}),a.jsxs("button",{onClick:L,disabled:c||!y,className:`w-full font-bold py-2 px-3 rounded-lg transform transition-all duration-200 text-xs flex items-center justify-center space-x-1 ${y&&!c?"bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white hover:scale-105":"bg-gray-600 text-gray-400 cursor-not-allowed opacity-50"}`,children:[a.jsx(Pn,{className:"w-3 h-3"}),a.jsx("span",{children:y?c?"ROLLED!":"ROLL DICE":"WAIT YOUR TURN"}),a.jsx(Sn,{className:"w-3 h-3"})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("button",{onClick:R,disabled:!$||!y,className:`w-full font-bold py-2 px-3 rounded-lg transform transition-all duration-200 text-xs flex items-center justify-center space-x-1 ${y&&$?"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white hover:scale-105":"bg-gray-600 text-gray-400 cursor-not-allowed opacity-50"}`,children:[a.jsx(ne,{className:"w-3 h-3"}),a.jsx("span",{children:"BUY PROPERTY"})]}),a.jsxs("button",{onClick:_,disabled:!F||!y,className:`w-full font-bold py-2 px-3 rounded-lg transform transition-all duration-200 text-xs flex items-center justify-center space-x-1 ${y&&F?"bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-700 hover:to-orange-700 text-white hover:scale-105":"bg-gray-600 text-gray-400 cursor-not-allowed opacity-50"}`,children:[a.jsx(at,{className:"w-3 h-3"}),a.jsx("span",{children:"START AUCTION"})]}),a.jsxs("button",{onClick:ee,disabled:!y,className:`w-full font-bold py-2 px-3 rounded-lg transform transition-all duration-200 text-xs flex items-center justify-center space-x-1 ${y?"bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white hover:scale-105":"bg-gray-600 text-gray-400 cursor-not-allowed opacity-50"}`,children:[a.jsx(ze,{className:"w-3 h-3"}),a.jsx("span",{children:"BUILD HOUSES"})]}),a.jsxs("button",{onClick:M,disabled:!y||!k,className:`w-full font-bold py-2 px-3 rounded-lg transform transition-all duration-200 text-xs flex items-center justify-center space-x-1 ${y&&k?"bg-gradient-to-r from-teal-500 to-cyan-500 hover:from-teal-600 hover:to-cyan-600 text-white hover:scale-105":"bg-gray-600 text-gray-400 cursor-not-allowed opacity-50"}`,children:[a.jsx(yr,{className:"w-3 h-3"}),a.jsx("span",{children:"MANAGE PROPERTIES"})]}),a.jsxs("button",{onClick:se,disabled:!c||!y,className:`w-full font-bold py-2 px-3 rounded-lg transform transition-all duration-200 text-xs flex items-center justify-center space-x-1 ${y&&c?"bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white hover:scale-105":"bg-gray-600 text-gray-400 cursor-not-allowed opacity-50"}`,children:[a.jsx(kn,{className:"w-3 h-3"}),a.jsx("span",{children:"END TURN"})]}),a.jsxs("button",{onClick:q,disabled:!y,className:`w-full font-bold py-2 px-3 rounded-lg transform transition-all duration-200 text-xs flex items-center justify-center space-x-1 ${y?"bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-600 hover:to-amber-600 text-white hover:scale-105":"bg-gray-600 text-gray-400 cursor-not-allowed opacity-50"}`,children:[a.jsx(Pe,{className:"w-3 h-3"}),a.jsx("span",{children:"TRADE"})]})]}),a.jsx("div",{className:"mt-2 pt-2 border-t border-white/10",children:a.jsx("div",{className:"text-xs text-gray-400",children:y?c?l===null&&c?a.jsxs("div",{className:"flex items-center",children:[a.jsx("span",{className:"w-1 h-1 bg-blue-400 rounded-full mr-2"}),"Select property to buy or end turn"]}):a.jsxs("div",{className:"flex items-center",children:[a.jsx("span",{className:"w-1 h-1 bg-green-400 rounded-full mr-2"}),"Complete your actions and end turn"]}):a.jsxs("div",{className:"flex items-center",children:[a.jsx("span",{className:"w-1 h-1 bg-orange-400 rounded-full mr-2"}),"Roll dice to start your turn"]}):a.jsxs("div",{className:"flex items-center",children:[a.jsx("span",{className:"w-1 h-1 bg-yellow-400 rounded-full mr-2 animate-pulse"}),"Waiting for ",e==null?void 0:e.name," to play"]})})})]})]})},Rc="_gameLog_1j76g_1",Ic="_log_1j76g_37",Oc="_logMessage_1j76g_93",Ac="_fadeIn_1j76g_1",rr={gameLog:Rc,log:Ic,logMessage:Oc,fadeIn:Ac},Lc=()=>{const s=Y(t=>t.gameLog),e=f.useRef(null);return f.useEffect(()=>{e.current&&(e.current.scrollTop=e.current.scrollHeight)},[s]),a.jsxs("div",{className:rr.gameLog,children:[a.jsx("h2",{children:"Game Log"}),a.jsx("div",{className:rr.log,ref:e,children:s.map((t,r)=>a.jsx("div",{className:rr.logMessage,children:t},r))})]})},Bc=({onClose:s,currentUserId:e})=>{var w;const{properties:t,players:r,currentPlayer:n,canBuildHouse:o,canBuildHotel:i,buildHouse:c,buildHotel:l,hasBuiltThisTurn:d,getPropertyRent:u,saveGameState:h}=Y(),m=r[n],p=()=>{const N=[{name:"brown",size:2,properties:[1,3]},{name:"lightblue",size:3,properties:[6,8,9]},{name:"pink",size:3,properties:[11,13,14]},{name:"orange",size:3,properties:[16,18,19]},{name:"red",size:3,properties:[21,23,24]},{name:"yellow",size:3,properties:[26,27,29]},{name:"green",size:3,properties:[31,32,34]},{name:"darkblue",size:2,properties:[37,39]}],y=[];for(const j of N){const S=j.properties.filter(k=>t[k].owner===n);if(S.length===j.size){const k=S.map($=>t[$]);y.push({groupName:j.name,properties:k})}}return y},g=async(N,y,j)=>{if(m.money<j){alert(`Not enough money! You need ${j} but only have ${m.money}`);return}try{c(N),setTimeout(()=>h(),100)}catch(S){console.error("❌ Failed to build house:",S),alert("Failed to build house!")}},x=async(N,y,j)=>{if(m.money<j){alert(`Not enough money! You need ${j} but only have ${m.money}`);return}try{l(N),setTimeout(()=>h(),100)}catch(S){console.error("❌ Failed to build hotel:",S),alert("Failed to build hotel!")}},b=p();return a.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[9999] p-4",children:a.jsxs("div",{className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-xl border-2 border-blue-500/30 shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-y-auto",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-blue-500/20",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(ze,{className:"w-6 h-6 text-blue-400 mr-3"}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-bold text-white",children:"Build Houses & Hotels"}),a.jsxs("p",{className:"text-blue-300 text-xs",children:[m==null?void 0:m.name," • $",(w=m==null?void 0:m.money)==null?void 0:w.toLocaleString()]})]})]}),a.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white hover:bg-red-600 p-1 rounded-lg transition-all",children:a.jsx(Je,{className:"w-5 h-5"})})]}),d&&a.jsx("div",{className:"m-4 p-3 bg-orange-900/30 border border-orange-500/30 rounded-lg",children:a.jsx("p",{className:"text-orange-300 text-sm font-medium",children:"🚧 Already built this turn - End your turn to build again"})}),a.jsx("div",{className:"p-4",children:b.length===0?a.jsxs("div",{className:"text-center py-8 bg-slate-800/30 rounded-lg border border-dashed border-gray-600",children:[a.jsx(ze,{className:"w-8 h-8 text-gray-500 mx-auto mb-3"}),a.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"No Monopolies Yet"}),a.jsx("p",{className:"text-gray-400 text-sm",children:"Own all properties of the same color to build houses and hotels"})]}):a.jsx("div",{className:"space-y-4",children:b.map(({groupName:N,properties:y})=>a.jsxs("div",{className:"bg-slate-800/40 border border-white/10 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center mb-3 pb-2 border-b border-white/10",children:[a.jsx("div",{className:"w-4 h-4 rounded mr-3 border border-white/50",style:{backgroundColor:y[0].color}}),a.jsxs("h3",{className:"text-lg font-bold text-white capitalize flex-1",children:[N," Properties"]}),a.jsx($t,{className:"w-4 h-4 text-purple-400"})]}),a.jsx("div",{className:"space-y-3",children:y.map(j=>{const S=o(j.id),k=i(j.id);return a.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-3",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("h4",{className:"text-sm font-bold text-white mr-2",children:j.name}),j.houses>0&&a.jsx("span",{className:"text-xs px-2 py-1 rounded font-bold",children:j.houses===5?a.jsx("span",{className:"bg-red-600 text-white",children:"🏨"}):a.jsxs("span",{className:"bg-green-600 text-white",children:[j.houses,"H"]})})]}),a.jsxs("div",{className:"text-xs text-gray-300",children:["Build: $",j.housePrice]})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"text-green-400 font-bold text-sm",children:["$",u(j.id)]}),a.jsx("div",{className:"text-xs text-gray-400",children:"rent"})]})]}),!S&&j.houses<4&&!d&&a.jsx("div",{className:"mb-2 p-2 bg-yellow-900/20 border border-yellow-500/30 rounded text-xs",children:a.jsx("span",{className:"text-yellow-300",children:"⚠️ Build evenly across group first"})}),a.jsxs("div",{className:"flex space-x-2",children:[j.houses<4&&a.jsxs("button",{onClick:()=>g(j.id,j.name,j.housePrice),disabled:!S||m.money<j.housePrice||d,className:`flex-1 flex items-center justify-center py-2 px-3 rounded-lg text-sm font-bold transition-all ${S&&m.money>=j.housePrice&&!d?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed opacity-50"}`,children:[a.jsx(ne,{className:"w-4 h-4 mr-1"}),"House"]}),j.houses===4&&a.jsxs("button",{onClick:()=>x(j.id,j.name,j.housePrice),disabled:!k||m.money<j.housePrice||d,className:`flex-1 flex items-center justify-center py-2 px-3 rounded-lg text-sm font-bold transition-all ${k&&m.money>=j.housePrice&&!d?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed opacity-50"}`,children:[a.jsx(ze,{className:"w-4 h-4 mr-1"}),"Hotel"]}),j.houses===5&&a.jsxs("div",{className:"flex-1 flex items-center justify-center py-2 px-3 rounded-lg bg-yellow-600 text-white text-sm font-bold",children:[a.jsx(ze,{className:"w-4 h-4 mr-1"}),"Complete"]})]})]},j.id)})})]},N))})}),a.jsx("div",{className:"p-4 border-t border-white/10",children:a.jsx("button",{onClick:s,className:"w-full py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors font-medium",children:"Close"})})]})})},Mc=({property:s,onClose:e})=>{const{players:t,getPropertyRent:r,hasMonopoly:n}=Y();console.log("PropertyModal render with property:",s);const o=s.owner!==null?t[s.owner]:null,i=r(s.id),c=s.owner!==null?n(s.owner,s.group):!1;return a.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-gradient-to-br from-slate-900 to-slate-800 p-6 rounded-2xl border-2 border-blue-500/30 shadow-2xl max-w-md w-full mx-4",children:[a.jsx("div",{className:"flex justify-end mb-4",children:a.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white bg-slate-800 hover:bg-red-600 p-2 rounded-xl transition-all",children:a.jsx(Je,{className:"w-5 h-5"})})}),a.jsxs("div",{className:"mb-6",children:[s.type==="property"&&a.jsx("div",{className:"w-full h-2 rounded-t-lg mb-3",style:{backgroundColor:s.color}}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-white mb-1",children:s.name}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("span",{className:"text-gray-400 capitalize",children:s.type}),s.type==="property"&&a.jsxs("span",{className:"text-gray-400",children:["• ",s.group]})]})]}),o?a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"flex items-center text-yellow-400 text-sm mb-1",children:[a.jsx(ys,{className:"w-4 h-4 mr-1"}),"Owned"]}),a.jsx("div",{className:"px-2 py-1 rounded text-xs font-bold",style:{backgroundColor:o.color,color:"#fff"},children:o.name})]}):a.jsx("div",{className:"text-green-400 text-sm font-bold",children:"Available"})]})]}),s.type==="property"&&s.houses>0&&a.jsx("div",{className:"mb-4 p-3 bg-slate-800/50 rounded-lg border border-white/10",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"flex items-center",children:s.houses===5?a.jsxs(a.Fragment,{children:[a.jsx(ze,{className:"w-5 h-5 text-red-500 mr-2"}),a.jsx("span",{className:"text-red-400 font-bold",children:"Hotel Built"})]}):a.jsxs(a.Fragment,{children:[a.jsx(ne,{className:"w-5 h-5 text-green-500 mr-2"}),a.jsxs("span",{className:"text-green-400 font-bold",children:[s.houses," House",s.houses>1?"s":""]})]})}),c&&a.jsxs("div",{className:"flex items-center text-purple-400 text-sm",children:[a.jsx($t,{className:"w-4 h-4 mr-1"}),"Monopoly"]})]})}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center p-3 bg-slate-800/30 rounded-lg",children:[a.jsx("span",{className:"text-gray-400",children:"Purchase Price:"}),a.jsxs("span",{className:"text-white font-bold text-lg",children:["$",s.price]})]}),s.owner!==null&&a.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-900/20 border border-green-500/30 rounded-lg",children:[a.jsx("span",{className:"text-green-300",children:"Current Rent:"}),a.jsxs("span",{className:"text-green-400 font-bold text-lg",children:["$",i]})]}),s.type==="property"&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"text-gray-300 font-semibold",children:"Rent Schedule:"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[a.jsxs("div",{className:`p-2 rounded ${s.houses===0&&!c?"bg-blue-600/20 border border-blue-500/50":"bg-slate-800"}`,children:[a.jsx("div",{className:"text-gray-400",children:"Base Rent"}),a.jsxs("div",{className:"text-white font-bold",children:["$",s.rent[0]]})]}),a.jsxs("div",{className:`p-2 rounded ${s.houses===0&&c?"bg-blue-600/20 border border-blue-500/50":"bg-slate-800"}`,children:[a.jsx("div",{className:"text-gray-400",children:"With Monopoly"}),a.jsxs("div",{className:"text-white font-bold",children:["$",s.rent[1]]})]}),a.jsxs("div",{className:`p-2 rounded ${s.houses===1?"bg-blue-600/20 border border-blue-500/50":"bg-slate-800"}`,children:[a.jsx("div",{className:"text-gray-400",children:"1 House"}),a.jsxs("div",{className:"text-white font-bold",children:["$",s.rent[2]]})]}),a.jsxs("div",{className:`p-2 rounded ${s.houses===2?"bg-blue-600/20 border border-blue-500/50":"bg-slate-800"}`,children:[a.jsx("div",{className:"text-gray-400",children:"2 Houses"}),a.jsxs("div",{className:"text-white font-bold",children:["$",s.rent[3]]})]}),a.jsxs("div",{className:`p-2 rounded ${s.houses===3?"bg-blue-600/20 border border-blue-500/50":"bg-slate-800"}`,children:[a.jsx("div",{className:"text-gray-400",children:"3 Houses"}),a.jsxs("div",{className:"text-white font-bold",children:["$",s.rent[4]]})]}),a.jsxs("div",{className:`p-2 rounded ${s.houses===4?"bg-blue-600/20 border border-blue-500/50":"bg-slate-800"}`,children:[a.jsx("div",{className:"text-gray-400",children:"4 Houses"}),a.jsxs("div",{className:"text-white font-bold",children:["$",s.rent[5]]})]}),a.jsxs("div",{className:`p-2 rounded col-span-2 ${s.houses===5?"bg-blue-600/20 border border-blue-500/50":"bg-slate-800"}`,children:[a.jsx("div",{className:"text-gray-400",children:"Hotel"}),a.jsxs("div",{className:"text-white font-bold",children:["$",s.rent[5]||s.rent[s.rent.length-1]]})]})]}),a.jsxs("div",{className:"flex justify-between items-center p-3 bg-orange-900/20 border border-orange-500/30 rounded-lg",children:[a.jsx("span",{className:"text-orange-300",children:"House/Hotel Cost:"}),a.jsxs("span",{className:"text-orange-400 font-bold",children:["$",s.housePrice]})]})]}),s.type==="railroad"&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"text-gray-300 font-semibold",children:"Rent Schedule:"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[a.jsxs("div",{className:"bg-slate-800 p-2 rounded",children:[a.jsx("div",{className:"text-gray-400",children:"1 Railroad"}),a.jsxs("div",{className:"text-white font-bold",children:["$",s.rent[0]]})]}),a.jsxs("div",{className:"bg-slate-800 p-2 rounded",children:[a.jsx("div",{className:"text-gray-400",children:"2 Railroads"}),a.jsxs("div",{className:"text-white font-bold",children:["$",s.rent[1]]})]}),a.jsxs("div",{className:"bg-slate-800 p-2 rounded",children:[a.jsx("div",{className:"text-gray-400",children:"3 Railroads"}),a.jsxs("div",{className:"text-white font-bold",children:["$",s.rent[2]]})]}),a.jsxs("div",{className:"bg-slate-800 p-2 rounded",children:[a.jsx("div",{className:"text-gray-400",children:"4 Railroads"}),a.jsxs("div",{className:"text-white font-bold",children:["$",s.rent[3]]})]})]})]}),s.type==="utility"&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"text-gray-300 font-semibold",children:"Rent Schedule:"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[a.jsxs("div",{className:"bg-slate-800 p-2 rounded",children:[a.jsx("div",{className:"text-gray-400",children:"1 Utility"}),a.jsx("div",{className:"text-white font-bold",children:"4 × Dice Roll"})]}),a.jsxs("div",{className:"bg-slate-800 p-2 rounded",children:[a.jsx("div",{className:"text-gray-400",children:"2 Utilities"}),a.jsx("div",{className:"text-white font-bold",children:"10 × Dice Roll"})]})]})]})]}),a.jsx("div",{className:"mt-6 flex justify-center",children:a.jsx("button",{onClick:e,className:"px-6 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors font-medium",children:"Close"})})]})})},Uc=({onClose:s,currentUserId:e})=>{var Cr,$r,Er,Rr,Ir,Or,Ar,Lr;const{players:t,properties:r,currentPlayer:n,activeTradeOffers:o,tradeSessions:i,createTradeSession:c,createTradeOffer:l,updateTradeOffer:d,acceptTradeOffer:u,rejectTradeOffer:h,cancelTradeSession:m,cleanupExpiredOffers:p}=Y(),[g,x]=f.useState(null),[b,w]=f.useState([]),[N,y]=f.useState([]),[j,S]=f.useState(0),[k,$]=f.useState(0),[F,L]=f.useState(null),[q,M]=f.useState("partner"),R=n,_=t[R];f.useEffect(()=>{const P=setInterval(()=>{p()},3e4);return()=>clearInterval(P)},[p]);const se=()=>t.filter((P,T)=>T!==R),ee=()=>{if(console.log("🔍 getMyAvailableProperties DEBUG:",{currentPlayerData:_,currentPlayerId:R,playerProperties:_==null?void 0:_.properties}),!(_!=null&&_.properties))return console.log("❌ No properties found for current player"),[];const P=_.properties.map(T=>r[T]).filter(T=>T?!T.mortgage&&T.houses===0:!1);return console.log("✅ Available properties for trade:",P),P},oe=P=>{const T=t[P];if(console.log("🔍 getPartnerAvailableProperties DEBUG:",{partnerIndex:P,partner:T,partnerName:T==null?void 0:T.name,partnerProperties:T==null?void 0:T.properties}),!(T!=null&&T.properties))return console.log("❌ No properties found for partner"),[];const V=T.properties.map(B=>r[B]).filter(B=>B?!B.mortgage&&B.houses===0:!1);return console.log("✅ Partner available properties:",V),V},v=P=>{const T=typeof P=="number"?t[P]:t.find(le=>le.userId===String(P));if(!T)return"/images/tokens/default.png";const V=["boot","car","cat","dog","hat","iron","ship","thimble","wheelbarrow","horse"],B=T.id%V.length;return`/images/tokens/${V[B]}.png`},E=()=>g===null?null:t[g],G=P=>{console.log("🎯 Starting trade session:",{currentPlayerId:R,partnerIndex:P,participantIds:[R,P]});const T=c([R,P]);L(T),x(P),M("offer")},H=()=>{if(g===null||!F){console.error("❌ Cannot submit offer: missing partner or session");return}console.log("📝 Submitting trade offer:",{fromPlayerId:R,toPlayerId:g,offeredProperties:b,offeredMoney:j,requestedProperties:N,requestedMoney:k});const P={fromPlayerId:R,toPlayerId:g,offeredProperties:b,offeredMoney:j,requestedProperties:N,requestedMoney:k};try{const T=i.find(V=>V.id===F);T!=null&&T.currentOffer?d(F,P):l(F,P),M("summary")}catch(T){console.error("❌ Error submitting offer:",T),alert("Failed to send trade offer. Please try again.")}},O=(P,T)=>{console.log("✅ Accepting offer:",{sessionId:P,offerId:T}),u(P,T),s()},U=(P,T)=>{console.log("❌ Rejecting offer:",{sessionId:P,offerId:T}),h(P,T)},X=()=>{x(null),w([]),y([]),S(0),$(0),L(null),M("partner")},de=()=>o.filter(P=>{const T=P.toPlayerId===R,V=P.status==="pending",B=P.expiresAt>Date.now();return console.log("🔍 Checking incoming offer:",{offerId:P.id,toPlayerId:P.toPlayerId,currentPlayerId:R,isForMe:T,isPending:V,notExpired:B}),T&&V&&B}),Tr=()=>o.filter(P=>{const T=P.fromPlayerId===R,V=P.status==="pending",B=P.expiresAt>Date.now();return T&&V&&B}),Le=P=>{const T=Math.max(0,P-Date.now()),V=Math.floor(T/6e4),B=Math.floor(T%6e4/1e3);return`${V}:${B.toString().padStart(2,"0")}`};console.log("🔍 TradeModal DEBUG:",{currentPlayerId:R,currentPlayerData:_==null?void 0:_.name,selectedPartnerIndex:g,selectedPartner:(Cr=E())==null?void 0:Cr.name,activeSessionId:F,currentStep:q,activeTradeOffers:o.length,tradeSessions:i.length});const Z=se(),K=ee(),ft=g!==null?oe(g):[],Ht=de(),qt=Tr();return a.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[9999] p-4",children:a.jsxs("div",{className:"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 rounded-2xl border-2 border-gradient-to-r from-pink-500 to-purple-600 shadow-2xl max-w-6xl w-full max-h-[95vh] overflow-y-auto",children:[a.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-amber-600 p-6 rounded-t-2xl",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"bg-white/20 p-3 rounded-xl mr-4",children:a.jsx(pt,{className:"w-8 h-8 text-white"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-white",children:"Property Trading"}),a.jsxs("div",{className:"flex items-center mt-1",children:[a.jsx("img",{src:v(R),alt:"Your Token",className:"w-6 h-6 mr-2",onError:P=>{P.currentTarget.style.display="none"}}),a.jsxs("p",{className:"text-pink-100",children:[_==null?void 0:_.name," • "]}),a.jsx(fe,{className:"w-4 h-4 ml-2 mr-1 text-yellow-300"}),a.jsxs("span",{className:"text-yellow-300 font-bold",children:["$",($r=_==null?void 0:_.money)==null?void 0:$r.toLocaleString()]})]})]})]}),a.jsx("button",{onClick:s,className:"text-white/80 hover:text-white hover:bg-red-500/30 p-3 rounded-xl transition-all duration-200",children:a.jsx(Je,{className:"w-6 h-6"})})]})}),a.jsxs("div",{className:"p-6",children:[Ht.length>0&&a.jsxs("div",{className:"mb-8 p-6 bg-gradient-to-r from-yellow-900/30 to-orange-900/30 border-2 border-yellow-500/40 rounded-xl backdrop-blur-sm",children:[a.jsxs("h3",{className:"text-yellow-400 font-bold mb-4 flex items-center text-lg",children:[a.jsx("div",{className:"bg-yellow-500/20 p-2 rounded-lg mr-3",children:a.jsx(Tn,{className:"w-5 h-5"})}),"Incoming Trade Offers (",Ht.length,")"]}),a.jsx("div",{className:"space-y-4",children:Ht.map(P=>{const T=t[P.fromPlayerId],V=i.find(B=>{var le;return((le=B.currentOffer)==null?void 0:le.id)===P.id});return T?a.jsxs("div",{className:"bg-slate-800/60 backdrop-blur-sm rounded-xl p-5 border-2 border-yellow-500/30 hover:border-yellow-400/50 transition-all",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("img",{src:v(P.fromPlayerId),alt:`${T.name} Token`,className:"w-8 h-8 mr-3",onError:B=>{B.currentTarget.style.display="none"}}),a.jsxs("div",{children:[a.jsx("span",{className:"text-white font-bold text-lg",children:T.name}),a.jsx("div",{className:"text-yellow-400 text-sm",children:"wants to trade with you"})]})]}),a.jsxs("div",{className:"bg-yellow-500/20 px-3 py-2 rounded-lg flex items-center",children:[a.jsx(St,{className:"w-4 h-4 mr-2 text-yellow-400"}),a.jsx("span",{className:"text-yellow-400 font-mono font-bold",children:Le(P.expiresAt)})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-5",children:[a.jsxs("div",{className:"bg-green-900/20 rounded-lg p-4 border border-green-500/30",children:[a.jsxs("h4",{className:"text-green-400 font-bold mb-3 flex items-center",children:[a.jsx($t,{className:"w-4 h-4 mr-2"}),"They Offer You:"]}),a.jsxs("div",{className:"space-y-2",children:[P.offeredProperties.map(B=>{const le=r[B];return le?a.jsxs("div",{className:"flex items-center bg-slate-700/30 rounded-lg p-2",children:[a.jsx(ne,{className:"w-4 h-4 mr-2 text-green-400"}),a.jsx("div",{className:"w-3 h-3 rounded mr-2",style:{backgroundColor:le.color}}),a.jsx("span",{className:"text-white text-sm font-medium",children:le.name})]},B):null}),P.offeredMoney>0&&a.jsxs("div",{className:"flex items-center bg-slate-700/30 rounded-lg p-2",children:[a.jsx(fe,{className:"w-4 h-4 mr-2 text-yellow-400"}),a.jsxs("span",{className:"text-yellow-400 font-bold",children:["$",P.offeredMoney.toLocaleString()]})]})]})]}),a.jsxs("div",{className:"bg-red-900/20 rounded-lg p-4 border border-red-500/30",children:[a.jsxs("h4",{className:"text-red-400 font-bold mb-3 flex items-center",children:[a.jsx(pt,{className:"w-4 h-4 mr-2"}),"They Want From You:"]}),a.jsxs("div",{className:"space-y-2",children:[P.requestedProperties.map(B=>{const le=r[B];return le?a.jsxs("div",{className:"flex items-center bg-slate-700/30 rounded-lg p-2",children:[a.jsx(ne,{className:"w-4 h-4 mr-2 text-red-400"}),a.jsx("div",{className:"w-3 h-3 rounded mr-2",style:{backgroundColor:le.color}}),a.jsx("span",{className:"text-white text-sm font-medium",children:le.name})]},B):null}),P.requestedMoney>0&&a.jsxs("div",{className:"flex items-center bg-slate-700/30 rounded-lg p-2",children:[a.jsx(fe,{className:"w-4 h-4 mr-2 text-yellow-400"}),a.jsxs("span",{className:"text-yellow-400 font-bold",children:["$",P.requestedMoney.toLocaleString()]})]})]})]})]}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsxs("button",{onClick:()=>V&&O(V.id,P.id),className:"flex-1 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white px-4 py-3 rounded-xl font-bold transition-all duration-200 flex items-center justify-center shadow-lg",children:[a.jsx(Cn,{className:"w-5 h-5 mr-2"}),"Accept Trade"]}),a.jsxs("button",{onClick:()=>V&&U(V.id,P.id),className:"flex-1 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white px-4 py-3 rounded-xl font-bold transition-all duration-200 flex items-center justify-center shadow-lg",children:[a.jsx(bs,{className:"w-5 h-5 mr-2"}),"Decline"]})]})]},P.id):(console.warn("❌ From player not found for offer:",P.id),null)})})]}),qt.length>0&&a.jsxs("div",{className:"mb-8 p-6 bg-gradient-to-r from-blue-900/30 to-indigo-900/30 border-2 border-blue-500/40 rounded-xl backdrop-blur-sm",children:[a.jsxs("h3",{className:"text-blue-400 font-bold mb-4 flex items-center text-lg",children:[a.jsx("div",{className:"bg-blue-500/20 p-2 rounded-lg mr-3",children:a.jsx(rt,{className:"w-5 h-5"})}),"Your Pending Offers (",qt.length,")"]}),a.jsx("div",{className:"space-y-3",children:qt.map(P=>{const T=t[P.toPlayerId];return T?a.jsxs("div",{className:"bg-slate-800/60 backdrop-blur-sm rounded-xl p-4 border border-blue-500/30",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("span",{className:"text-blue-300 mr-2",children:"Offer sent to:"}),a.jsx("img",{src:v(P.toPlayerId),alt:`${T.name} Token`,className:"w-6 h-6 mr-2",onError:V=>{V.currentTarget.style.display="none"}}),a.jsx("span",{className:"text-white font-bold",children:T.name})]}),a.jsxs("div",{className:"flex items-center text-blue-400",children:[a.jsx(St,{className:"w-4 h-4 mr-1"}),a.jsx("span",{className:"font-mono",children:Le(P.expiresAt)})]})]}),a.jsxs("div",{className:"text-blue-300 text-sm mt-2",children:["⏳ Waiting for ",T.name," to respond..."]})]},P.id):null})})]}),q==="partner"&&a.jsxs("div",{children:[a.jsxs("h3",{className:"text-white font-bold mb-6 text-2xl flex items-center",children:[a.jsx(Pe,{className:"w-7 h-7 mr-3 text-orange-400"}),"Select Trading Partner"]}),Z.length===0?a.jsxs("div",{className:"text-center py-12 bg-gradient-to-br from-slate-800/50 to-slate-900/50 rounded-xl border-2 border-dashed border-gray-600",children:[a.jsx(Pe,{className:"w-16 h-16 text-gray-500 mx-auto mb-4"}),a.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:"No Partners Available"}),a.jsx("p",{className:"text-gray-400",children:"All other players need to own properties to trade"})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Z.map((P,T)=>{const V=t.findIndex(B=>B.id===P.id);return a.jsxs("button",{onClick:()=>G(V),className:"p-6 bg-gradient-to-br from-slate-800/60 to-slate-900/60 hover:from-slate-700/60 hover:to-slate-800/60 border-2 border-white/10 hover:border-orange-500/50 rounded-xl transition-all duration-300 text-left group backdrop-blur-sm shadow-lg hover:shadow-xl transform hover:-translate-y-1",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx("img",{src:v(V),alt:`${P.name} Token`,className:"w-12 h-12 mr-4",onError:B=>{B.currentTarget.style.display="none"}}),a.jsxs("div",{children:[a.jsx("span",{className:"text-white font-bold text-xl",children:P.name}),a.jsx("div",{className:"text-pink-400 text-sm",children:"Click to trade"})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center text-amber-400",children:[a.jsx(fe,{className:"w-4 h-4 mr-2"}),a.jsxs("span",{className:"font-bold",children:["$",P.money.toLocaleString()]})]}),a.jsxs("div",{className:"flex items-center text-blue-400",children:[a.jsx(ne,{className:"w-4 h-4 mr-2"}),a.jsxs("span",{children:[P.properties.length," properties"]})]}),a.jsx("div",{className:"text-pink-400 group-hover:text-pink-300 text-sm font-medium",children:"→ Start Trading"})]})]},P.id)})})]}),q==="offer"&&g!==null&&a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-8",children:[a.jsxs("h3",{className:"text-white font-bold text-2xl flex items-center",children:[a.jsx("div",{className:"bg-orange-500/20 p-3 rounded-xl mr-4",children:a.jsx(pt,{className:"w-6 h-6 text-pink-400"})}),"Trading with"," ",a.jsx("img",{src:v(g),alt:"Partner Token",className:"w-8 h-8 mx-3",onError:P=>{P.currentTarget.style.display="none"}}),(Er=E())==null?void 0:Er.name]}),a.jsx("button",{onClick:X,className:"text-gray-400 hover:text-red-400 hover:bg-red-500/10 px-4 py-2 rounded-lg transition-all",children:"Cancel Trade"})]}),a.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8",children:[a.jsxs("div",{className:"bg-gradient-to-br from-green-900/30 to-emerald-900/30 rounded-xl p-6 border-2 border-green-500/30 backdrop-blur-sm",children:[a.jsxs("h4",{className:"text-green-400 font-bold mb-6 flex items-center text-xl",children:[a.jsx("div",{className:"bg-green-500/20 p-2 rounded-lg mr-3",children:a.jsx(rt,{className:"w-5 h-5"})}),"Your Offer"]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("label",{className:"text-white font-bold mb-4 block flex items-center",children:[a.jsx(ne,{className:"w-4 h-4 mr-2"}),"Properties to Offer:"]}),K.length===0?a.jsxs("div",{className:"text-center py-6 bg-slate-800/30 rounded-lg border border-dashed border-gray-600",children:[a.jsx(ne,{className:"w-8 h-8 text-gray-500 mx-auto mb-2"}),a.jsx("p",{className:"text-gray-400 text-sm",children:"No properties available to trade"}),a.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"Properties with buildings cannot be traded"})]}):a.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:K.map(P=>{var T;return a.jsxs("label",{className:"flex items-center p-3 hover:bg-slate-700/30 rounded-lg cursor-pointer transition-colors border hover:border-green-500/30",children:[a.jsx("input",{type:"checkbox",checked:b.includes(P.id),onChange:V=>{V.target.checked?w([...b,P.id]):w(b.filter(B=>B!==P.id))},className:"mr-4 w-4 h-4 text-green-500"}),a.jsx("div",{className:"w-4 h-4 rounded mr-3 border-2 border-white/20",style:{backgroundColor:P.color}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("span",{className:"text-white font-medium",children:P.name}),a.jsxs("div",{className:"text-green-400 text-sm font-bold",children:["$",(T=P.price)==null?void 0:T.toLocaleString()]})]})]},P.id)})})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"text-white font-bold mb-3 block flex items-center",children:[a.jsx(fe,{className:"w-4 h-4 mr-2"}),"Money to Offer:"]}),a.jsx("input",{type:"number",min:"0",max:(_==null?void 0:_.money)||0,value:j,onChange:P=>S(Math.max(0,parseInt(P.target.value)||0)),className:"w-full bg-slate-700 text-white px-4 py-3 rounded-lg border-2 border-green-500/30 focus:border-green-400 focus:outline-none transition-colors font-mono text-lg",placeholder:"0"}),a.jsxs("p",{className:"text-green-300 text-sm mt-2 flex items-center",children:[a.jsx(fe,{className:"w-3 h-3 mr-1"}),"Available: $",((Rr=_==null?void 0:_.money)==null?void 0:Rr.toLocaleString())||0]})]})]}),a.jsxs("div",{className:"bg-gradient-to-br from-red-900/30 to-rose-900/30 rounded-xl p-6 border-2 border-red-500/30 backdrop-blur-sm",children:[a.jsxs("h4",{className:"text-red-400 font-bold mb-6 flex items-center text-xl",children:[a.jsx("div",{className:"bg-red-500/20 p-2 rounded-lg mr-3",children:a.jsx(pt,{className:"w-5 h-5"})}),"Your Request"]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("label",{className:"text-white font-bold mb-4 block flex items-center",children:[a.jsx(ne,{className:"w-4 h-4 mr-2"}),"Properties to Request:"]}),ft.length===0?a.jsxs("div",{className:"text-center py-6 bg-slate-800/30 rounded-lg border border-dashed border-gray-600",children:[a.jsx(ne,{className:"w-8 h-8 text-gray-500 mx-auto mb-2"}),a.jsx("p",{className:"text-gray-400 text-sm",children:"No properties available from partner"})]}):a.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:ft.map(P=>{var T;return a.jsxs("label",{className:"flex items-center p-3 hover:bg-slate-700/30 rounded-lg cursor-pointer transition-colors border hover:border-red-500/30",children:[a.jsx("input",{type:"checkbox",checked:N.includes(P.id),onChange:V=>{V.target.checked?y([...N,P.id]):y(N.filter(B=>B!==P.id))},className:"mr-4 w-4 h-4 text-red-500"}),a.jsx("div",{className:"w-4 h-4 rounded mr-3 border-2 border-white/20",style:{backgroundColor:P.color}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("span",{className:"text-white font-medium",children:P.name}),a.jsxs("div",{className:"text-red-400 text-sm font-bold",children:["$",(T=P.price)==null?void 0:T.toLocaleString()]}),P.mortgage&&a.jsx("div",{className:"text-yellow-400 text-xs",children:"⚠️ Mortgaged"}),P.houses>0&&a.jsxs("div",{className:"text-orange-400 text-xs",children:["🏠 ",P.houses," houses"]})]})]},P.id)})})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"text-white font-bold mb-3 block flex items-center",children:[a.jsx(fe,{className:"w-4 h-4 mr-2"}),"Money to Request:"]}),a.jsx("input",{type:"number",min:"0",max:((Ir=E())==null?void 0:Ir.money)||0,value:k,onChange:P=>$(Math.max(0,parseInt(P.target.value)||0)),className:"w-full bg-slate-700 text-white px-4 py-3 rounded-lg border-2 border-red-500/30 focus:border-red-400 focus:outline-none transition-colors font-mono text-lg",placeholder:"0"}),a.jsxs("p",{className:"text-red-300 text-sm mt-2 flex items-center",children:[a.jsx(fe,{className:"w-3 h-3 mr-1"}),"Partner has: $",((Ar=(Or=E())==null?void 0:Or.money)==null?void 0:Ar.toLocaleString())||0]})]})]})]}),a.jsxs("div",{className:"flex space-x-4 mt-8",children:[a.jsxs("button",{onClick:H,disabled:b.length===0&&N.length===0&&j===0&&k===0,className:`flex-1 py-4 px-6 rounded-xl font-bold transition-all duration-200 flex items-center justify-center text-lg shadow-lg ${b.length>0||N.length>0||j>0||k>0?"bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-700 hover:to-purple-700 text-white transform hover:-translate-y-1":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:[a.jsx(rt,{className:"w-5 h-5 mr-3"}),"Send Trade Offer"]}),a.jsx("button",{onClick:()=>{w([]),y([]),S(0),$(0)},className:"px-6 py-4 bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white rounded-xl font-bold transition-all duration-200 shadow-lg",children:"Reset"})]})]}),q==="summary"&&g!==null&&a.jsxs("div",{className:"text-center py-12",children:[a.jsx("div",{className:"bg-gradient-to-br from-green-500/20 to-blue-500/20 rounded-full w-32 h-32 flex items-center justify-center mx-auto mb-6 border-2 border-green-500/30",children:a.jsx(rt,{className:"w-16 h-16 text-green-400"})}),a.jsx("h3",{className:"text-3xl font-bold text-white mb-4",children:"Trade Offer Sent!"}),a.jsxs("div",{className:"max-w-md mx-auto mb-8",children:[a.jsx("p",{className:"text-gray-300 mb-4",children:"Your trade offer has been sent to"}),a.jsxs("div",{className:"flex items-center justify-center mb-4",children:[a.jsx("img",{src:v(g),alt:"Partner Token",className:"w-8 h-8 mr-3",onError:P=>{P.currentTarget.style.display="none"}}),a.jsx("span",{className:"text-white font-bold text-xl",children:(Lr=E())==null?void 0:Lr.name})]}),a.jsx("p",{className:"text-yellow-400 font-medium",children:"⏱️ They have 2 minutes to respond"})]}),a.jsxs("div",{className:"flex space-x-4 justify-center",children:[a.jsx("button",{onClick:X,className:"px-8 py-3 bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-700 hover:to-purple-700 text-white rounded-xl font-bold transition-all duration-200 shadow-lg transform hover:-translate-y-1",children:"Make Another Offer"}),a.jsx("button",{onClick:s,className:"px-8 py-3 bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white rounded-xl font-bold transition-all duration-200 shadow-lg",children:"Close"})]})]})]}),a.jsx("div",{className:"p-6 border-t border-white/10 bg-slate-900/50 rounded-b-2xl",children:a.jsx("button",{onClick:s,className:"w-full py-3 bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-white rounded-xl transition-all duration-200 font-medium",children:"Close Trade Window"})})]})})},Dc=({onClose:s})=>{var M,R;const{players:e,properties:t,currentPlayer:r,getCurrentPlayer:n,mortgageProperty:o,unmortgageProperty:i,canMortgageProperty:c,canUnmortgageProperty:l,sellHouse:d,canSellBuilding:u,calculatePlayerAssets:h,currentAuction:m,placeBid:p,endAuction:g}=Y(),[x,b]=f.useState("properties");f.useState(0);const w=n(),N=e.findIndex(_=>_.userId===w.userId),y=N>=0?e[N]:null,j=((y==null?void 0:y.properties)??[]).map(_=>t[_]).filter(_=>_&&_.owner===N),S=h?h(N):0,k={properties:j.filter(_=>_.type==="property"),railroads:j.filter(_=>_.type==="railroad"),utilities:j.filter(_=>_.type==="utility")},$=_=>{c&&c(_)&&o(_)},F=_=>{l&&l(_)&&i(_)},L=_=>{u&&u(_)&&d(_)};if(!y)return a.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[9999] p-4",children:a.jsxs("div",{className:"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 rounded-2xl border-2 border-red-500/50 shadow-2xl max-w-md w-full p-6 text-center",children:[a.jsx("h2",{className:"text-2xl font-bold text-red-400 mb-4",children:"❌ Error"}),a.jsx("p",{className:"text-white mb-4",children:"Cannot find your player data. Please refresh the page."}),a.jsx("button",{onClick:s,className:"px-6 py-3 bg-red-500 hover:bg-red-600 text-white rounded-xl transition-all",children:"Close"})]})});const q=({property:_})=>{var E,G,H,O,U,X,de;const se=c?c(_.id):!1,ee=l?l(_.id):!1,oe=u?u(_.id):!1,v=Math.floor(_.mortgageValue*.1);return a.jsxs("div",{className:"bg-gradient-to-br from-slate-800/60 to-slate-900/60 rounded-xl p-5 border-2 border-white/10 hover:border-blue-500/30 transition-all backdrop-blur-sm",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-6 h-6 rounded mr-3 border-2 border-white/30",style:{backgroundColor:_.color}}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-white font-bold text-lg",children:_.name}),a.jsxs("div",{className:"flex items-center text-sm",children:[a.jsx(ws,{className:"w-3 h-3 mr-1 text-green-400"}),a.jsxs("span",{className:"text-green-400 font-bold",children:["$",(E=_.price)==null?void 0:E.toLocaleString()]})]})]})]}),_.mortgage&&a.jsx("div",{className:"bg-red-500/20 px-3 py-1 rounded-full",children:a.jsx("span",{className:"text-red-400 text-xs font-bold",children:"MORTGAGED"})})]}),_.type==="property"&&a.jsxs("div",{className:"mb-4",children:[a.jsxs("div",{className:"flex items-center text-sm text-gray-300 mb-2",children:[a.jsx(Mr,{className:"w-4 h-4 mr-2"}),"Buildings: ",_.houses===5?"1 Hotel":`${_.houses} Houses`]}),_.houses>0&&a.jsxs("div",{className:"flex items-center text-xs text-blue-300",children:[a.jsx(Ur,{className:"w-3 h-3 mr-1"}),"Rent: $",(H=(G=_.rent)==null?void 0:G[_.houses===5?5:_.houses+1])==null?void 0:H.toLocaleString()]})]}),a.jsxs("div",{className:"space-y-2",children:[!_.mortgage&&se&&a.jsxs("button",{onClick:()=>$(_.id),className:"w-full bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-700 hover:to-orange-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center justify-center",children:[a.jsx($n,{className:"w-4 h-4 mr-2"}),"Mortgage for $",(O=_.mortgageValue)==null?void 0:O.toLocaleString()]}),_.mortgage&&ee&&a.jsxs("button",{onClick:()=>F(_.id),className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center justify-center",children:[a.jsx(En,{className:"w-4 h-4 mr-2"}),"Unmortgage for $",(U=Math.floor(_.mortgageValue*1.1))==null?void 0:U.toLocaleString()]}),_.houses>0&&oe&&a.jsxs("button",{onClick:()=>L(_.id),className:"w-full bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center justify-center",children:[a.jsx(Rn,{className:"w-4 h-4 mr-2"}),"Sell ",_.houses===5?"Hotel":"House"," for $",(X=Math.floor(_.housePrice/2))==null?void 0:X.toLocaleString()]}),_.mortgage&&a.jsxs("div",{className:"bg-yellow-900/30 border border-yellow-500/30 rounded-lg p-3",children:[a.jsxs("div",{className:"flex items-center text-yellow-400 text-xs mb-1",children:[a.jsx(vs,{className:"w-3 h-3 mr-1"}),"Mortgage Details"]}),a.jsxs("div",{className:"text-yellow-300 text-xs",children:["Original value: $",(de=_.mortgageValue)==null?void 0:de.toLocaleString()]}),a.jsxs("div",{className:"text-yellow-300 text-xs",children:["Interest (10%): $",v==null?void 0:v.toLocaleString()]})]})]})]})};return a.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[9999] p-4",children:a.jsxs("div",{className:"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 rounded-2xl border-2 border-blue-500/50 shadow-2xl max-w-6xl w-full max-h-[95vh] overflow-y-auto",children:[a.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 rounded-t-2xl",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"bg-white/20 p-3 rounded-xl mr-4",children:a.jsx(ne,{className:"w-8 h-8 text-white"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-white",children:"Property Management"}),a.jsxs("div",{className:"flex items-center mt-1",children:[a.jsxs("p",{className:"text-blue-100",children:[y.name," • "]}),a.jsx(fe,{className:"w-4 h-4 ml-2 mr-1 text-yellow-300"}),a.jsxs("span",{className:"text-yellow-300 font-bold",children:["$",(M=y.money)==null?void 0:M.toLocaleString()]}),a.jsxs("span",{className:"text-blue-200 ml-3",children:["Total Assets: $",S==null?void 0:S.toLocaleString()]})]})]})]}),a.jsx("button",{onClick:s,className:"text-white/80 hover:text-white hover:bg-red-500/30 p-3 rounded-xl transition-all duration-200",children:a.jsx(Je,{className:"w-6 h-6"})})]})}),a.jsx("div",{className:"p-6 border-b border-white/10",children:a.jsxs("div",{className:"flex space-x-4",children:[a.jsxs("button",{onClick:()=>b("properties"),className:`px-6 py-3 rounded-xl font-bold transition-all ${x==="properties"?"bg-gradient-to-r from-blue-600 to-purple-600 text-white":"bg-slate-700/50 text-gray-300 hover:bg-slate-600/50"}`,children:[a.jsx(ne,{className:"w-5 h-5 inline mr-2"}),"My Properties (",j.length,")"]}),m&&a.jsxs("button",{onClick:()=>b("auction"),className:`px-6 py-3 rounded-xl font-bold transition-all ${x==="auction"?"bg-gradient-to-r from-orange-600 to-red-600 text-white":"bg-slate-700/50 text-gray-300 hover:bg-slate-600/50"}`,children:[a.jsx(at,{className:"w-5 h-5 inline mr-2"}),"Active Auction"]})]})}),a.jsx("div",{className:"p-6",children:x==="properties"&&a.jsxs("div",{children:[j.length===0?a.jsxs("div",{className:"text-center py-12 bg-gradient-to-br from-slate-800/50 to-slate-900/50 rounded-xl border-2 border-dashed border-gray-600",children:[a.jsx(ne,{className:"w-16 h-16 text-gray-500 mx-auto mb-4"}),a.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:"No Properties Owned"}),a.jsx("p",{className:"text-gray-400",children:"Land on unowned properties to start building your empire!"})]}):a.jsxs("div",{className:"space-y-8",children:[k.properties.length>0&&a.jsxs("div",{children:[a.jsxs("h3",{className:"text-white font-bold text-xl mb-4 flex items-center",children:[a.jsx(Mr,{className:"w-6 h-6 mr-3 text-blue-400"}),"Properties (",k.properties.length,")"]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:k.properties.map(_=>a.jsx(q,{property:_},_.id))})]}),k.railroads.length>0&&a.jsxs("div",{children:[a.jsxs("h3",{className:"text-white font-bold text-xl mb-4 flex items-center",children:[a.jsx("span",{className:"text-2xl mr-3",children:"🚂"}),"Railroads (",k.railroads.length,")"]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:k.railroads.map(_=>a.jsx(q,{property:_},_.id))})]}),k.utilities.length>0&&a.jsxs("div",{children:[a.jsxs("h3",{className:"text-white font-bold text-xl mb-4 flex items-center",children:[a.jsx("span",{className:"text-2xl mr-3",children:"⚡"}),"Utilities (",k.utilities.length,")"]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:k.utilities.map(_=>a.jsx(q,{property:_},_.id))})]})]}),j.length>0&&a.jsxs("div",{className:"mt-8 p-6 bg-gradient-to-r from-green-900/30 to-blue-900/30 border-2 border-green-500/30 rounded-xl",children:[a.jsxs("h3",{className:"text-green-400 font-bold text-xl mb-4 flex items-center",children:[a.jsx(Ur,{className:"w-6 h-6 mr-3"}),"Financial Summary"]}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[a.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4",children:[a.jsxs("div",{className:"text-2xl font-bold text-yellow-400",children:["$",(R=y.money)==null?void 0:R.toLocaleString()]}),a.jsx("div",{className:"text-sm text-gray-300",children:"Cash"})]}),a.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4",children:[a.jsx("div",{className:"text-2xl font-bold text-blue-400",children:j.length}),a.jsx("div",{className:"text-sm text-gray-300",children:"Properties"})]}),a.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4",children:[a.jsxs("div",{className:"text-2xl font-bold text-green-400",children:["$",S==null?void 0:S.toLocaleString()]}),a.jsx("div",{className:"text-sm text-gray-300",children:"Total Assets"})]}),a.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4",children:[a.jsx("div",{className:"text-2xl font-bold text-purple-400",children:j.filter(_=>_.mortgage).length}),a.jsx("div",{className:"text-sm text-gray-300",children:"Mortgaged"})]})]})]})]})}),a.jsx("div",{className:"p-6 border-t border-white/10 bg-slate-900/50 rounded-b-2xl",children:a.jsx("button",{onClick:s,className:"w-full py-3 bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-white rounded-xl transition-all duration-200 font-medium",children:"Close Property Management"})})]})})},Fc=({propertyId:s,onClose:e})=>{var x,b,w,N,y;const{players:t,properties:r,currentPlayer:n,buyProperty:o,declinePropertyPurchase:i,selectedProperty:c,setSelectedProperty:l}=Y(),d=r[s],u=t[n],h=(u==null?void 0:u.money)>=d.price,m=()=>{o(s)&&(l(null),e())},p=()=>{i&&i(s),l(null),e()},g=()=>{l(null),e()};return f.useEffect(()=>{c!==s&&e()},[c,s,e]),!d||d.owner!==null?null:a.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[9999] p-4",children:a.jsxs("div",{className:"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 rounded-2xl border-2 border-green-500/50 shadow-2xl max-w-2xl w-full",children:[a.jsx("div",{className:"bg-gradient-to-r from-green-600 to-emerald-600 p-6 rounded-t-2xl",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"bg-white/20 p-3 rounded-xl mr-4",children:a.jsx(ne,{className:"w-8 h-8 text-white"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-white",children:"Property Available"}),a.jsx("p",{className:"text-green-100",children:"Would you like to purchase this property?"})]})]}),a.jsx("button",{onClick:g,className:"text-white/80 hover:text-white hover:bg-red-500/30 p-3 rounded-xl transition-all duration-200",children:a.jsx(Je,{className:"w-6 h-6"})})]})}),a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"bg-gradient-to-br from-slate-800/60 to-slate-900/60 rounded-xl p-6 border-2 border-green-500/30 mb-6",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx("div",{className:"w-12 h-12 rounded-lg mr-4 border-3 border-white/30 flex items-center justify-center",style:{backgroundColor:d.color},children:d.icon?a.jsx("span",{className:"text-2xl",children:d.icon}):a.jsx(ne,{className:"w-6 h-6 text-white"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-2xl font-bold text-white mb-1",children:d.name}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("span",{className:"text-gray-300 capitalize mr-3",children:d.type}),d.group!=="special"&&a.jsx("span",{className:"bg-blue-500/20 text-blue-300 px-2 py-1 rounded text-sm",children:d.group})]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center mb-3",children:[a.jsx(ws,{className:"w-6 h-6 text-green-400 mr-2"}),a.jsxs("div",{children:[a.jsxs("div",{className:"text-3xl font-bold text-green-400",children:["$",(x=d.price)==null?void 0:x.toLocaleString()]}),a.jsx("div",{className:"text-sm text-gray-400",children:"Purchase Price"})]})]}),d.mortgageValue&&a.jsxs("div",{className:"text-sm text-gray-300 mb-2",children:["Mortgage Value: $",(b=d.mortgageValue)==null?void 0:b.toLocaleString()]})]}),a.jsxs("div",{children:[d.rent&&d.rent.length>0&&a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Rent Information:"}),a.jsxs("div",{className:"space-y-1 text-sm",children:[a.jsxs("div",{className:"text-blue-300",children:["Base Rent: $",d.rent[0]]}),d.type==="property"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"text-purple-300",children:["With Monopoly: $",d.rent[1]]}),d.rent[2]&&a.jsxs("div",{className:"text-yellow-300",children:["1 House: $",d.rent[2]]})]})]})]}),d.type==="property"&&d.housePrice&&a.jsxs("div",{className:"mt-3",children:[a.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Building Cost:"}),a.jsxs("div",{className:"text-sm text-orange-300",children:["Houses/Hotels: $",(w=d.housePrice)==null?void 0:w.toLocaleString()," each"]})]})]})]})]}),a.jsxs("div",{className:"bg-slate-800/40 rounded-xl p-4 border border-blue-500/30 mb-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-white font-bold text-lg",children:u==null?void 0:u.name}),a.jsx("div",{className:"text-blue-300",children:"Your Cash"})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"text-2xl font-bold text-yellow-400",children:["$",(N=u==null?void 0:u.money)==null?void 0:N.toLocaleString()]}),!h&&a.jsxs("div",{className:"text-red-400 text-sm flex items-center",children:[a.jsx(vs,{className:"w-4 h-4 mr-1"}),"Insufficient funds"]})]})]}),h&&a.jsx("div",{className:"mt-3 pt-3 border-t border-gray-600",children:a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{className:"text-gray-300",children:"After purchase:"}),a.jsxs("span",{className:"text-green-400 font-bold",children:["$",((u==null?void 0:u.money)-d.price).toLocaleString()]})]})})]}),a.jsxs("div",{className:"bg-orange-900/30 border border-orange-500/40 rounded-xl p-4 mb-6",children:[a.jsxs("div",{className:"flex items-center text-orange-400 mb-2",children:[a.jsx(at,{className:"w-5 h-5 mr-2"}),a.jsx("span",{className:"font-bold",children:"Auction Notice"})]}),a.jsx("p",{className:"text-orange-200 text-sm",children:"If you decline to purchase this property, it will be put up for auction. All players (including you) can then bid on it!"})]}),a.jsxs("div",{className:"flex space-x-4",children:[a.jsxs("button",{onClick:m,disabled:!h,className:`flex-1 py-4 px-6 rounded-xl font-bold text-lg transition-all duration-200 flex items-center justify-center ${h?"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white shadow-lg transform hover:-translate-y-1":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:[a.jsx(In,{className:"w-6 h-6 mr-3"}),h?`Buy for $${(y=d.price)==null?void 0:y.toLocaleString()}`:"Cannot Afford"]}),a.jsxs("button",{onClick:p,className:"flex-1 py-4 px-6 bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white rounded-xl font-bold text-lg transition-all duration-200 flex items-center justify-center shadow-lg",children:[a.jsx(at,{className:"w-6 h-6 mr-3"}),"Decline & Auction"]})]}),a.jsx("div",{className:"mt-4 text-center",children:a.jsx("p",{className:"text-gray-400 text-sm",children:"You must make a decision to continue the game"})})]})]})})},Gc=()=>{var q;const{currentAuction:s,endAuction:e,players:t,properties:r,getCurrentPlayer:n,increaseBid:o,declineAuction:i}=Y(),[c,l]=f.useState(0);if(f.useEffect(()=>{if(!s){console.log("⏰ No auction - timer stopped");return}console.log("⏰ Starting auction timer");const M=setInterval(()=>{const R=Date.now(),_=s.timestamp,se=R-_,ee=Math.max(0,3e4-se);l(ee),ee<=0&&(console.log("⏰ Time up! Ending auction"),e(),clearInterval(M))},1e3);return()=>{console.log("⏰ Cleaning up auction timer"),clearInterval(M)}},[s==null?void 0:s.timestamp,e]),!s)return console.log("🚫 AuctionTimer: No auction, not rendering"),null;if(typeof s!="object"||s===null)return console.log("🚫 AuctionTimer: Invalid auction object"),null;if(s.propertyId===null||s.propertyId===void 0)return console.log("🚫 AuctionTimer: PropertyId is null/undefined"),null;const d=r[s.propertyId];if(!d)return console.log("🚫 AuctionTimer: Property not found"),null;const u=s.auctionCreator??0,h=t[u],m=n(),p=t.findIndex(M=>M.userId===m.userId),g=s.activeParticipants||s.participants||[];if(console.log("🎯 AUCTION LOGIC:",{auctionCreatorIndex:u,auctionCreatorName:h==null?void 0:h.name,gameCurrentPlayerIndex:p,gameCurrentPlayerName:m.name,activeParticipants:g,allPlayers:t.map((M,R)=>({idx:R,name:M.name,userId:M.userId}))}),u===p)return console.log("🚫 Hiding auction from creator"),null;console.log("✅ Showing auction to participant");const x=t[p],b=!0,w=Math.ceil(c/1e3),N=w<=10,y=s.currentBid+20,j=x&&x.money>=y,S=j&&w>0,k=w>0,$=s.currentBidder!==null?t[s.currentBidder]:null;console.log("🎯 PERMISSIONS:",{gameCurrentPlayerName:m.name,gameCurrentPlayerIndex:p,canParticipate:b,canBid:S,canDecline:k,playerMoney:x==null?void 0:x.money,nextBidCost:y,playerDataExists:!!x});const F=()=>{S&&p>=0&&(console.log("💰 Increasing bid from",p),o(p))},L=()=>{k&&p>=0&&(console.log("❌ Declining auction from",p),i(p))};return a.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[9999] p-4",children:a.jsxs("div",{className:`bg-gradient-to-r ${N?"from-red-600 to-red-700":"from-orange-600 to-amber-600"} text-white rounded-2xl shadow-2xl border-2 ${N?"border-red-400":"border-orange-400"} backdrop-blur-sm w-full max-w-2xl ${N?"animate-pulse":""}`,children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-white/20",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"bg-white/20 p-3 rounded-xl mr-4",children:a.jsx(at,{className:"w-8 h-8"})}),a.jsxs("div",{children:[a.jsx("div",{className:"font-bold text-2xl",children:"Property Auction"}),a.jsx("div",{className:"text-lg opacity-90",children:d.name})]})]}),a.jsx("div",{className:"flex items-center space-x-4",children:a.jsxs("div",{className:`bg-white/20 px-4 py-2 rounded-full flex items-center ${N?"bg-red-500/30":""}`,children:[a.jsx(St,{className:"w-5 h-5 mr-2"}),a.jsxs("span",{className:"font-mono font-bold text-2xl",children:[w,"s"]})]})})]}),a.jsxs("div",{className:"p-6",children:[a.jsx("div",{className:"bg-white/10 rounded-xl p-6 mb-6",children:a.jsxs("div",{className:"grid grid-cols-2 gap-6 text-center",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm opacity-75 mb-1",children:"Current Bid"}),a.jsxs("div",{className:"text-4xl font-bold text-yellow-300",children:["$",s.currentBid.toLocaleString()]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm opacity-75 mb-1",children:"Next Bid (+$20)"}),a.jsxs("div",{className:"text-3xl font-bold text-green-300",children:["$",y.toLocaleString()]})]})]})}),a.jsxs("div",{className:"text-center mb-6",children:[a.jsxs("div",{className:"text-xs text-gray-400 mb-2",children:["DEBUG: You=",m.name,"(idx:",p,") | Creator=",h==null?void 0:h.name,"(idx:",u,") | CanParticipate=",b.toString()]}),a.jsxs("div",{className:"text-white text-lg",children:["🎯 Your turn to bid or decline! (Started by ",h==null?void 0:h.name,")"]})]}),$?a.jsx("div",{className:"bg-yellow-500/20 border border-yellow-400/30 rounded-xl p-4 mb-6",children:a.jsxs("div",{className:"flex items-center justify-center text-yellow-200",children:[a.jsx(sr,{className:"w-6 h-6 mr-3"}),a.jsxs("span",{className:"text-lg",children:[a.jsx("span",{className:"font-bold",children:$.name})," is winning with $",s.currentBid.toLocaleString(),"!"]})]})}):a.jsx("div",{className:"bg-gray-500/20 border border-gray-400/30 rounded-xl p-4 mb-6",children:a.jsxs("div",{className:"flex items-center justify-center text-gray-300",children:[a.jsx(Pe,{className:"w-6 h-6 mr-3"}),a.jsxs("span",{className:"text-lg",children:["No bids yet! Starting at $",d.price.toLocaleString()]})]})}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[a.jsxs("button",{onClick:F,disabled:!S,className:`py-4 px-6 rounded-xl font-bold text-lg transition-all duration-200 flex items-center justify-center ${S?"bg-green-600 hover:bg-green-700 text-white transform hover:scale-105":"bg-gray-500 text-gray-300 cursor-not-allowed"}`,children:[a.jsx(xs,{className:"w-6 h-6 mr-2"}),"Bid $",y.toLocaleString()]}),a.jsxs("button",{onClick:L,disabled:!k,className:`py-4 px-6 rounded-xl font-bold text-lg transition-all duration-200 flex items-center justify-center ${k?"bg-red-600 hover:bg-red-700 text-white transform hover:scale-105":"bg-gray-500 text-gray-300 cursor-not-allowed"}`,children:[a.jsx(bs,{className:"w-6 h-6 mr-2"}),"Decline"]})]}),a.jsx("div",{className:"text-center mb-6",children:a.jsxs("span",{className:"text-white/75",children:["Your cash: $",((q=x==null?void 0:x.money)==null?void 0:q.toLocaleString())||"0",!j&&a.jsxs("span",{className:"text-red-300 ml-2",children:["(Cannot afford $",y.toLocaleString(),")"]})]})}),a.jsxs("div",{className:"pt-6 border-t border-white/20",children:[a.jsx("div",{className:"text-center text-white/75 mb-4",children:a.jsxs("span",{className:"text-lg",children:["Active: ",g.length," | Declined: ",(s.declinedParticipants||[]).length]})}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-center text-green-300 font-bold mb-2",children:"Active Bidders"}),a.jsx("div",{className:"space-y-2",children:g.map(M=>{const R=t[M],_=s.currentBidder===M;return a.jsxs("div",{className:`px-3 py-2 rounded-lg text-sm text-center ${_?"bg-yellow-500/30 text-yellow-200 border border-yellow-400":"bg-green-500/20 text-green-200"}`,children:[(R==null?void 0:R.name)||"Unknown",_&&" 👑"]},M)})})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-center text-red-300 font-bold mb-2",children:"Not Participating"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"px-3 py-2 rounded-lg text-sm text-center bg-blue-500/20 text-blue-200",children:[(h==null?void 0:h.name)||"Unknown"," (Creator)"]}),(s.declinedParticipants||[]).map(M=>{const R=t[M];return a.jsxs("div",{className:"px-3 py-2 rounded-lg text-sm text-center bg-red-500/20 text-red-200",children:[(R==null?void 0:R.name)||"Unknown"," ❌"]},M)})]})]})]})]})]})]})})},Hc=()=>{var se,ee,oe,v,E,G;const[s,e]=f.useState(!0),[t,r]=f.useState(null),[n,o]=f.useState(null),[i,c]=f.useState(!1),[l,d]=f.useState([]),[u,h]=f.useState(!1),[m,p]=f.useState(!1),{getCurrentPlayer:g,initializePlayersFromLobby:x,setRoomId:b,loadGameState:w,syncGameState:N,gameStarted:y,players:j,isBuildingControlsOpen:S,closeBuildingControls:k,selectedProperty:$,properties:F}=Y(),{roomId:L}=Is(),[q]=ha();console.log("🔍 DEBUG PURCHASE MODAL:",{storeSelectedProperty:$,selectedPropertyFromState:t,propertyExists:$!==null?F[$]:null,propertyOwner:$!==null?(se=F[$])==null?void 0:se.owner:null,propertyPrice:$!==null?(ee=F[$])==null?void 0:ee.price:null,shouldShowModal:$!==null&&((oe=F[$])==null?void 0:oe.owner)===null&&((v=F[$])==null?void 0:v.price)>0});const R=(()=>{const H=q.get("players");if(H)try{return JSON.parse(decodeURIComponent(H))}catch(O){console.error("Error parsing players data:",O)}return null})();f.useEffect(()=>{if(!L)return;console.log("🎮 useEffect triggered ONCE for roomId:",L);let H=!1,O;return(async()=>{if(H){console.log("⏸️ Already initialized, skipping...");return}try{console.log("🎮 Initializing multiplayer game for room:",L);const{data:{session:X}}=await z.auth.getSession();if(!X){console.log("❌ No valid session, redirecting to login"),window.location.href="/login";return}H=!0;const de=await re.getCurrentUser();if(!de){console.error("❌ No authenticated user found"),c(!1);return}if(o(de.id),b(L),!await w(L)&&(R==null?void 0:R.length)>0){console.log("🆕 No saved state, initializing from lobby data"),x(R);const Z=Y.getState();await D.updateGameState(L,{gameStarted:Z.gameStarted,players:Z.players,properties:Z.properties,currentPlayer:Z.currentPlayer,diceRolled:Z.diceRolled,lastRoll:Z.lastRoll,gameLog:Z.gameLog,doubleCount:Z.doubleCount,chanceCards:Z.chanceCards,communityChestCards:Z.communityChestCards},{playerId:de.id,action:"initialize_game",timestamp:Date.now()})}const Le=D.subscribeToGameSession(L,(Z,K)=>{if(console.log("🔄 RECEIVED UPDATE:",{action:K==null?void 0:K.action,fromPlayerId:K==null?void 0:K.playerId,currentUserId:de.id,isFromMe:(K==null?void 0:K.playerId)===de.id}),(K==null?void 0:K.playerId)===de.id){console.log("⏸️ SKIPPING OWN UPDATE:",K==null?void 0:K.action);return}console.log("✅ APPLYING EXTERNAL UPDATE from:",K==null?void 0:K.playerId),N(Z,K),d(Z.players.map(ft=>ft.userId))},()=>{console.log("✅ Realtime connected"),c(!0)},Z=>{console.error("❌ Realtime connection error:",Z),c(!1),setTimeout(()=>{console.log("🔄 Reloading page due to connection failure..."),window.location.reload()},3e3)});O=()=>{console.log("🔌 Unsubscribing from realtime updates"),Le==null||Le.unsubscribe(),H=!1}}catch(X){console.error("❌ Failed to initialize multiplayer game:",X),c(!1),H=!1}})(),()=>{O&&O()}},[L]);const _=g();return y?a.jsxs("div",{className:"flex h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 overflow-hidden",children:[a.jsx("div",{className:"w-64 p-4 border-r border-white/10",children:a.jsxs("div",{className:"h-full bg-gradient-to-br from-slate-900/50 to-slate-800/50 backdrop-blur-sm rounded-xl border border-white/10",children:[a.jsx("div",{className:"p-3 border-b border-white/10",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-white font-medium text-sm",children:"Multiplayer"}),a.jsxs("div",{className:"flex items-center space-x-1",children:[i?a.jsx(Dr,{className:"w-4 h-4 text-green-400"}):a.jsx(Fr,{className:"w-4 h-4 text-red-400"}),a.jsx(Pe,{className:"w-4 h-4 text-blue-400"}),a.jsx("span",{className:"text-blue-400 text-xs",children:l.length})]})]})}),a.jsxs("div",{className:"p-3 space-y-2",children:[a.jsx("h4",{className:"text-gray-400 text-xs font-medium uppercase",children:"Online Players"}),j.map((H,O)=>a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:`w-2 h-2 rounded-full ${l.includes(H.userId)?"bg-green-400":"bg-red-400"}`}),a.jsx("span",{className:"text-white text-sm",children:H.name}),H.id===_.id&&a.jsx("span",{className:"text-yellow-400 text-xs",children:"(Your turn)"})]},H.id))]}),a.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:a.jsxs("div",{className:"text-center text-gray-400",children:[a.jsx("div",{className:"text-4xl mb-2",children:"💬"}),a.jsx("div",{className:"text-sm font-medium",children:"Chat Coming Soon"}),a.jsx("div",{className:"text-xs",children:"Real-time game chat"})]})})]})}),a.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:a.jsxs("div",{className:"relative flex items-start gap-6 w-full max-w-6xl",children:[a.jsx("div",{className:"aspect-square w-full max-w-4xl",children:a.jsx(kc,{onPropertySelect:r})}),a.jsxs("div",{className:"w-80 flex-shrink-0",children:[t&&a.jsx(Mc,{property:t,onClose:()=>r(null)}),!t&&a.jsx("div",{className:"bg-gradient-to-br from-slate-900/50 via-slate-800/50 to-slate-900/50 backdrop-blur-xl rounded-xl border border-white/10 p-4 text-center",children:a.jsxs("div",{className:"text-gray-400 text-sm space-y-2",children:[a.jsx("div",{className:"text-2xl mb-2",children:"🏠"}),a.jsx("p",{className:"font-medium",children:"Property Details"}),a.jsx("p",{children:"Click on any property to see pricing and rental information"})]})})]}),a.jsx("div",{className:"absolute right-0 bottom-0 w-80 z-10",children:a.jsx(Lc,{})})]})}),a.jsxs("div",{className:"w-80 p-4 flex flex-col h-screen overflow-hidden border-l border-white/10",children:[a.jsxs("div",{className:"relative overflow-hidden mb-3 flex-shrink-0",children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-600/20 via-blue-600/20 to-cyan-500/20 rounded-xl blur-xl"}),a.jsxs("div",{className:"relative bg-gradient-to-br from-slate-900/95 via-slate-800/95 to-slate-900/95 backdrop-blur-xl rounded-xl border border-white/10 p-3 shadow-xl",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("h3",{className:"text-xs font-bold bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent",children:"Current Turn"}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),i&&a.jsx("span",{className:"text-green-400 text-xs",children:"Live"})]})]}),a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"text-2xl",style:{color:_.color,filter:"drop-shadow(0 0 8px currentColor)"},children:_.icon}),a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"font-bold text-white text-xs",children:_.name}),a.jsxs("div",{className:"text-green-400 font-bold text-xs",children:["$",_.money.toLocaleString()]}),a.jsxs("div",{className:"text-xs text-gray-400",children:["Pos: ",_.position," • Props: ",_.properties.length]})]})]})]})]}),a.jsx("div",{className:"mb-3 flex-shrink-0",children:a.jsx(Ec,{currentUserId:n,currentPlayer:_,onOpenTradeModal:()=>h(!0),onOpenPropertyManagement:()=>p(!0)})}),a.jsxs("div",{className:"relative overflow-hidden flex-1 min-h-0",children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-yellow-500/20 via-orange-500/20 to-red-500/20 rounded-xl blur-xl"}),a.jsxs("div",{className:"relative bg-gradient-to-br from-slate-900/95 via-slate-800/95 to-slate-900/95 backdrop-blur-xl rounded-xl border border-white/10 shadow-xl h-full flex flex-col",children:[a.jsxs("div",{className:"flex items-center justify-between p-3 cursor-pointer hover:bg-white/5 transition-colors rounded-t-xl flex-shrink-0",onClick:()=>e(!s),children:[a.jsx("h3",{className:"text-xs font-bold bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent",children:"🏆 PLAYERS LEADERBOARD"}),s?a.jsx(On,{className:"w-4 h-4 text-gray-400"}):a.jsx(An,{className:"w-4 h-4 text-gray-400"})]}),s&&a.jsx("div",{className:"px-3 pb-3 flex-1 overflow-y-auto",children:a.jsx(Cc,{})})]})]})]}),S&&a.jsx(Bc,{onClose:k,currentUserId:n}),u&&a.jsx(Uc,{onClose:()=>h(!1),currentUserId:n}),m&&a.jsx(Dc,{onClose:()=>p(!1)}),$!==null&&((E=F[$])==null?void 0:E.owner)===null&&((G=F[$])==null?void 0:G.price)>0&&a.jsx(Fc,{propertyId:$,onClose:()=>Y.getState().setSelectedProperty(null)}),a.jsx(Gc,{})]}):a.jsx("div",{className:"h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:a.jsxs("div",{className:"text-center text-white space-y-4",children:[a.jsx("div",{className:"text-6xl mb-4",children:"🎮"}),a.jsx("h1",{className:"text-3xl font-bold",children:"Connecting to Multiplayer Game"}),a.jsx("div",{className:"flex items-center justify-center space-x-2",children:i?a.jsxs(a.Fragment,{children:[a.jsx(Dr,{className:"w-5 h-5 text-green-400"}),a.jsx("span",{className:"text-green-400",children:"Connected"})]}):a.jsxs(a.Fragment,{children:[a.jsx(Fr,{className:"w-5 h-5 text-red-400"}),a.jsx("span",{className:"text-red-400",children:"Connecting..."})]})}),a.jsxs("div",{className:"text-gray-400 space-y-1",children:[a.jsxs("p",{children:["Room ID: ",L]}),a.jsxs("p",{children:["Players: ",j.length]}),n&&a.jsxs("p",{children:["Your ID: ",n.slice(0,8),"..."]})]})]})})},qc=()=>{var _,se,ee,oe;const s=It(),{roomId:e}=Is(),[t,r]=f.useState(null),[n,o]=f.useState(null),[i,c]=f.useState([]),[l,d]=f.useState(!1),[u,h]=f.useState(""),[m,p]=f.useState([]),[g,x]=f.useState(""),[b,w]=f.useState(!0),[N,y]=f.useState(!1);f.useEffect(()=>{if(!e){s("/");return}j();const v=setInterval(S,3e3);return()=>clearInterval(v)},[e]);const j=async()=>{try{const v=await re.getCurrentUser();if(!v){s("/");return}const E=await re.getUserProfile(v.id);if(!E){s("/");return}r(E),await S(),await Ie.updateUserStatus("in_game",e)}catch(v){console.error("Error initializing lobby:",v),s("/")}},S=async()=>{if(e)try{const{data:v,error:E}=await z.from("game_rooms").select(`
          *,
          host:profiles(username, id)
        `).eq("id",e).single();if(E||!v){x("Room not found");return}o(v),y((t==null?void 0:t.id)===v.host_id);const G=await Oe.getRoomParticipants(e);c(G);const H=G.find(O=>O.user_id===(t==null?void 0:t.id));H&&d(H.is_ready),v.status==="in_progress"&&s(`/game/${e}`)}catch(v){console.error("Error loading room data:",v),x("Failed to load room data")}finally{w(!1)}},k=async()=>{if(!(!e||!t))try{const v=!l;await Oe.updatePlayerReady(e,v),d(v),setTimeout(S,500)}catch(v){x(v.message)}},$=async()=>{if(!e||!N)return;if(!i.every(E=>E.is_ready)){x("All players must be ready to start the game");return}if(i.length<2){x("Need at least 2 players to start the game");return}try{await Oe.startGame(e);const E=i.map((H,O)=>{var U;return{id:O+1,name:((U=H.user)==null?void 0:U.username)||`Player ${O+1}`,color:H.player_color,icon:H.player_icon,userId:H.user_id}}),G=encodeURIComponent(JSON.stringify(E));s(`/game/${e}?players=${G}`)}catch(E){x(E.message)}},F=async()=>{if(e)try{await Oe.leaveRoom(e),await Ie.updateUserStatus("online"),s("/")}catch(v){x(v.message)}},L=v=>{if(v.preventDefault(),!u.trim()||!t)return;const E={id:Date.now().toString(),user:t.username,message:u.trim(),timestamp:new Date().toLocaleTimeString()};p(G=>[...G,E]),h("")},q=()=>{const v=(n==null?void 0:n.max_players)||4,E=[];for(let G=0;G<v;G++){const H=i[G];E.push(H||null)}return E};if(b)return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:a.jsx("div",{className:"text-white text-xl",children:"Loading lobby..."})});if(!n)return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:a.jsx("div",{className:"text-white text-xl",children:"Room not found"})});const M=q(),R=i.length>=2&&i.every(v=>v.is_ready);return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8",children:a.jsxs("div",{className:"max-w-6xl mx-auto",children:[a.jsxs("div",{className:"flex items-center justify-between mb-8",children:[a.jsxs("button",{onClick:F,className:"flex items-center text-white hover:text-gray-300 transition-colors",children:[a.jsx(Ln,{className:"w-6 h-6 mr-2"}),"Back to Lobby"]}),a.jsxs("div",{className:"text-center",children:[a.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:n.name}),a.jsxs("div",{className:"flex items-center justify-center space-x-4 text-sm text-gray-300",children:[a.jsxs("span",{className:"flex items-center",children:[a.jsx(Pe,{className:"w-4 h-4 mr-1"}),i.length,"/",n.max_players," players"]}),((_=n.game_settings)==null?void 0:_.fast_mode)&&a.jsx("span",{className:"px-2 py-1 bg-orange-500/20 text-orange-400 rounded-full",children:"⚡ Fast Mode"}),n.is_private&&a.jsx("span",{className:"px-2 py-1 bg-purple-500/20 text-purple-400 rounded-full",children:"🔒 Private"})]})]}),a.jsx("div",{className:"w-24"})]}),g&&a.jsx("div",{className:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-sm text-center",children:g}),a.jsxs("div",{className:"grid lg:grid-cols-3 gap-6 max-w-5xl mx-auto",children:[a.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm rounded-lg border border-white/10 p-4 h-fit",children:[a.jsxs("h3",{className:"text-lg font-bold text-white mb-3 flex items-center",children:[a.jsx(yr,{className:"mr-2 text-purple-400"}),"Game Settings"]}),a.jsxs("div",{className:"space-y-2 text-sm text-gray-300",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Starting Money:"}),a.jsxs("span",{className:"text-green-400",children:["$",((ee=(se=n.game_settings)==null?void 0:se.starting_money)==null?void 0:ee.toLocaleString())||"1,500"]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Game Mode:"}),a.jsx("span",{className:"text-blue-400",children:(oe=n.game_settings)!=null&&oe.fast_mode?"Fast":"Normal"})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Max Players:"}),a.jsx("span",{className:"text-yellow-400",children:n.max_players})]})]}),N&&a.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10",children:[a.jsxs("h4",{className:"text-sm font-bold text-white mb-2 flex items-center",children:[a.jsx(sr,{className:"mr-2 text-yellow-400"}),"Host Controls"]}),a.jsxs("button",{onClick:$,disabled:!R,className:`w-full py-2 font-bold rounded-lg transition-all flex items-center justify-center text-sm ${R?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:[a.jsx(Bn,{className:"w-4 h-4 mr-2"}),R?"Start Game":"Waiting for players"]}),!R&&a.jsx("p",{className:"text-xs text-gray-400 mt-1 text-center",children:"All players must be ready"})]})]}),a.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm rounded-lg border border-white/10 p-4",children:[a.jsx("h3",{className:"text-lg font-bold text-white mb-4 text-center",children:"Players"}),a.jsx("div",{className:`grid gap-3 ${n.max_players<=4?"grid-cols-2":n.max_players<=6?"grid-cols-3":"grid-cols-4"}`,children:M.map((v,E)=>{var G;return a.jsx("div",{className:`flex flex-col items-center p-3 rounded-lg border transition-all ${v?v.is_ready?"border-green-400 bg-green-500/10":"border-yellow-400 bg-yellow-500/10":"border-gray-600 bg-gray-500/10 border-dashed"}`,children:v?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center text-lg mb-2 ${v.is_ready?"bg-green-500":"bg-yellow-500"}`,children:v.player_icon}),a.jsxs("div",{className:"text-white font-semibold text-sm text-center",children:[(G=v.user)==null?void 0:G.username,v.user_id===n.host_id&&a.jsx(sr,{className:"w-3 h-3 text-yellow-400 inline ml-1"})]}),a.jsx("div",{className:`text-xs mt-1 ${v.is_ready?"text-green-400":"text-yellow-400"}`,children:v.is_ready?"✓ Ready":"? Waiting"}),v.user_id===(t==null?void 0:t.id)&&a.jsx("button",{onClick:k,className:`mt-2 px-3 py-1 rounded text-xs font-semibold transition-all ${l?"bg-red-600 hover:bg-red-700 text-white":"bg-green-600 hover:bg-green-700 text-white"}`,children:l?"Not Ready":"Ready"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-600 flex items-center justify-center text-lg mb-2",children:a.jsx(Pe,{className:"w-6 h-6 text-gray-400"})}),a.jsx("div",{className:"text-gray-400 text-xs",children:"Empty slot"})]})},E)})})]}),a.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm rounded-lg border border-white/10 p-4 flex flex-col h-fit max-h-96",children:[a.jsx("h3",{className:"text-lg font-bold text-white mb-3",children:"Chat"}),a.jsx("div",{className:"flex-1 bg-slate-800/30 rounded p-3 mb-3 overflow-y-auto max-h-48",children:m.length===0?a.jsx("div",{className:"text-gray-400 text-sm text-center",children:"No messages yet 👋"}):a.jsx("div",{className:"space-y-2",children:m.map(v=>a.jsxs("div",{className:"text-sm",children:[a.jsx("span",{className:"text-purple-400 font-semibold",children:v.user}),a.jsx("span",{className:"text-gray-500 text-xs ml-2",children:v.timestamp}),a.jsx("div",{className:"text-white",children:v.message})]},v.id))})}),a.jsxs("form",{onSubmit:L,className:"flex gap-2",children:[a.jsx("input",{type:"text",value:u,onChange:v=>h(v.target.value),placeholder:"Type a message...",className:"flex-1 px-3 py-2 bg-slate-800/50 border border-white/10 rounded text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm",maxLength:100}),a.jsx("button",{type:"submit",disabled:!u.trim(),className:"px-3 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 text-white rounded transition-colors",children:a.jsx(rt,{className:"w-4 h-4"})})]})]})]})]})})},zc=()=>{setInterval(async()=>{try{const{data:s,error:e}=await z.auth.refreshSession();if(e)throw e;console.log("✅ Token refreshed automatically")}catch(s){console.error("❌ Token refresh failed:",s),window.location.href="/login"}},50*60*1e3)},Vc=()=>(f.useEffect(()=>{console.log("🔒 Starting automatic token refresh..."),zc()},[]),a.jsx(ia,{children:a.jsxs(Lo,{children:[a.jsx(Ge,{path:"/",element:a.jsx(er,{})}),a.jsx(Ge,{path:"/room/:roomId",element:a.jsx(qc,{})}),a.jsx(Ge,{path:"/game/:roomId",element:a.jsx(Hc,{})}),a.jsx(Ge,{path:"/dashboard",element:a.jsx(er,{})}),a.jsx(Ge,{path:"*",element:a.jsx(er,{})})]})}));nr.createRoot(document.getElementById("root")).render(a.jsx(gs.StrictMode,{children:a.jsx(Vc,{})}));
//# sourceMappingURL=index-5b713e2e.js.map
